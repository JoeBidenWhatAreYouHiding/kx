# Useful triggers for the annexation codebase
is_valid_annexation_state = {
	is_owned_and_controlled_by = ROOT
	is_claim_or_core_of_ROOT = no
}

is_clear_other_claims = {
	NOT = {
		is_important_state = yes
		any_other_country = {
			is_ally_with = ROOT
			PREV = { is_claim_or_core_of_PREV = yes }
		}
	}
	if = {
		limit = {
			ROOT = { tag = JAP }
			is_china_claim_of_JAP = yes
		}
		NOT = { has_variable = ambition_area_@ROOT }
	}
	OR = {
		NOT = { has_variable = ambition_area_@ROOT }
		AND = {
			ROOT = { tag = CAN }
			is_british_colonial_claim = yes
		}
		AND = {
			ROOT = { tag = ENG }
			is_british_colonial_claim = yes
		}
		AND = {
			ROOT = { tag = GBR }
			is_british_colonial_claim = yes
		}
		AND = {
			ROOT = { tag = FRA }
			is_french_colonial_claim = yes
		}
		AND = {
			ROOT = { tag = JAP }
			OR = {
				region = 194 #Malay Peninsula
				region = 91 #Arafura Sea
				region = 93 #Java Sea
				region = 158 #Sunda Islands
				region = 159 #Borneo
				region = 167 #New Guinea
				region = 192 #Sumatra
			}
		}
		AND = {
			ROOT = { tag = NFA }
			is_french_colonial_claim = yes
		}
		ROOT = { is_ai = no }
	}
}

has_no_african_interests = {
	OR = {
		has_socialist_government = yes
		NOT = {
			tag = POR
			tag = MAF
			tag = GER
			tag = GEX
			tag = NFA
			AND = {
				tag = GBR
				NOT = { has_country_flag = GBR_decolonize }
			}
			AND = {
				tag = CAN
				NOT = { country_exists = GBR }
			}
		}
	}
}

can_form_italy = {
	2 = { is_owned_and_controlled_by = ROOT } #Rome
	count_triggers = {
		amount = 3
		158 = { is_owned_and_controlled_by = ROOT } #Turin
		159 = { is_owned_and_controlled_by = ROOT } #Milan
		117 = { is_owned_and_controlled_by = ROOT } #Naples
		162 = { is_owned_and_controlled_by = ROOT } #Florence
	}
	NOT = {
		has_country_flag = KR_will_balkanize_italy
		tag = ITA
		tag = SRI
		tag = SIC
		tag = SRD
		tag = PAP
		tag = VNC
		tag = EMI
		tag = TUS
		tag = LOM
	}
}

ROOT_can_grant_land = {
	exists = yes
	NOT = {
		has_war_with = ROOT
		has_wargoal_against = ROOT
		is_justifying_wargoal_against = ROOT
		ROOT = { is_justifying_wargoal_against = PREV }
		ROOT = { has_wargoal_against = PREV }
		any_owned_state = { is_claim_or_core_of_ROOT = yes }
	}
	OR = {
		AND = {
			has_socialist_government = yes
			ROOT = { has_socialist_government = yes }
		}
		AND = {
			has_socialist_government = no
			ROOT = { has_socialist_government = no }
		}
	}
}

puppet_may_be_annexed = {
	OR = {
		AND = {
			tag = AUS
			FROM = {
				OR = {
					AND = {
						tag = HUN
						NOT = {
							AUS = {
								OR = {
									has_completed_focus = AUS_ausgleich_1947
									has_completed_focus = AUS_still_their_king
								}
							}
						}
					}
					AND = {
						tag = CZE
						NOT = {
							AUS = {
								OR = {
									has_completed_focus = AUS_cisleithania_centralised
									has_completed_focus = AUS_drastic_measures
								}
							}
						}
					}
					AND = {
						tag = CRO
						NOT = {
							AUS = {
								OR = {
									has_completed_focus = AUS_cisleithania_centralised
									has_completed_focus = AUS_drastic_measures
								}
							}
						}
					}
					AND = {
						tag = GAL
						NOT = {
							AUS = {
								OR = {
									has_completed_focus = AUS_cisleithania_centralised
									has_completed_focus = AUS_drastic_measures
								}
							}
						}
					}
					tag = TRS
					tag = SLO
				}
			}
		}
		AND = {
			tag = OTT
			FROM = {
				OR = {
					has_autonomy_state = kr_ottoman_emirate
					has_autonomy_state = kr_ottoman_international_zone
					has_autonomy_state = kr_ottoman_vilayet
				}	
			}	
		}
		AND = {
			tag = RUS
			NOT = { has_completed_focus = RUS_Secure_Central_Asia }
			FROM = { tag = ALO }
		}
		tag = FOP
		tag = UPC
		tag = NPA
		tag = QIE
		tag = CHI
		tag = YUN
		tag = FNG
	}
}

stt_puppet_may_be_annexed = {
	OR = {
		AND = {
			ROOT = { tag = AUS }
			OR = {
				tag = TRS
				tag = SLO
				AND = {
					tag = HUN
					NOT = {
						AUS = {
							OR = {
								has_completed_focus = AUS_ausgleich_1947
								has_completed_focus = AUS_still_their_king
							}
						}
					}
				}
				AND = {
					OR = {
						tag = CZE
						tag = CRO
						tag = GAL
					}
					NOT = {
						AUS = {
							OR = {
								has_completed_focus = AUS_cisleithania_centralised
								has_completed_focus = AUS_drastic_measures
							}
						}
					}
				}
			}
		}
		AND = {
			ROOT = { tag = OTT }
			OR = {
				has_autonomy_state = kr_ottoman_emirate
				has_autonomy_state = kr_ottoman_international_zone
				has_autonomy_state = kr_ottoman_vilayet
			}
		}
		AND = {
			ROOT = {
				tag = RUS
				NOT = { has_completed_focus = RUS_Secure_Central_Asia }
			}
			tag = ALO
		}
		AND = {
			ROOT = {
				tag = PRF
				NOT = {
					has_completed_focus = PRF_kaiser_i_hind
					has_completed_focus = PRF_liberal_prince
					has_completed_focus = PRF_new_india
				}
			}
			tag = MDR
		}
	}
}

stt_no_conflict_game_rules = {
	if = {
		limit = { has_global_flag = KR_state_transfer_tool_mp }
		OR = {
			is_owned_by = ROOT
			owner = {
				stt_puppet_may_be_annexed = no
				is_subject_of = ROOT
			}
		}
	}
	else_if = {
		limit = { has_global_flag = KR_state_transfer_tool_mp_no_subject }
		is_owned_by = ROOT
	}
	else = {
		always = yes
	}
}

