#0 0-4.9
#1 5
#2 15
#3 20
#4 25
#5 30
#6 35
#7 39
#8 42
#9 46
#10 48
#11 50
#12 60

#unused currently
ANQ_add_embargo = {
	hidden_effect = {
		every_country = {
			limit = {
				OR = {
					tag = GEA
					tag = GER
					tag = USA
					tag = RUS
					tag = CAF
					tag = AUS
					tag = HUN
					tag = HOL
					tag = DEI
					tag = CRO
					tag = SWI
					tag = GRE
					tag = CAN
					tag = AST
					tag = ITA
					tag = MAF
					tag = DEH
					tag = NFA
					tag = POR
					tag = BEL
					tag = SAF
					tag = TUR
				}
			}
			ANQ = { embargo_PREV = yes }
			add_opinion_modifier = {
				target = ANQ
				modifier = ANQ_international_embar
			}
		}
	}
}

ANQ_remove_beijing_spirit = {
	hidden_effect = {
		if = {
			limit = {
				has_idea = ANQ_beijing_cooperation1
			}
			remove_ideas = ANQ_beijing_cooperation1
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation2
			}
			remove_ideas = ANQ_beijing_cooperation2
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation3
			}
			remove_ideas = ANQ_beijing_cooperation3
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation4
			}
			remove_ideas = ANQ_beijing_cooperation4
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation5
			}
			remove_ideas = ANQ_beijing_cooperation5
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation6
			}
			remove_ideas = ANQ_beijing_cooperation6
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation7
			}
			remove_ideas = ANQ_beijing_cooperation7
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation8
			}
			remove_ideas = ANQ_beijing_cooperation8
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation9
			}
			remove_ideas = ANQ_beijing_cooperation9
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation10
			}
			remove_ideas = ANQ_beijing_cooperation10
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation11
			}
			remove_ideas = ANQ_beijing_cooperation11
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation12
			}
			remove_ideas = ANQ_beijing_cooperation12
		}
		else_if = {
			limit = {
				has_idea = ANQ_beijing_cooperation
			}
			remove_ideas = ANQ_beijing_cooperation
		}
		QIE = {
			if = {
				limit = {
					has_idea = QIE_anqing_cooperation1
				}
				remove_ideas = QIE_anqing_cooperation1
			}
			else_if = {
				limit = {
					has_idea = QIE_anqing_cooperation2
				}
				remove_ideas = QIE_anqing_cooperation2
			}
			else_if = {
				limit = {
					has_idea = QIE_anqing_cooperation3
				}
				remove_ideas = QIE_anqing_cooperation3
			}
			else_if = {
				limit = {
					has_idea = QIE_anqing_cooperation4
				}
				remove_ideas = QIE_anqing_cooperation4
			}
			else_if = {
				limit = {
					has_idea = QIE_anqing_cooperation5
				}
				remove_ideas = QIE_anqing_cooperation5
			}
			else_if = {
				limit = {
					has_idea = QIE_anqing_cooperation6
				}
				remove_ideas = QIE_anqing_cooperation6
			}
			else = {
				remove_ideas = QIE_anqing_cooperation
			}
		}
	}
}

ANQ_calculate_beijing_level = {
	hidden_effect = {
		if = {
			limit = { NOT = { has_war_with = QIE } QIE = { exists = yes } }
		}
	}
}

ANQ_add_beijing_spirit = {
	hidden_effect = {
		if = {
			limit = { NOT = { has_war_with = QIE } QIE = { exists = yes } }
			if = {
				limit = {
					check_variable = {
						var = ANQ_beijing_level
						value = 10
						compare = less_than
					}
				}
				if = {
					limit = {
						check_variable = {
							var = ANQ_beijing_level
							value = 5
							compare = less_than
						}
					}
					if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 4
								compare = equals
							}
						}
						add_ideas = ANQ_beijing_cooperation4
						QIE = { add_ideas = QIE_anqing_cooperation2 }
					}
					else_if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 3
								compare = equals
							}
						}
						add_ideas = ANQ_beijing_cooperation3
						QIE = { add_ideas = QIE_anqing_cooperation2 }
					}
					else_if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 2
								compare = equals
							}
						}
						add_ideas = ANQ_beijing_cooperation2
						QIE = { add_ideas = QIE_anqing_cooperation1 }
					}
					else_if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 1
								compare = equals
							}
						}
						add_ideas = ANQ_beijing_cooperation1
						QIE = { add_ideas = QIE_anqing_cooperation1 }
					}
					else = {
						add_ideas = ANQ_beijing_cooperation
						QIE = { add_ideas = QIE_anqing_cooperation }
					}
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_beijing_level
							value = 8
							compare = less_than
						}
					}
					if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 5
								compare = equals
							}
						}
						add_ideas = ANQ_beijing_cooperation5
						QIE = { add_ideas = QIE_anqing_cooperation3 }
					}
					else_if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 6
								compare = equals
							}
						}
						add_ideas = ANQ_beijing_cooperation6
						QIE = { add_ideas = QIE_anqing_cooperation3 }
					}
					else = {
						add_ideas = ANQ_beijing_cooperation7
						QIE = { add_ideas = QIE_anqing_cooperation4 }
					}
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_beijing_level
							value = 8
							compare = equals
						}
					}
					add_ideas = ANQ_beijing_cooperation8
					QIE = { add_ideas = QIE_anqing_cooperation4 }
				}
				else = {
					add_ideas = ANQ_beijing_cooperation9
					QIE = { add_ideas = QIE_anqing_cooperation5 }
				}
			}
			else_if = {
				limit = {
					check_variable = {
						var = ANQ_beijing_level
						value = 10
						compare = equals
					}
				}
				add_ideas = ANQ_beijing_cooperation10
				QIE = { add_ideas = QIE_anqing_cooperation5 }
			}
			else_if = {
				limit = {
					check_variable = {
						var = ANQ_beijing_level
						value = 11
						compare = equals
					}
				}
				add_ideas = ANQ_beijing_cooperation11
				QIE = { add_ideas = QIE_anqing_cooperation6 }
			}
			else = {
				add_ideas = ANQ_beijing_cooperation12
				QIE = { add_ideas = QIE_anqing_cooperation6 }
			}
	
			if = {
				limit = {
					check_variable = {
						var = ANQ_beijing_level
						value = 0
						compare = greater_than
					}
	
				}
				QIE = {
					diplomatic_relation = {
						country = ANQ
						relation = docking_rights
						active = yes
					}
				}
				if = {
					limit = {
						check_variable = {
							var = ANQ_beijing_level
							value = 1
							compare = greater_than
						}
					}
					QIE = {
						if = {
							limit = { NOT = { has_military_access_to = ANQ } }
							diplomatic_relation = {
								country = ANQ
								relation = military_access
								active = yes
							}
						}
					}
					if = {
						limit = {
							check_variable = {
								var = ANQ_beijing_level
								value = 3
								compare = greater_than
							}
						}
						if = {
							limit = {
								NOT = { has_country_flag = ANQ_wuchang_anqing_railway }
								has_completed_focus = ANQ_renovate_longhai_railway
							}
							country_event = {
								id = anq.71
								days = 50
								random = 960 #40
							}
							set_country_flag = ANQ_wuchang_anqing_railway
						}
						if = {
							limit = {
								check_variable = {
									var = ANQ_beijing_level
									value = 4
									compare = greater_than
								}
							}
							if = {
								limit = {
									NOT = { has_country_flag = ANQ_banditry_troops_qing }
									has_completed_focus = ANQ_rural_outreach
								}
								country_event = {
									id = anq.75
									days = 30
									random = 480 #20
								}
								set_country_flag = ANQ_banditry_troops_qing
							}
							if = {
								limit = {
									NOT = { has_country_flag = ANQ_mineral_rights_qing }
									has_completed_focus = ANQ_five_stars_five_provinces
								}
								country_event = {
									id = anq.79
									days = 200
									random = 2400 #100
								}
								set_country_flag = ANQ_mineral_rights_qing
							}
							if = {
								limit = {
									check_variable = {
										var = ANQ_beijing_level
										value = 5
										compare = greater_than
									}
								}
								if = {
									limit = {
										NOT = { has_country_flag = ANQ_can_qing_river_canal }
										has_country_flag = ANQ_subei_canal_completed
									}
									country_event = {
										id = anq.92
										days = 50
										random = 600 #25
									}
									set_country_flag = ANQ_can_qing_river_canal
								}
								if = {
									limit = {
										check_variable = {
											var = ANQ_beijing_level
											value = 6
											compare = greater_than
										}
									}
									if = {
										limit = {
											NOT = { has_country_flag = ANQ_qie_businesses_rights }
											has_completed_focus = ANQ_caifa_contracts
										}
										country_event = {
											id = anq.83
											days = 50
											random = 960 #40
										}
										set_country_flag = ANQ_qie_businesses_rights
									}
									if = {
										limit = {
											check_variable = {
												var = ANQ_beijing_level
												value = 7
												compare = greater_than
											}
										}
										if = {
											limit = {
												NOT = { has_country_flag = ANQ_qie_legalrights }
											}
											country_event = {
												id = anq.81
												days = 100
												random = 2160 #90
											}
											set_country_flag = ANQ_qie_legalrights
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

ANQ_recalculate_beijing_anger = {
	add_to_variable = { ANQ_recalculate_counter = 1 }

	subtract_from_variable = {
		var = ANQ_beijing_anger
		value = 2
	}
	if = {
		limit = { check_variable = { ANQ_beijing_anger < 0 } }
		set_variable = { ANQ_beijing_anger = 0 }
	}

	set_temp_variable = { anq_temp_beijing_anger_multiplier = 1 }
	add_to_temp_variable = { anq_temp_beijing_anger_multiplier = ANQ_beijing_level }
	multiply_temp_variable = { anq_temp_beijing_anger_multiplier = 1.3 }
	set_variable = { anq_anger_beijing_multiplier = anq_temp_beijing_anger_multiplier }

	ANQ_add_beijing_anger_effects = yes
}

ANQ_increase_beijing_anger_05x = {
	custom_effect_tooltip = anq_increase_qie_anger_05x
	hidden_effect = {
		set_temp_variable = { anq_temp_beijing_anger_multiplier05x = anq_anger_beijing_multiplier }
		divide_temp_variable = { anq_temp_beijing_anger_multiplier05x = 2 }

		add_to_variable = {
			var = ANQ_beijing_anger
			value = anq_temp_beijing_anger_multiplier05x
		}
	}
}

ANQ_increase_beijing_anger_1x = {
	custom_effect_tooltip = anq_increase_qie_anger_1x
	hidden_effect = {
		add_to_variable = {
			var = ANQ_beijing_anger
			value = anq_anger_beijing_multiplier
		}
	}
}

ANQ_increase_beijing_anger_2x = {
	custom_effect_tooltip = anq_increase_qie_anger_1x
	hidden_effect = {
		set_temp_variable = { anq_temp_beijing_anger_multiplier2x = anq_anger_beijing_multiplier }
		multiply_temp_variable = { anq_temp_beijing_anger_multiplier2x = 2 }

		add_to_variable = {
			var = ANQ_beijing_anger
			value = anq_temp_beijing_anger_multiplier2x
		}
	}
}

ANQ_increase_beijing_anger_3x = {
	custom_effect_tooltip = anq_increase_qie_anger_1x
	hidden_effect = {
		set_temp_variable = { anq_temp_beijing_anger_multiplier3x = anq_anger_beijing_multiplier }
		multiply_temp_variable = { anq_temp_beijing_anger_multiplier3x = 3 }

		add_to_variable = {
			var = ANQ_beijing_anger
			value = anq_temp_beijing_anger_multiplier3x
		}
	}
}

ANQ_add_beijing_anger_effects = {
	set_temp_variable = { anq_temp_beijing_anger_product = ANQ_beijing_anger }
	set_temp_variable = { anq_temp_beijing_level = 1 }
	add_to_temp_variable = { anq_temp_beijing_level = ANQ_beijing_level }
	multiply_temp_variable = { anq_temp_beijing_anger_product = anq_temp_beijing_level }

	#50 anger, level 6 is 300
	#100 anger, level 9 is 900

	if = {
		limit = { check_variable = { anq_temp_beijing_anger_product > 400 } } #4
		if = {
			limit = { NOT = { has_idea = ANQ_beijing_angry4 } }
			set_country_flag = ANQ_beijing_more_angry
			clr_country_flag = ANQ_beijing_less_angry
			country_event = {
				id = anq.116
				days = 2
				random = 36
			}
		}
	}
	else_if = {
		limit = { check_variable = { anq_temp_beijing_anger_product > 300 } } #3
		if = {
			limit = { has_idea = ANQ_beijing_angry4 }
			set_country_flag = ANQ_beijing_less_angry
			clr_country_flag = ANQ_beijing_more_angry
			country_event = {
				id = anq.115
				days = 2
				random = 36
			}
		}
		else_if = {
			limit = { NOT = { has_idea = ANQ_beijing_angry3 } }
			set_country_flag = ANQ_beijing_more_angry
			clr_country_flag = ANQ_beijing_less_angry
			country_event = {
				id = anq.115
				days = 2
				random = 36
			}
		}
	}
	else_if = {
		limit = { check_variable = { anq_temp_beijing_anger_product > 130 } } #2
		if = {
			limit = {
				OR = {
					has_idea = ANQ_beijing_angry4
					has_idea = ANQ_beijing_angry3
				}
			}
			set_country_flag = ANQ_beijing_less_angry
			clr_country_flag = ANQ_beijing_more_angry
			country_event = {
				id = anq.114
				days = 2
				random = 36
			}
		}
		else_if = {
			limit = { NOT = { has_idea = ANQ_beijing_angry2 } }
			set_country_flag = ANQ_beijing_more_angry
			clr_country_flag = ANQ_beijing_less_angry
			country_event = {
				id = anq.114
				days = 2
				random = 36
			}
		}
	}
	else_if = {
		limit = { check_variable = { anq_temp_beijing_anger_product > 50 } } #1
		if = {
			limit = {
				OR = {
					has_idea = ANQ_beijing_angry4
					has_idea = ANQ_beijing_angry3
					has_idea = ANQ_beijing_angry2
				}
			}
			set_country_flag = ANQ_beijing_less_angry
			clr_country_flag = ANQ_beijing_more_angry
			country_event = {
				id = anq.113
				days = 2
				random = 36
			}
		}
		else_if = {
			limit = { NOT = { has_idea = ANQ_beijing_angry1 } }
			set_country_flag = ANQ_beijing_more_angry
			clr_country_flag = ANQ_beijing_less_angry
			country_event = {
				id = anq.113
				days = 2
				random = 36
			}
		}
	}
	else = {
		if = {
			limit = {
				OR = {
					has_idea = ANQ_beijing_angry4
					has_idea = ANQ_beijing_angry3
					has_idea = ANQ_beijing_angry2
					has_idea = ANQ_beijing_angry1
				}
			}
			set_country_flag = ANQ_beijing_less_angry
			clr_country_flag = ANQ_beijing_more_angry
			country_event = {
				id = anq.117
				days = 2
				random = 24
			}
		}
	}
}

ANQ_remove_fengtian_spirit = {
	hidden_effect = {
		if = {
			limit = { FNG_JAP_hostile = yes }
			if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP1
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP1
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP2
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP2
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP3
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP3
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP4
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP4
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP5
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP5
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP6
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP6
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP7
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP7
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP8
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP8
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP9
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP9
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP10
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP10
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation1
				}
				remove_ideas = ANQ_fengtian_cooperation1
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation2
				}
				remove_ideas = ANQ_fengtian_cooperation2
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation3
				}
				remove_ideas = ANQ_fengtian_cooperation3
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation4
				}
				remove_ideas = ANQ_fengtian_cooperation4
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation5
				}
				remove_ideas = ANQ_fengtian_cooperation5
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation6
				}
				remove_ideas = ANQ_fengtian_cooperation6
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation7
				}
				remove_ideas = ANQ_fengtian_cooperation7
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation8
				}
				remove_ideas = ANQ_fengtian_cooperation8
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation9
				}
				remove_ideas = ANQ_fengtian_cooperation9
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation10
				}
				remove_ideas = ANQ_fengtian_cooperation10
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation
				}
				remove_ideas = ANQ_fengtian_cooperation
			}
		}
		else = {
			if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation1
				}
				remove_ideas = ANQ_fengtian_cooperation1
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation2
				}
				remove_ideas = ANQ_fengtian_cooperation2
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation3
				}
				remove_ideas = ANQ_fengtian_cooperation3
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation4
				}
				remove_ideas = ANQ_fengtian_cooperation4
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation5
				}
				remove_ideas = ANQ_fengtian_cooperation5
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation6
				}
				remove_ideas = ANQ_fengtian_cooperation6
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation7
				}
				remove_ideas = ANQ_fengtian_cooperation7
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation8
				}
				remove_ideas = ANQ_fengtian_cooperation8
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation9
				}
				remove_ideas = ANQ_fengtian_cooperation9
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation10
				}
				remove_ideas = ANQ_fengtian_cooperation10
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperation
				}
				remove_ideas = ANQ_fengtian_cooperation
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP1
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP1
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP2
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP2
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP3
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP3
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP4
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP4
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP5
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP5
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP6
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP6
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP7
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP7
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP8
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP8
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP9
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP9
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP10
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP10
			}
			else_if = {
				limit = {
					has_idea = ANQ_fengtian_cooperationNOJAP
				}
				remove_ideas = ANQ_fengtian_cooperationNOJAP
			}
		}
	}
}

ANQ_Brotherhood_Peaceout = {
	every_country = {
		limit = {
			exists = yes
			has_war_with = ANQ
			NOT = {
			is_neighbor_of = ANQ
			}
			OR = {
				is_in_faction_with = MON
				tag = MON
			}
		}
		event_target:peace_country = { white_peace = PREV }
	}
	if = {
		limit = {
			SQI = {
				OR = {
				has_capitulated = yes
				exists = no
				}
			}
		}
		ANQ = {
			annex_country = { target = SQI transfer_troops = no }
		}
	}
}

ANQ_calculate_fengtian_level = {
	hidden_effect = {
		set_variable = { ANQ_var_fng_pop = party_popularity@market_liberal }
		if = {
			limit = {
				check_variable = {
					var = ANQ_var_fng_pop
					value = 0.50
					compare = less_than
				}
			}
			if = {
				limit = {
					check_variable = {
						var = ANQ_var_fng_pop
						value = 0.30
						compare = less_than
					}
				}
				if = {
					limit = {
						check_variable = {
							var = ANQ_var_fng_pop
							value = 0.249
							compare = greater_than
						}
					}
					set_variable = { ANQ_fengtian_level = 4 }
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_var_fng_pop
							value = 0.199
							compare = greater_than
						}
					}
					set_variable = { ANQ_fengtian_level = 3 }
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_var_fng_pop
							value = 0.149
							compare = greater_than
						}
					}
					set_variable = { ANQ_fengtian_level = 2 }
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_var_fng_pop
							value = 0.049
							compare = greater_than
						}
					}
					set_variable = { ANQ_fengtian_level = 1 }
				}
				else_if = {
					limit = {
						always = yes
					}
					set_variable = { ANQ_fengtian_level = 0 }
				}
			}
			else_if = {
				limit = {
					check_variable = {
						var = ANQ_var_fng_pop
						value = 0.40
						compare = less_than
					}
				}
				if = {
					limit = {
						check_variable = {
							var = ANQ_var_fng_pop
							value = 0.35
							compare = less_than
						}
					}
					set_variable = { ANQ_fengtian_level = 5 }
				}
				else_if = {
					limit = {
						always = yes
					}
					set_variable = { ANQ_fengtian_level = 6 }
				}
			}
			else_if = {
				limit = {
					check_variable = {
						var = ANQ_var_fng_pop
						value = 0.45
						compare = less_than
					}
				}
				set_variable = { ANQ_fengtian_level = 7 }
			}
			else_if = {
				limit = {
					always = yes
				}
				set_variable = { ANQ_fengtian_level = 8 }
			}
		}
		else_if = {
			limit = {
				check_variable = {
					var = ANQ_var_fng_pop
					value = 0.6
					compare = less_than
				}
			}
			set_variable = { ANQ_fengtian_level = 9 }
		}
		else_if = {
			limit = {
				always = yes
			}
			set_variable = { ANQ_fengtian_level = 10 }
		}
	}
}

ANQ_add_fengtian_spirit = {
	hidden_effect = {
		if = {
			limit = { NOT = { has_war_with = FNG } FNG = { exists = yes } }
			if = {
				limit = {
					check_variable = {
						var = ANQ_fengtian_level
						value = 8
						compare = less_than
					}
				}
				if = {
					limit = {
						check_variable = {
							var = ANQ_fengtian_level
							value = 4
							compare = less_than
						}
					}
					if = {
						limit = {
							check_variable = {
								var = ANQ_fengtian_level
								value = 3
								compare = equals
							}
						}
						if = {
							limit = { FNG_JAP_hostile = yes }
							add_ideas = ANQ_fengtian_cooperationNOJAP3
						}
						else = {
							add_ideas = ANQ_fengtian_cooperation3
						}
					}
					else_if = {
						limit = {
							check_variable = {
								var = ANQ_fengtian_level
								value = 2
								compare = equals
							}
						}
						if = {
							limit = { FNG_JAP_hostile = yes }
							add_ideas = ANQ_fengtian_cooperationNOJAP2
						}
						else = {
							add_ideas = ANQ_fengtian_cooperation2
						}
					}
					else_if = {
						limit = {
							check_variable = {
								var = ANQ_fengtian_level
								value = 1
								compare = equals
							}
						}
						if = {
							limit = { FNG_JAP_hostile = yes }
							add_ideas = ANQ_fengtian_cooperationNOJAP1
						}
						else = {
							add_ideas = ANQ_fengtian_cooperation1
						}
					}
					else_if = {
						limit = {
							always = yes
						}
						if = {
							limit = { FNG_JAP_hostile = yes }
							add_ideas = ANQ_fengtian_cooperationNOJAP
						}
						else = {
							add_ideas = ANQ_fengtian_cooperation
						}
					}
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_fengtian_level
							value = 6
							compare = less_than
						}
					}
					if = {
						limit = {
							check_variable = {
								var = ANQ_fengtian_level
								value = 5
								compare = equals
							}
						}
						if = {
							limit = { FNG_JAP_hostile = yes }
							add_ideas = ANQ_fengtian_cooperationNOJAP5
						}
						else = {
							add_ideas = ANQ_fengtian_cooperation5
						}
					}
					else_if = {
						limit = {
							always = yes
						}
						if = {
							limit = { FNG_JAP_hostile = yes }
							add_ideas = ANQ_fengtian_cooperationNOJAP4
						}
						else = {
							add_ideas = ANQ_fengtian_cooperation4
						}
					}
				}
				else_if = {
					limit = {
						check_variable = {
							var = ANQ_fengtian_level
							value = 6
							compare = equals
						}
					}
					if = {
						limit = { FNG_JAP_hostile = yes }
						add_ideas = ANQ_fengtian_cooperationNOJAP6
					}
					else = {
						add_ideas = ANQ_fengtian_cooperation6
					}
				}
				else_if = {
					limit = {
						always = yes
					}
					if = {
						limit = { FNG_JAP_hostile = yes }
						add_ideas = ANQ_fengtian_cooperationNOJAP7
					}
					else = {
						add_ideas = ANQ_fengtian_cooperation7
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						var = ANQ_fengtian_level
						value = 8
						compare = equals
					}
				}
				if = {
					limit = { FNG_JAP_hostile = yes }
					add_ideas = ANQ_fengtian_cooperationNOJAP8
				}
				else = {
					add_ideas = ANQ_fengtian_cooperation8
				}
			}
			else_if = {
				limit = {
					check_variable = {
						var = ANQ_fengtian_level
						value = 9
						compare = equals
					}
				}
				if = {
					limit = { FNG_JAP_hostile = yes }
					add_ideas = ANQ_fengtian_cooperationNOJAP9
				}
				else = {
					add_ideas = ANQ_fengtian_cooperation9
				}
			}
			else_if = {
				limit = {
					always = yes
				}
				if = {
					limit = { FNG_JAP_hostile = yes }
					add_ideas = ANQ_fengtian_cooperationNOJAP10
				}
				else = {
					add_ideas = ANQ_fengtian_cooperation10
				}
			}
	
			if = {
				limit = {
					check_variable = {
						var = ANQ_fengtian_level
						value = 0
						compare = greater_than
					}
	
				}
				FNG = {
					diplomatic_relation = {
						country = ANQ
						relation = docking_rights
						active = yes
					}
				}
				JAP = {
					diplomatic_relation = {
						country = ANQ
						relation = docking_rights
						active = yes
					}
				}
				if = {
					limit = {
						check_variable = {
							var = ANQ_fengtian_level
							value = 2
							compare = greater_than
						}
					}
					FNG = {
						diplomatic_relation = {
							country = ANQ
							relation = military_access
							active = yes
						}
					}
					if = {
						limit = {
							check_variable = {
								var = ANQ_fengtian_level
								value = 3
								compare = greater_than
							}
						}
						JAP = {
							diplomatic_relation = {
								country = ANQ
								relation = military_access
								active = yes
							}
						}
					}
				}
			}
		}
	}
}

ANQ_increase_kmt_unrest_level = {
	if = {
		limit = {
			check_variable = {
				var = anq_kmt_unrest_level
				value = 3
				compare = less_than
			}
			check_variable = {
				var = anq_kmt_unrest_level
				value = -1
				compare = greater_than
			}
		}
		add_to_variable = { anq_kmt_unrest_level = 1 }
	}
	set_variable = { anq_suppress_kmt_mission_timeout = 90 }
	set_temp_variable = { anq_temp_mission_calc_k = 20 }
	multiply_temp_variable = { anq_temp_mission_calc_k = anq_kmt_unrest_level }
	subtract_from_variable = { anq_suppress_kmt_mission_timeout = anq_temp_mission_calc_k }
}
ANQ_decrease_kmt_unrest_level = {
	if = {
		limit = {
			check_variable = {
				var = anq_kmt_unrest_level
				value = 4
				compare = less_than
			}
			check_variable = {
				var = anq_kmt_unrest_level
				value = -1
				compare = greater_than
			}
		}
		add_to_variable = { anq_kmt_unrest_level = -1 }
	}
	set_variable = { anq_suppress_kmt_mission_timeout = 90 }
	set_temp_variable = { anq_temp_mission_calc_k = 20 }
	multiply_temp_variable = { anq_temp_mission_calc_k = anq_kmt_unrest_level }
	subtract_from_variable = { anq_suppress_kmt_mission_timeout = anq_temp_mission_calc_k }
}
ANQ_increase_yiguandao_unrest_level = {
	if = {
		limit = {
			check_variable = {
				var = anq_yiguandao_unrest_level
				value = 2
				compare = less_than
			}
			check_variable = {
				var = anq_yiguandao_unrest_level
				value = -1
				compare = greater_than
			}
		}
		add_to_variable = { anq_yiguandao_unrest_level = 1 }
	}
	set_variable = { anq_suppress_yiguandao_mission_timeout = 90 }
	set_temp_variable = { anq_temp_mission_calc_y = 20 }
	multiply_temp_variable = { anq_temp_mission_calc_y = anq_kmt_unrest_level }
	subtract_from_variable = { anq_suppress_yiguandao_mission_timeout = anq_temp_mission_calc_y }
}
ANQ_decrease_yiguandao_unrest_level = {
	if = {
		limit = {
			check_variable = {
				var = anq_yiguandao_unrest_level
				value = 3
				compare = less_than
			}
			check_variable = {
				var = anq_yiguandao_unrest_level
				value = -1
				compare = greater_than
			}
		}
		add_to_variable = { anq_yiguandao_unrest_level = -1 }
	}
	set_variable = { anq_suppress_yiguandao_mission_timeout = 90 }
	set_temp_variable = { anq_temp_mission_calc_y = 20 }
	multiply_temp_variable = { anq_temp_mission_calc_y = anq_kmt_unrest_level }
	subtract_from_variable = { anq_suppress_yiguandao_mission_timeout = anq_temp_mission_calc_y }
}
ANQ_negative_kmt_event = {
	set_variable = { anq_kmt_attack_location = random }
	multiply_variable = { anq_kmt_attack_location = 10 }
	set_variable = { anq_attack_adder_temp_kmt = anq_kmt_unrest_level }
	multiply_temp_variable = { anq_attack_adder_temp_kmt = 3 }
	add_to_variable = { anq_kmt_attack_location = anq_attack_adder_temp_kmt }

	set_variable = { anq_kmt_attack_type_seed = random }

	if = {
		limit = {
			check_variable = {
				var = anq_kmt_attack_type_seed
				value = 0.6
				compare = less_than
			}
		}
		set_temp_variable = { anq_kmt_attack_category = 0 }
		#gunfight
	}
	else_if = {
		limit = { always = yes }
		set_temp_variable = { anq_kmt_attack_category = 1 }
		#bombing
	}

	set_temp_variable = { anq_attack_adder_temp_kmt = anq_kmt_unrest_level }
	multiply_temp_variable = { anq_attack_adder_temp_kmt = 3 }
	add_to_temp_variable = { anq_attack_adder_temp_kmt = 10 }
	multiply_variable = { anq_kmt_attack_type_seed = anq_attack_adder_temp_kmt }
	#between 0 and 19

	if = {
		#major
		limit = {
			check_variable = { anq_kmt_attack_type_seed > 13 }
		}
		if = { limit = { check_variable = { anq_kmt_attack_category = 0 } }
			#battle
			country_event = {
				id = anq.47
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { check_variable = { anq_kmt_attack_type_seed < 15 } }
				#series of bombings, train
				country_event = {
					id = anq.48
					days = 5
					random = 96
				}
			}
			else_if = { limit = { always = yes }
				#series of bombings, factories
				country_event = {
					id = anq.49
					days = 5
					random = 96
				}
			}
		}
	}
	else_if = {
		#medium
		limit = {
			check_variable = { anq_kmt_attack_type_seed > 8 }
		}
		if = { limit = { check_variable = { anq_kmt_attack_category = 0 } }
			#gunfight
			country_event = {
				id = anq.45
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			#heavy factory bomb
			country_event = {
				id = anq.46
				days = 5
				random = 96
			}
		}
	}
	else_if = {
		#minor2
		limit = {
			check_variable = { anq_kmt_attack_type_seed > 5 }
		}
		if = { limit = { check_variable = { anq_kmt_attack_category = 0 } }
			#assassination
			country_event = {
				id = anq.43
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			#factory bomb
			country_event = {
				id = anq.44
				days = 5
				random = 96
			}
		}
	}
	else_if = {
		#minor
		limit = { always = yes }
		if = { limit = { check_variable = { anq_kmt_attack_category = 0 } }
			#ambush
			country_event = {
				id = anq.41
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			#railway bomb
			country_event = {
				id = anq.42
				days = 5
				random = 96
			}
		}
	}
}

ANQ_negative_yiguandao_event = {
	set_variable = { anq_yiguandao_attack_location = random }
	multiply_variable = { anq_yiguandao_attack_location = 10 }
	set_temp_variable = { anq_attack_adder_temp_y = anq_yiguandao_unrest_level }
	multiply_temp_variable = { anq_attack_adder_temp_y = 3 }
	add_to_variable = { anq_yiguandao_attack_location = anq_attack_adder_temp_y }

	set_variable = { anq_yiguandao_attack_type_seed = random }

	if = {
		limit = {
			check_variable = {
				var = anq_yiguandao_attack_type_seed
				value = 0.6
				compare = less_than
			}
		}
		set_temp_variable = { anq_yiguandao_attack_category = 0 }
		#gunfight
	}
	else_if = {
		limit = { always = yes }
		set_temp_variable = { anq_yiguandao_attack_category = 1 }
		#bombing
	}

	set_temp_variable = { anq_attack_adder_temp_y = anq_yiguandao_unrest_level }
	multiply_temp_variable = { anq_attack_adder_temp_y = 3 }
	add_to_temp_variable = { anq_attack_adder_temp_y = 10 }
	multiply_variable = { anq_yiguandao_attack_type_seed = anq_attack_adder_temp_y }
	#multiplies by 10-16

	#between 0 and 16

	if = {
		#major
		limit = {
			check_variable = { anq_yiguandao_attack_type_seed > 13 }
		}
		if = { limit = { check_variable = { anq_yiguandao_attack_category = 0 } }
			#railway occupation
			country_event = {
				id = anq.56
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			#army clashes
			country_event = {
				id = anq.57
				days = 5
				random = 96
			}
		}
	}
	else_if = {
		#medium
		limit = {
			check_variable = { anq_yiguandao_attack_type_seed > 8 }
		}
		if = { limit = { check_variable = { anq_yiguandao_attack_category = 0 } }
			#barracks attack
			country_event = {
				id = anq.54
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			#town assault
			country_event = {
				id = anq.55
				days = 5
				random = 96
			}
		}
	}
	else_if = {
		#minor
		limit = { always = yes }
		if = { limit = { check_variable = { anq_yiguandao_attack_category = 0 } }
			#opium storage attack
			country_event = {
				id = anq.51
				days = 5
				random = 96
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { check_variable = { anq_yiguandao_attack_type_seed > 4 } }
				#assault on caravan
				country_event = {
					id = anq.52
					days = 5
					random = 96
				}
			}
			else_if = { limit = { always = yes }
				#patrol attack
				country_event = {
					id = anq.53
					days = 5
					random = 96
				}
			}
		}
	}
}

anq_recalculate_chens_credibility = {
	clamp_variable = {
		var = credibility_factor
		min = 0
		max = 150
	}
	### Set up the various subfactors of the dynamic modifier
	set_variable = {
		var = credibility_factor_dynamic_modifier_pol_gain
		value = credibility_factor
	}
	set_variable = {
		var = credibility_factor_dynamic_modifier_stab
		value = credibility_factor
	}
	set_variable = {
		var = credibility_factor_dynamic_modifier_org
		value = credibility_factor
	}
	set_variable = {
		var = credibility_factor_dynamic_modifier_recruitable_pop
		value = credibility_factor
	}

	### Calculate final values
	subtract_from_variable = {
		var = credibility_factor_dynamic_modifier_pol_gain
		value = 50
	}
	divide_variable = {
		var = credibility_factor_dynamic_modifier_pol_gain
		value = 200
	}
	subtract_from_variable = {
		var = credibility_factor_dynamic_modifier_stab
		value = 70
	}
	divide_variable = {
		var = credibility_factor_dynamic_modifier_stab
		value = 400
	}

	if = {
		limit = {
			check_variable = {
				credibility_factor_dynamic_modifier_org > 50
			}
		}
		set_variable = {
			credibility_factor_dynamic_modifier_org = 0
		}
	}
	else = {
		subtract_from_variable = {
			var = credibility_factor_dynamic_modifier_org
			value = 60
		}
		divide_variable = {
			var = credibility_factor_dynamic_modifier_org
			value = 80
		}
	}
	if = {
		limit = {
			check_variable = {
				credibility_factor_dynamic_modifier_recruitable_pop > 50
			}
		}
		set_variable = {
			credibility_factor_dynamic_modifier_recruitable_pop = 0
		}
	}
	else = {
		subtract_from_variable = {
			var = credibility_factor_dynamic_modifier_recruitable_pop
			value = 60
		}
		divide_variable = {
			var = credibility_factor_dynamic_modifier_recruitable_pop
			value = 80
		}
	}
}

ANQ_reduce_derelict_industry = {
	if = {
		limit = {
			has_idea = ANQ_derelict_industry
		}
		swap_ideas = {
			remove_idea = ANQ_derelict_industry
			add_idea = ANQ_derelict_industry1
		}
	}
	else_if = {
		limit = {
			has_idea = ANQ_derelict_industry1
		}
		swap_ideas = {
			remove_idea = ANQ_derelict_industry1
			add_idea = ANQ_derelict_industry2
		}
	}
	else_if = {
		limit = {
			has_idea = ANQ_derelict_industry2
		}
		swap_ideas = {
			remove_idea = ANQ_derelict_industry2
			add_idea = ANQ_derelict_industry3
		}
	}
	else_if = {
		limit = {
			has_idea = ANQ_derelict_industry3
		}
		remove_ideas = ANQ_derelict_industry3
		if = {
			limit = {
				has_country_flag = ANQ_fixed_destruction
			}
			country_event = {
				id = anq.180
				days = 1
			}
			clr_country_flag = ANQ_fixed_destruction
		}
		else = {
			set_country_flag = ANQ_fixed_industry
		}
	}
}

ANQ_reduce_widespread_destruction = {
	if = {
		limit = {
			has_idea = ANQ_widespread_destruction
		}
		swap_ideas = {
			remove_idea = ANQ_widespread_destruction
			add_idea = ANQ_widespread_destruction1
		}
	}
	else_if = {
		limit = {
			has_idea = ANQ_widespread_destruction1
		}
		swap_ideas = {
			remove_idea = ANQ_widespread_destruction1
			add_idea = ANQ_widespread_destruction2
		}
	}
	else_if = {
		limit = {
			has_idea = ANQ_widespread_destruction2
		}
		remove_ideas = ANQ_widespread_destruction2
		if = {
			limit = {
				has_country_flag = ANQ_fixed_industry
			}
			country_event = {
				id = anq.180
				days = 1
			}
			clr_country_flag = ANQ_fixed_industry
		}
		else = {
			set_country_flag = ANQ_fixed_destruction
		}
	}
}

ANQ_break_relations_japan = {
	hidden_effect = {
		clr_country_flag = ANQ_friendly_japan
		diplomatic_relation = {
			country = JAP
			relation = docking_rights
			active = no
		}
		diplomatic_relation = {
			country = JAP
			relation = military_access
			active = no
		}
		JAP = {
			if = {
				limit = {
					has_idea = JAP_ANQ_Reconstruction_Plan
				}
				remove_ideas = JAP_ANQ_Reconstruction_Plan
			}
			diplomatic_relation = {
				country = ANQ
				relation = docking_rights
				active = no
			}
			diplomatic_relation = {
				country = ANQ
				relation = military_access
				active = no
			}
		}
	}
}

ANQ_break_relations_fengtian = {
	hidden_effect = {
		if = {
			limit = {
				has_idea = ANQ_reconstruction_plan
			}
			remove_ideas = ANQ_reconstruction_plan
		}
		else_if = {
			limit = {
				has_idea = ANQ_reconstruction_plan1
			}
			remove_ideas = ANQ_reconstruction_plan1
		}
		if = {
			limit = {
				NOT = { has_country_flag = ANQ_reclamation_decided }
			}
			set_country_flag = ANQ_reclamation_decided
		}
		set_country_flag = ANQ_chen_alone
		set_country_flag = FNG_hostile
		clr_country_flag = ANQ_is_profengtian
		clr_country_flag = ANQ_commits_reclamation
		ANQ_remove_fengtian_spirit = yes
		if = {
			limit = { has_completed_focus = ANQ_reconstruction_cooperation }
			add_to_variable = {
				var = anq_reconstruction_decision_cost?30
				value = 5
			}
			add_to_variable = {
				var = anq_reconstruction_decision_time?80
				value = 10
			}
		}
		diplomatic_relation = {
			country = FNG
			relation = docking_rights
			active = no
		}
		diplomatic_relation = {
			country = FNG
			relation = military_access
			active = no
		}
		FNG = {
			if = {
				limit = {
					has_idea = FNG_ANQ_Reconstruction_Plan
				}
				remove_ideas = FNG_ANQ_Reconstruction_Plan
			}
			diplomatic_relation = {
				country = ANQ
				relation = guarantee
				active = no
			}
			diplomatic_relation = {
				country = ANQ
				relation = docking_rights
				active = no
			}
			diplomatic_relation = {
				country = ANQ
				relation = military_access
				active = no
			}
		}
	}
	ANQ_break_relations_japan = yes
}
