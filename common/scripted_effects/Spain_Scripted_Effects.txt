SPR_opposing_side_effect_1 = {
	decrease_ruling_party_popularity_by_3 = yes
	random_list = {
		70 = {
			add_political_power = -10
			add_stability = -0.01
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.05
			}
		}
		30 = {
			add_political_power = -30
			add_stability = -0.02
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.1
			}
		}
	}
}

SPR_opposing_side_effect_2 = {
	decrease_ruling_party_popularity_by_5 = yes
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.01
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.05
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.02
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.02
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.05
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.05
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.02
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.02
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.05
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.03
		}
	}
	random_list = {
		60 = {
			add_political_power = -25
			add_stability = -0.03
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.07
			}
		}
		40 = {
			add_political_power = -50
			add_stability = -0.06
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.14
			}
		}
	}
}

SPR_opposing_side_effect_3 = {
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.04
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.06
		}
	}
	
	random_list = {
		50 = {
			add_political_power = -65
			add_stability = -0.05
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.1
			}
		}
		50 = {
			add_political_power = -80
			add_stability = -0.1
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.2
			}
		}
	}
}

SPR_opposing_side_effect_4 = {
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.07
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.13
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.1
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.07
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.13
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.13
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.07
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.07
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.13
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.1
		}
	}
	random_list = {
		25 = {
			add_political_power = -100
			add_stability = -0.1
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.15
			}
		}
		75 = {
			add_political_power = -120
			add_stability = -0.2
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.3
			}
		}
	}
}

SPR_civil_war_prelude_setup = {
	set_country_flag = SPR_civil_war_unavoidable
	end_coalition = yes
	if = {
		limit = {
			has_idea = SPR_social_breakdown
		}
		swap_ideas = {
			remove_idea = SPR_social_breakdown
			add_idea = SPR_social_breakdown_civil_war_unavoidable
		}
	}
	if = {
		limit = {
			has_idea = SPR_social_breakdown_2
		}
		swap_ideas = {
			remove_idea = SPR_social_breakdown_2
			add_idea = SPR_social_breakdown_civil_war_unavoidable
		}
	}
	if = {
		limit = {
			has_idea = SPR_social_breakdown_3
		}
		swap_ideas = {
			remove_idea = SPR_social_breakdown_3
			add_idea = SPR_social_breakdown_civil_war_unavoidable
		}
	}
	remove_power_balance = {
		id = SPR_burning_house_of_cards
	}
	every_owned_state = {
		limit = {
			has_state_flag = is_car_state
		}
		CAR = { add_state_core = PREV }
		set_demilitarized_zone = yes
	}
	every_state = {
		limit = {
			is_claimed_by = CAR
		}
		CAR = { remove_state_claim = PREV }
	}
	every_owned_state = {
		limit = {
			has_state_flag = is_cnt_state
		}
		CNT = { add_state_core = PREV }
		set_demilitarized_zone = yes
	}
	every_state = {
		limit = {
			is_claimed_by = CNT
		}
		CNT = { remove_state_claim = PREV }
	}
	every_state = {
		limit = {
			is_core_of = SPR
			OR = {
				is_core_of = CAR
				is_core_of = CNT
			}
		}
		SPR = { 
			remove_state_core = PREV
			add_state_claim = PREV
		}
	}
}
SPR_civil_war_start_effect = {
	set_global_flag = spanish_civil_war
	if = {
		limit = {
			SPR = { exists = yes }
		}
		SPR = {
			if = {
				limit = {
					CAR = { exists = yes }
					SPR = { NOT = { has_war_with = CAR } }
				}
				declare_war_on = {
					target = CAR
					type = annex_everything
				}
			}
			if = {
				limit = {
					CNT = { exists = yes }
					SPR = { NOT = { has_war_with = CNT } }
				}
				declare_war_on = {
					target = CNT
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CAR
					NOT = { is_core_of = SPR }
				}
				SPR = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = CNT
					NOT = { is_core_of = SPR }
				}
				SPR = { add_state_claim = PREV }
			}
			if = {
				limit = {
					has_idea = SPR_black_monday
				}
				set_variable = { SPR_bm_readd_after_cw_var = 1 }
			}
			else_if = {
				limit = {
					has_idea = SPR_black_monday_2
				}
				set_variable = { SPR_bm_readd_after_cw_var = 2 }
			}
			else_if = {
				limit = {
					has_idea = SPR_black_monday_3
				}
				set_variable = { SPR_bm_readd_after_cw_var = 3 }
			}
			else_if = {
				limit = {
					has_idea = SPR_black_monday_4
				}
				set_variable = { SPR_bm_readd_after_cw_var = 4 }
			}
		}
	}
	if = {
		limit = {
			CNT = { exists = yes }
		}
		CNT = {
			if = {
				limit = {
					CAR = { exists = yes }
					CNT = { NOT = { has_war_with = CAR } }
				}
				declare_war_on = {
					target = CAR
					type = annex_everything
				}
			}
			if = {
				limit = {
					SPR = { exists = yes }
					CNT = { NOT = { has_war_with = SPR } }
				}
				declare_war_on = {
					target = SPR
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CAR
					NOT = { is_core_of = CNT }
				}
				CNT = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = SPR
					NOT = { is_core_of = CNT }
				}
				CNT = { add_state_claim = PREV }
			}
		}
	}
	if = {
		limit = {
			CAR = { exists = yes }
		}
		CAR = {
			if = {
				limit = {
					CNT = { exists = yes }
					CAR = { NOT = { has_war_with = CNT } }
				}
				declare_war_on = {
					target = CNT
					type = annex_everything
				}
			}
			if = {
				limit = {
					SPR = { exists = yes }
					CAR = { NOT = { has_war_with = SPR } }
				}
				declare_war_on = {
					target = SPR
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CNT
					NOT = { is_core_of = CAR }
				}
				CAR = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = SPR
					NOT = { is_core_of = CAR }
				}
				CAR = { add_state_claim = PREV }
			}
		}
	}
}

CAR_setup_effect = {
	CAR = {
		every_state = {
			limit = {
				has_state_flag = is_car_state
			}
			set_demilitarized_zone = no
			CAR = {
				transfer_state = PREV
			}
		}
		load_oob = "SCW_CAR"
		if = {
			limit = {
				is_ai = yes
				OR = {
					SPR = {
						is_ai = no
					}
					CNT = {
						is_ai = no
					}
				}
			}
			hidden_effect = {
				load_oob = SCW_CAR_reinforce1
			}
		}
		inherit_technology = SPR
		add_equipment_to_stockpile = {
			type = infantry_equipment_1
			amount = 2000
			producer = ITA
		}
		add_opinion_modifier = {
			target = ITA
			modifier = supports_us_civil_war_2
		}
		add_opinion_modifier = {
			target = AUS
			modifier = supports_us_civil_war_1
		}
		add_opinion_modifier = {
			target = POR
			modifier = supports_us_civil_war_1
		}
		add_opinion_modifier = {
			target = GER
			modifier = against_us_civil_war_1
		}
		reverse_add_opinion_modifier = {
			target = GER
			modifier = against_carlist_1
		}
		if = {
			limit = {
				owns_state = 176
			}
			set_capital = { state = 176 }
		}
		if = {
			limit = {
				country_exists = CNT
				NOT = {
					has_war_with = CNT
				}
			}
			random_other_country = {
				limit = {
					NOT = {
						tag = CNT
					}
					NOT = {
						tag = SPR
					}
				}
				news_event = {
					id = worldnews.4
					days = 1
				}
			}
			country_event = {
				id = worldtension.4
				days = 1
			}
			country_event = { id = sprc.121 days = 15 }
		}
		add_ideas = extensive_conscription
		set_cosmetic_tag = CAR_PROV_GOV
	}
	SPR = {
		add_popularity = {
			ideology = paternal_autocrat
			popularity = -0.5
		}
		add_popularity = {
			ideology = national_populist
			popularity = -0.5
		}
	}
}

CNT_setup_effect = {
	CNT = {
		every_state = {
			limit = {
				has_state_flag = is_cnt_state
			}
			set_demilitarized_zone = no
			CNT = {
				transfer_state = PREV
			}
		}
		load_oob = "SCW_CNT"
		if = {
			limit = {
				is_ai = yes
				OR = {
					SPR = {
						is_ai = no
					}
					CAR = {
						is_ai = no
					}
				}
			}
			load_oob = SCW_CNT_reinforce1
		}
		inherit_technology = SPR
		add_equipment_to_stockpile = {
			type = infantry_equipment_1
			amount = 2000
			producer = FRA
		}
		add_opinion_modifier = {
			target = ITA
			modifier = against_us_civil_war_2
		}
		reverse_add_opinion_modifier = {
			target = ITA
			modifier = against_cntfai_2
		}
		add_opinion_modifier = {
			target = GER
			modifier = against_us_civil_war_1
		}
		reverse_add_opinion_modifier = {
			target = GER
			modifier = against_cntfai_1
		}
		add_opinion_modifier = {
			target = FRA
			modifier = supports_us_civil_war_2
		}
		add_opinion_modifier = {
			target = ENG
			modifier = supports_us_civil_war_1
		}
		add_opinion_modifier = {
			target = SRI
			modifier = supports_us_civil_war_1
		}
		country_event = { id = sprc.207 days = 7 }
		country_event = { id = sprc.208 days = 15  }
		FRA = {
			country_event = {
				id = comfrance.22
				days = 7
			}
			country_event = {
				id = sprf.17
				days = 14
			}
		}
		if = {
			limit = {
				owns_state = 165
			}
			set_capital = { state = 165 }
		}
		if = {
			limit = {
				country_exists = CAR
				NOT = {
					has_war_with = CAR
				}
			}
			random_other_country = {
				limit = {
					NOT = {
						tag = CAR
					}
					NOT = {
						tag = SPR
					}
				}
				news_event = {
					id = worldnews.4
					days = 1
				}
			}
			country_event = { id = sprc.121 days = 15 random_days = 20 }
		}
		add_ideas = extensive_conscription
		set_cosmetic_tag = CNT_PROV_GOV
	}
	SPR = {
		add_popularity = {
			ideology = totalist
			popularity = -0.5
		}
		add_popularity = {
			ideology = syndicalist
			popularity = -0.5
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = -0.3
		}
	}
}

CAT_revolt_during_scw_effect = {
	set_temp_variable = {
		temp_owner = var:165.owner
	}
	every_state = {
		limit = {
			AND = {
				is_core_of = CAT
				NOT = {
					state = 167
				}
			}
		}
		CAT = {
			transfer_state = PREV
		}
	}
	CAT = {
		set_cosmetic_tag = CAT_PROV_GOV
		declare_war_on = {
			target = temp_owner
			type = annex_everything
		}
	}
}

SPR_switch_to_CNT_effect = {
	CNT = {
		inherit_technology = SPR
		every_state = {
			limit = {
				is_core_of = SPR
			}
			CNT = {
				add_state_core = PREV
			}
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			CNT = {
				add_state_claim = PREV
			}
		}
		annex_country = {
			target = SPR
			transfer_troops = yes
		}
		set_capital = { state = 41 }
		set_cosmetic_tag = CNT_PROV_GOV
		set_popularities = {
			totalist = 4
			radical_socialist = 23
			syndicalist = 34
			social_democrat = 11
			social_liberal = 3
			market_liberal = 2
			social_conservative = 7
			authoritarian_democrat = 11
			paternal_autocrat = 3
			national_populist = 2
		}
		change_tag_from = SPR
	}
}

SPR_switch_to_CAR_effect = {
	CAR = {
		inherit_technology = SPR
		every_state = {
			limit = {
				is_core_of = SPR
			}
			CAR = {
				add_state_core = PREV
			}
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			CAR = {
				add_state_claim = PREV
			}
		}
		annex_country = {
			target = SPR
			transfer_troops = yes
		}
		set_capital = { state = 41 }
		set_cosmetic_tag = CAR_PROV_GOV
		set_popularities = {
			totalist = 3
			radical_socialist = 1
			syndicalist = 4
			social_democrat = 5
			social_liberal = 2
			market_liberal = 5
			social_conservative = 5
			authoritarian_democrat = 17
			paternal_autocrat = 51
			national_populist = 7
		}
		complete_national_focus = CAR_election_success
		change_tag_from = SPR
	}
}

SPR_equatorial_guinea_stolen_effect = {
	var:539.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	var:927.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	var:952.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	random_scope_in_array = {
		array = temp_countries
		break = break
		limit = {
			exists = yes
			NOT = { is_ally_with = SPR }
		}
		297 = {
			transfer_state_to = PREV
			remove_claim_by = PREV
			add_core_of = PREV
		}
	}
}

SPR_bm_intro_latin_america_center_effect = {
	every_country = {
		limit = {
			OR = {
				is_in_south_america = yes
				is_in_central_america = yes
				capital_scope = {
					is_core_of = MEX
				}
			}
			NOT = {
				OR = {
					tag = BRA
					has_communist_government = yes
					has_socialist_government = yes
					has_colonial_government = yes
					is_subject = yes
				}
			}
		}
		THIS = {
			country_event = {
				id = sprd.1192
				days = 4
			}
		}
	}
}

SPR_bm_intro_latin_america_left_effect = {
	every_country = {
		limit = {
			OR = {
				is_in_south_america = yes
				is_in_central_america = yes
				capital_scope = {
					is_core_of = MEX
				}
			}
			NOT = {
				OR = {
					tag = BRA
					has_communist_government = yes
					has_colonial_government = yes
					has_dictatorship_government = yes
					is_subject = yes
				}
			}
		}
		THIS = {
			country_event = {
				id = sprd.1192
				days = 4
			}
		}
	}
}

SPR_intro_debug_activate_opposing_side_mission = {
	activate_mission = SPR_bop_opposing_side_does_something_mission
}

SPR_remove_separatist_effect = {
	every_state = {
		limit = {
			has_dynamic_modifier = { modifier = SPR_catalan_nationalists }
		}
		remove_dynamic_modifier = { modifier = SPR_catalan_nationalists }
	}
	every_state = {
		limit = {
			has_dynamic_modifier = { modifier = SPR_basque_nationalists }
		}
		remove_dynamic_modifier = { modifier = SPR_basque_nationalists }
	}
	every_state = {
		limit = {
			has_dynamic_modifier = { modifier = SPR_galicia_nationalists }
		}
		remove_dynamic_modifier = { modifier = SPR_galicia_nationalists }
	}
	remove_ideas = SPR_Rising_Separatism
}

SPR_setup_state_modifiers = {
	every_state = {
		limit = {
			OR = {
				state = 1313
			}
		}
		add_dynamic_modifier = { modifier = SPR_andorra_modifier }
	}
	every_state = {
		limit = {
			OR = {
				state = 165
				state = 1313
			}
		}
		add_dynamic_modifier = { modifier = SPR_catalan_nationalists }
	}
	every_state = {
		limit = {
			OR = {
				state = 172
				state = 1334
			}
		}
		add_dynamic_modifier = { modifier = SPR_basque_nationalists }
	}
	every_state = {
		limit = {
			OR = {
				state = 171
			}
		}
		add_dynamic_modifier = { modifier = SPR_galicia_nationalists }
	}
}

SPR_general_setup = {
	set_country_flag = rad_socs_arent_syndie
	set_variable = {
		var = SPR_opposing_side_progress_var
		value = 0
	}
	set_variable = {
		var = SPR_opposing_side_progress_time_var
		value = 60
	}
	every_owned_state = {
		limit = {
			OR = {
				state = 171
				state = 172
				state = 174
				state = 176
				state = 793
			}
		}
		set_state_flag = is_car_state
	}
	every_owned_state = {
		limit = {
			OR = {
				state = 165
				state = 166
				state = 167
				state = 168
				state = 940
				state = 1313
			}
		}
		set_state_flag = is_cnt_state
	}
	add_opinion_modifier = {
		target = USA
		modifier = SPR_legacy_of_1898
	}
}

SPR_scw_black_monday_replace_current = {
	if = {
		limit = {
			has_idea = SPR_black_monday
		}
		set_variable = { SPR_scw_bm_progress = 1 }
		swap_ideas = {
			remove_idea = SPR_black_monday
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_2
		}
		set_variable = { SPR_scw_bm_progress = 2 }
		swap_ideas = {
			remove_idea = SPR_black_monday_2
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_3
		}
		set_variable = { SPR_scw_bm_progress = 3 }
		swap_ideas = {
			remove_idea = SPR_black_monday_3
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_4
		}
		set_variable = { SPR_scw_bm_progress = 4 }
		swap_ideas = {
			remove_idea = SPR_black_monday_4
			add_idea = SPR_black_monday_scw
		}
	}
}

SPR_scw_black_monday_readd_old = {
	if = {
		limit = {
			check_variable = { SPR_scw_bm_progress = 1 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday
		}
	}
	else_if = {
		limit = {
			check_variable = { SPR_scw_bm_progress = 2 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_2
		}
	}
	else_if = {
		limit = {
			check_variable = { SPR_scw_bm_progress = 3 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_3
		}
	}
	else_if = {
		limit = {
			check_variable = { SPR_scw_bm_progress = 4 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_4
		}
	}
}

SPR_scw_kingdom_party_popularites_change_effect = {
	set_temp_variable = { temp_radsoc_pop = party_popularity@radical_socialist }
	set_temp_variable = { temp_socdem_pop = party_popularity@social_democrat }
	set_temp_variable = { temp_soclib_pop = party_popularity@social_liberal }
	set_temp_variable = { temp_marlib_pop = party_popularity@market_liberal }
	set_temp_variable = { temp_soccon_pop = party_popularity@social_conservative }
	set_temp_variable = { temp_authdem_pop = party_popularity@authoritarian_democrat }
	set_popularities = {
		totalist = 0
		radical_socialist = 5
		syndicalist = 0
		social_democrat = 6
		social_liberal = 12
		market_liberal = 17
		social_conservative = 10
		authoritarian_democrat = 50
		paternal_autocrat = 0
		national_populist = 0
	}
	add_popularity = {
		ideology = radical_socialist
		popularity = temp_radsoc_pop
	}
	add_popularity = {
		ideology = social_democrat
		popularity = temp_socdem_pop
	}
	add_popularity = {
		ideology = social_liberal
		popularity = temp_soclib_pop
	}
	add_popularity = {
		ideology = market_liberal
		popularity = temp_marlib_pop
	}
	add_popularity = {
		ideology = social_conservative
		popularity = temp_soccon_pop
	}
	add_popularity = {
		ideology = authoritarian_democrat
		popularity = temp_authdem_pop
	}
}