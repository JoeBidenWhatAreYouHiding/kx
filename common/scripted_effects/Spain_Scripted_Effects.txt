SPR_general_setup = {
	set_country_flag = rad_socs_arent_syndie
	#############
	# Var Setup #
	#############
	
	# Civil War #
	
	set_variable = {
		var = SPR_opposing_side_progress_time_var
		value = 60
	}
	set_variable = {
		var = civil_war_countdown_length_var
		value = 30
	}
	set_variable = {
		var = SPR.SPR_Gov_Influence
		value = 0.35
	}
	set_variable = {
		var = SPR.SPR_Neither_Influence
		value = 0.00
	}
	set_variable = {
		var = SPR.SPR_Opposing_Influence
		value = 0.325
	}
	set_variable = {
		var = SPR.SPR_Ally_Influence
		value = 0.325
	}
	
	# Nerd Council #
	
	set_variable = {
		var = SPR.SPR_nerd_council_research_speed_factor_set
		value = 0.075
	}
	set_variable = {
		var = SPR.SPR_nerd_council_research_sharing_per_country_bonus_factor_set
		value = 0.1
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_xp_gain_factor_set
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_research_bonus_factor_set
		value = 0.15
	}
	set_variable = {
		var = SPR.SPR_nerd_council_production_speed_buildings_factor_set
		value = 0.00
	}
	
	SPR_nerd_council_setup = yes
	
	# Army Modifier #
	
	SPR_spanish_army_setup = yes
	
	# Everything else #
	
	every_owned_state = {
		limit = {
			OR = {
				state = 171
				state = 172
				state = 174
				state = 176
				state = 793
				state = 1338
				state = 1339
				state = 1344
			}
		}
		set_state_flag = is_car_state
	}
	set_variable = { SPR.num_of_car_states_cleared = 0 }
	set_variable = { SPR.num_of_total_car_states_at_start = 6 }
	every_owned_state = {
		limit = {
			OR = {
				state = 165
				state = 166
				state = 167
				state = 168
				state = 940
				state = 1313
			}
		}
		set_state_flag = is_cnt_state
	}
	set_variable = { SPR.num_of_cnt_states_cleared = 0 }
	set_variable = { SPR.num_of_total_cnt_states_at_start = 3 } #3 because andorra is handled within the Catalonia decision
	add_opinion_modifier = {
		target = USA
		modifier = SPR_legacy_of_1898
	}
}

SPR_nerd_council_setup = {
	set_variable = {
		var = SPR.SPR_nerd_council_research_speed_factor
		value = SPR.SPR_nerd_council_research_speed_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_research_sharing_per_country_bonus_factor
		value = SPR.SPR_nerd_council_research_sharing_per_country_bonus_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_xp_gain_factor
		value = SPR.SPR_nerd_council_scientist_xp_gain_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_research_bonus_factor
		value = SPR.SPR_nerd_council_scientist_research_bonus_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_production_speed_buildings_factor
		value = SPR.SPR_nerd_council_production_speed_buildings_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_civilian_factory_use
		value = 3
	}
	set_variable = {
		var = SPR.SPR_nerd_council_nuclear_production_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_war_support_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_equipment_upgrade_xp_cost
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_experience_gain_army_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_experience_gain_navy_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_navy_max_range_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_navy_org_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_experience_gain_air_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_air_range_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_air_superiority_efficiency
		value = 0.0
	}
}

SPR_spanish_army_setup = {
	# Army #
	set_variable = {
		var = SPR.SPR_EdT_army_core_attack_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_EdT_army_core_defence_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_EdT_land_reinforce_rate
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_terrain_penalty_reduction
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_morale_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_war_support_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_infantry_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_artillery_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_artillery_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_dig_in_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_breakthrough_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_fortification_damage
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_combat_width_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_recon_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_offence
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_max_planning
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_planning_speed
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_experience_gain_army
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_conscription_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_attrition
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_org_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_org_regain
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_acclimatization_hot_climate_gain_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_special_forces_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_special_forces_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_supply_consumption_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_org_loss_when_moving
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_cavalry_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_cavalry_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_breakthrough_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_fortification_damage
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_motorized_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_motorized_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_mechanized_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_armor_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_river_crossing_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_land_night_attack
		value = 0
	}
	# Air #
	set_variable = {
		var = SPR.SPR_ANE_air_ace_generation_chance_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_doctrine_cost_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_accidents_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_attack_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_defence_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_fuel_consumption_factor
		value = -0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_agility_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_mission_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_maximum_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_range_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_intercept_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_cas_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_ground_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_production_speed_air_base_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_cas_damage_reduction
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_army_bonus_air_superiority_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_enemy_army_bonus_air_superiority_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_experience_gain_air
		value = 0
	}
	# Navy #
	set_variable = {
		var = SPR.SPR_AE_naval_hit_chance
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_AE_naval_critical_score_chance_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_navy_screen_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_navy_capital_ship_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_refit_speed
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_AE_refit_ic_cost
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_morale_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_coordination
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_navy_carrier_air_targetting_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_convoy_escort_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_invasion_capacity
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_invasion_prep_speed
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_production_speed_naval_base_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_production_speed_dockyard_factor
		value = 0.05
	}
}

SPR_setup_state_modifiers = {
	every_state = {
		limit = {
			OR = {
				state = 1313
			}
		}
		add_dynamic_modifier = { modifier = SPR_andorra_modifier }
	}
	every_state = {
		limit = {
			OR = {
				state = 118
			}
		}
		add_dynamic_modifier = { modifier = SPR_gibraltar_modifier }
	}
	every_state = {
		limit = {
			OR = {
				state = 165
				state = 1313
			}
		}
		add_dynamic_modifier = { modifier = SPR_catalan_nationalists }
	}
	every_state = {
		limit = {
			OR = {
				state = 172
			}
		}
		add_dynamic_modifier = { modifier = SPR_basque_nationalists }
	}
	every_state = {
		limit = {
			OR = {
				state = 171
			}
		}
		add_dynamic_modifier = { modifier = SPR_galicia_nationalists }
	}
}

SPR_left_kingdom_intro_setup_effect = {
	hidden_effect = {
		unlock_national_focus = SPR_An_Unlikely_Alliance
		unlock_national_focus = SPR_the_darkest_monday
		end_coalition = yes
		set_power_balance = {
			id = SPR_burning_house_of_cards
			left_side = SPR_leftcenter_side
			right_side = SPR_right_side
			set_value = 0.08
		}
		activate_mission = SPR_bop_opposing_side_does_something_mission
		set_country_flag = SPR_left_kingdom_intro
		set_country_flag = SPR_influence_gui_visible
		mark_focus_tree_layout_dirty = yes
		set_variable = {
			var = SPR.SPR_Gov_Influence
			value = 0.30
		}
		set_variable = {
			var = SPR.SPR_Neither_Influence
			value = 0.00
		}
		set_variable = {
			var = SPR.SPR_Opposing_Influence
			value = 0.40
		}
		set_variable = {
			var = SPR.SPR_Ally_Influence
			value = 0.30
		}
	}	
	add_popularity = {
		ideology = syndicalist
		popularity = 0.1
	}
	add_popularity = {
		ideology = radical_socialist
		popularity = 0.05
	}
	add_popularity = {
		ideology = social_democrat
		popularity = 0.075
	}
	add_popularity = {
		ideology = social_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = social_conservative
		popularity = 0.025
	}
	add_ideas = SPR_left_kingdom_intro_idea
}

SPR_center_kingdom_intro_setup_effect = {
	hidden_effect = {
		unlock_national_focus = SPR_Walk_The_Storm_Alone
		unlock_national_focus = SPR_the_darkest_monday
		end_coalition = yes
		set_power_balance = {
			id = SPR_burning_house_of_cards
			left_side = SPR_center_side
			right_side = SPR_leftright_side
			set_value = 0.15
		}
		set_variable = { SPR_opposing_side_progress_time_var = 55 }
		activate_mission = SPR_bop_opposing_side_does_something_mission
		set_country_flag = SPR_center_kingdom_intro
		mark_focus_tree_layout_dirty = yes
	}
	add_popularity = {
		ideology = social_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = market_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = authoritarian_democrat
		popularity = 0.05
	}
	add_popularity = {
		ideology = social_conservative
		popularity = 0.025
	}
	add_ideas = SPR_center_kingdom_intro_idea
}

SPR_right_kingdom_intro_setup_effect = {
	hidden_effect = {
		unlock_national_focus = SPR_a_plea_for_the_nationalist
		unlock_national_focus = SPR_the_darkest_monday
		end_coalition = yes
		set_power_balance = {
			id = SPR_burning_house_of_cards
			left_side = SPR_rightcenter_side
			right_side = SPR_left_side
			set_value = 0.08
		}
		activate_mission = SPR_bop_opposing_side_does_something_mission
		set_country_flag = SPR_right_kingdom_intro
		set_country_flag = SPR_influence_gui_visible
		mark_focus_tree_layout_dirty = yes
		set_variable = {
			var = SPR.SPR_Gov_Influence
			value = 0.30
		}
		set_variable = {
			var = SPR.SPR_Neither_Influence
			value = 0.00
		}
		set_variable = {
			var = SPR.SPR_Opposing_Influence
			value = 0.40
		}
		set_variable = {
			var = SPR.SPR_Ally_Influence
			value = 0.30
		}
	}
	add_popularity = {
		ideology = market_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = authoritarian_democrat
		popularity = 0.05
	}
	add_popularity = {
		ideology = paternal_autocrat
		popularity = 0.025
	}
	add_ideas = SPR_right_kingdom_intro_idea
}

SPR_left_republic_intro_setup_effect = {
	hidden_effect = {
		end_coalition = yes
		set_country_flag = SPR_left_republic_intro
		mark_focus_tree_layout_dirty = yes
		set_variable = {
			var = civil_war_prelude_countdown_length_var
			value = 300
		}
		activate_mission = SPR_civil_war_prelude_countdown
	}
	add_ideas = SPR_Leftist_Fury
}

SPR_right_republic_intro_setup_effect = {
	hidden_effect = {
		end_coalition = yes
		set_country_flag = SPR_right_republic_intro
		mark_focus_tree_layout_dirty = yes
		set_variable = {
			var = civil_war_prelude_countdown_length_var
			value = 300
		}
		activate_mission = SPR_civil_war_prelude_countdown
	}
	add_ideas = SPR_Rightist_Fury
}

SPR_bop_finale_setup = {
	clr_country_flag = SPR_all_car_states_cleared
	clr_country_flag = SPR_all_cnt_states_cleared
	set_country_flag = SPR_bop_finale_flag
	set_variable = {
		var = SPR.SPR_Neither_Influence
		value = SPR.SPR_Opposing_Influence
	}
	remove_power_balance = {
		id = SPR_burning_house_of_cards
	}
	every_state = {
		limit = {
			OR = {
				has_state_flag = is_car_state
				has_state_flag = is_cnt_state
			}
		}
		set_demilitarized_zone = no
		set_demilitarized_zone = yes
	}
}
SPR_allied_influence_calc_effect = {
	clamp_variable = {
		var = SPR.SPR_Gov_Influence
		min = 0
		max = 1
	}
	clamp_variable = {
		var = SPR.SPR_Neither_Influence
		min = 0
		max = 1
	}
	clamp_variable = {
		var = SPR.SPR_Ally_Influence
		min = 0
		max = 1
	}
	clamp_variable = {
		var = SPR.SPR_Opposing_Influence
		min = 0
		max = 1
	}
	add_to_temp_variable = { combined_influence = SPR.SPR_Gov_Influence }
	add_to_temp_variable = { combined_influence = SPR.SPR_Ally_Influence }
	if = {
		limit = {
			SPR_bop_finale_trigger = yes
		}
		add_to_temp_variable = { combined_influence = SPR.SPR_Neither_Influence }
	}
	else = {
		add_to_temp_variable = { combined_influence = SPR.SPR_Opposing_Influence }
	}
	log = "[?combined_influence]"
	subtract_from_temp_variable = { combined_influence = 1 }
	if = {
		limit = {
			OR = {
				check_variable = { combined_influence < 0 }
				check_variable = { combined_influence > 0 }
			}
		}
		divide_temp_variable = { combined_influence = 3 }
		log = "[?combined_influence]"
		subtract_from_variable = { SPR.SPR_Ally_Influence = combined_influence }
		subtract_from_variable = { SPR.SPR_Gov_Influence = combined_influence }
		if = {
			limit = {
				SPR_bop_finale_trigger = yes
			}
			subtract_from_variable = { SPR.SPR_Neither_Influence = combined_influence }
		}
		else = {
			subtract_from_variable = { SPR.SPR_Opposing_Influence = combined_influence }
		}
	}
	if = {
		limit = {
			SPR_bop_finale_trigger = yes
		}
		SPR_motion_of_no_confidence_vote_calc = yes
	}
}

SPR_motion_of_no_confidence_vote_calc = {
	clr_country_flag = SPR_motion_of_no_confidence_vote_will_win
	clr_country_flag = SPR_motion_of_no_confidence_vote_will_fail
	add_to_temp_variable = { ally_vote = SPR.SPR_Ally_Influence }
	divide_temp_variable = { ally_vote = 4 }
	multiply_temp_variable = { ally_vote = 3 }
	add_to_temp_variable = { neither_vote = SPR.SPR_Neither_Influence }
	divide_temp_variable = { neither_vote = 2 }
	add_to_temp_variable = { gov_vote = SPR.SPR_Gov_Influence }
	divide_temp_variable = { gov_vote = 4 }
	multiply_temp_variable = { gov_vote = 3 }
	subtract_from_variable = { vote_result = gov_vote }
	add_to_temp_variable = { vote_result = neither_vote }
	add_to_temp_variable = { vote_result = ally_vote }
	
	log = "SPR_motion_of_no_confidence_vote_calc effect results:"
	log = "ally_vote: [?ally_vote]"
	log = "neither_vote: [?neither_vote]"
	log = "gov_vote: [?gov_vote]"
	log = "final vote result: [?vote_result]"
	
	if = {
		limit = {
			check_variable = { vote_result > 0.65 }
		}
		set_country_flag = SPR_motion_of_no_confidence_vote_will_win
	}
	else_if = {
		limit = {
			check_variable = { vote_result < 0.65 }
		}
		set_country_flag = SPR_motion_of_no_confidence_vote_will_fail
	}
}

SPR_opposing_side_effect_1 = {
	decrease_ruling_party_popularity_by_3 = yes
	random_list = {
		70 = {
			add_political_power = -10
			add_stability = -0.01
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.05
			}
		}
		30 = {
			add_political_power = -30
			add_stability = -0.02
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.1
			}
		}
	}
}

SPR_opposing_side_effect_2 = {
	decrease_ruling_party_popularity_by_5 = yes
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.01
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.05
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.02
		}
		951 = {
			custom_effect_tooltip = new_car_state_tt
			hidden_effect = {
				set_state_flag = is_car_state
				add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.02
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.05
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.05
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.02
		}
		random_list = {
			50 = {
				1343 = {
					custom_effect_tooltip = new_cnt_state_tt
					hidden_effect = {
						set_state_flag = is_cnt_state
						add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
					}
				}
			}
			50 = {
				951 = {
					custom_effect_tooltip = new_car_state_tt
					hidden_effect = {
						set_state_flag = is_car_state
						add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
					}
				}
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.02
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.05
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.03
		}
		1343 = {
			custom_effect_tooltip = new_cnt_state_tt
			hidden_effect = {
				set_state_flag = is_cnt_state
				add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
			}
		}
	}
	random_list = {
		60 = {
			add_political_power = -25
			add_stability = -0.03
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.07
			}
		}
		40 = {
			add_political_power = -50
			add_stability = -0.06
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.14
			}
		}
	}
}

SPR_opposing_side_effect_3 = {
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
		if = {
			limit = {
				951 = { has_state_flag = is_car_state }
			}
			170 = {
				custom_effect_tooltip = new_car_state_tt
				hidden_effect = {
					set_state_flag = is_car_state
					add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
				}
			}
		}
		else = {
			951 = {
				custom_effect_tooltip = new_car_state_tt
				hidden_effect = {
					set_state_flag = is_car_state
					add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
				}
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.04
		}
		random_list = {
			50 = {
				if = {
					limit = {
						1343 = { has_state_flag = is_cnt_state }
					}
					795 = {
						custom_effect_tooltip = new_cnt_state_tt
						hidden_effect = {
							set_state_flag = is_cnt_state
							add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
						}
					}
					177 = {
						custom_effect_tooltip = new_cnt_state_tt
						hidden_effect = {
							set_state_flag = is_cnt_state
							add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
						}
					}
				}
				else = {
					1343 = {
						custom_effect_tooltip = new_cnt_state_tt
						hidden_effect = {
							set_state_flag = is_cnt_state
							add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
						}
					}
				}
			}
			50 = {
				if = {
					limit = {
						951 = { has_state_flag = is_car_state }
					}
					170 = {
						custom_effect_tooltip = new_car_state_tt
						hidden_effect = {
							set_state_flag = is_car_state
							add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
						}
					}
				}
				else = {
					951 = {
						custom_effect_tooltip = new_car_state_tt
						hidden_effect = {
							set_state_flag = is_car_state
							add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
						}
					}
				}
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.06
		}
		795 = {
			custom_effect_tooltip = new_cnt_state_tt
			hidden_effect = {
				set_state_flag = is_cnt_state
				add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
			}
		}
		177 = {
			custom_effect_tooltip = new_cnt_state_tt
			hidden_effect = {
				set_state_flag = is_cnt_state
				add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
			}
		}
	}
	
	random_list = {
		50 = {
			add_political_power = -65
			add_stability = -0.05
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.1
			}
		}
		50 = {
			add_political_power = -80
			add_stability = -0.1
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.2
			}
		}
	}
}

SPR_opposing_side_effect_4 = {
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.06
		}
	}
	random_list = {
		25 = {
			add_political_power = -100
			add_stability = -0.1
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.1
			}
		}
		75 = {
			add_political_power = -120
			add_stability = -0.2
			add_power_balance_value = {
				id = SPR_burning_house_of_cards
				value = 0.15
			}
		}
	}
}

SPR_scw_black_monday_replace_current = {
	remove_ideas = SPR_no_food_mierda
	if = {
		limit = {
			has_idea = SPR_black_monday
		}
		set_variable = { global.SPR_scw_bm_progress = 1 }
		swap_ideas = {
			remove_idea = SPR_black_monday
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_2
		}
		set_variable = { global.SPR_scw_bm_progress = 2 }
		swap_ideas = {
			remove_idea = SPR_black_monday_2
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_3
		}
		set_variable = { global.SPR_scw_bm_progress = 3 }
		swap_ideas = {
			remove_idea = SPR_black_monday_3
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_4
		}
		set_variable = { global.SPR_scw_bm_progress = 4 }
		swap_ideas = {
			remove_idea = SPR_black_monday_4
			add_idea = SPR_black_monday_scw
		}
	}
	else = {
		add_ideas = SPR_black_monday_scw
	}
}

SPR_scw_black_monday_readd_old = {
	if = {
		limit = {
			NOT = { has_idea = SPR_no_food_mierda }
		}
		add_ideas = SPR_no_food_mierda
	}
	if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 1 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday
		}
	}
	else_if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 2 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_2
		}
	}
	else_if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 3 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_3
		}
	}
	else_if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 4 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_4
		}
	}
	else = {
		remove_ideas = SPR_black_monday_scw
	}
}

SPR_civil_war_kingdom_debuffs_setup = {
	end_coalition = yes
	remove_ideas = {
		SPR_left_kingdom_intro_idea
		SPR_center_kingdom_intro_idea
		SPR_right_kingdom_intro_idea
		SPR_Rising_Separatism
		SPR_Leftist_Fury
		SPR_Left_Shadow_Government
		SPR_Rightist_Fury
		SPR_Right_Shadow_Government
		SPR_social_breakdown
		SPR_social_breakdown_2
		SPR_social_breakdown_3
		SPR_memories_of_the_republic
		SPR_Scars_of_98
	}
	remove_power_balance = {
		id = SPR_burning_house_of_cards
	}
	
	add_ideas = SPR_social_breakdown_civil_war_unavoidable
	
	SPR_scw_black_monday_replace_current = yes
}

SPR_civil_war_prelude_setup = {
	SPR_civil_war_kingdom_debuffs_setup = yes
	if = {
		limit = {
			has_allied_with_anyone_kingdom = yes
		}
		set_country_flag = SPR_civil_war_unavoidable
	}
	if = {
		limit = {
			NOT = { has_country_flag = SCW_no_CNT }
		}
		SPR_civil_war_CNT_prelude_setup = yes
	}
	if = {
		limit = {
			NOT = { has_country_flag = SCW_no_CAR }
		}
		SPR_civil_war_CAR_prelude_setup = yes
	}
}
SPR_civil_war_CAR_prelude_setup = {
	every_state = {
		limit = {
			has_state_flag = is_car_state
		}
		set_demilitarized_zone = no
		CAR = { add_state_core = PREV }
	}
	every_state = {
		limit = {
			is_claimed_by = CAR
		}
		CAR = { remove_state_claim = PREV }
	}
	every_state = {
		limit = {
			has_state_flag = is_car_state
			NOT = { state = 172 }
		}
		set_demilitarized_zone = yes
	}
	CAR = {
		if = {
			limit = {
				SPR = { has_country_flag = SPR_carlism_chose_carlos }
			}
			CAR_setup_carlos_VIII = yes
		}
		set_cosmetic_tag = CAR_REV_BASQUE
		transfer_state = 172
		inherit_technology = SPR
		division_template = {
			name = "Guardia Carlista"
			priority = 10
			template_counter = 0
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
			}
			support = {
				artillery = { x = 0 y = 0 }
			}
		}
		172 = {
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Guardia Carlista\" start_experience_factor = 0.1"
				owner = CAR
				id = 14
				count = 4
			}
		}
		if = {
			limit = {
				has_country_flag = CAR_Navarra_Brigades
			}
			division_template = {
				name = "Brigadas de Navarra"
				priority = 9
				template_counter = 0
				is_locked = yes
				division_cap = 6
				regiments = {
					elite_infantry = { x = 0 y = 0 }
					elite_infantry = { x = 0 y = 1 }
					elite_infantry = { x = 0 y = 2 }
					elite_infantry = { x = 1 y = 0 }
					elite_infantry = { x = 1 y = 1 }
					elite_infantry = { x = 1 y = 2 }
				}
				support = {
					artillery = { x = 0 y = 0 }
				}
			}
			172 = {
				create_unit = {
					division = "name = \"Brigada de Navarra\" division_template = \"Brigadas de Navarra\" start_experience_factor = 0.25"
					owner = CAR
					id = 14
					count = 4
				}
			}
		}
		add_opinion_modifier = {
			target = SPR
			modifier = KR_hostile
		}
		reverse_add_opinion_modifier = {
			target = SPR
			modifier = KR_hostile
		}
		if = {
			limit = {
				CNT = { exists = yes }
			}
			add_opinion_modifier = {
				target = CNT
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = CNT
				modifier = KR_hostile
			}
		}
		if = {
			limit = {
				SPR = {
					has_country_flag = SPR_right_republic_intro
					is_ai = no
				}
			}
			change_tag_from = SPR
		}
	}
	every_state = {
		limit = {
			is_core_of = SPR
			is_core_of = CAR
		}
		SPR = {
			remove_state_core = PREV
			add_state_claim = PREV
		}
	}
}
SPR_civil_war_CNT_prelude_setup = {
	every_state = {
		limit = {
			has_state_flag = is_cnt_state
		}
		CNT = { add_state_core = PREV }
		set_demilitarized_zone = no
	}
	every_state = {
		limit = {
			is_claimed_by = CNT
		}
		CNT = { remove_state_claim = PREV }
	}
	every_state = {
		limit = {
			has_state_flag = is_cnt_state
			NOT = { state = 165 }
			NOT = { state = 1313 }
		}
		set_demilitarized_zone = yes
	}
	every_state = {
		limit = {
			is_core_of = SPR
			is_core_of = CNT
		}
		SPR = {
			remove_state_core = PREV
			add_state_claim = PREV
		}
	}
	CNT = {
		set_cosmetic_tag = CNT_REV_CATALONIA
		transfer_state = 165
		transfer_state = 1313
		inherit_technology = SPR
		division_template = {
			name = "Milicia Popular Revolucionaria"
			priority = 10
			template_counter = 0
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
			}
			support = {
				artillery = { x = 0 y = 0 }
			}
		}
		165 = {
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Milicia Popular Revolucionaria\" start_experience_factor = 0.1"
				owner = CNT
				id = 16
				count = 3
			}
		}
		1313 = {
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Milicia Popular Revolucionaria\" start_experience_factor = 0.2"
				owner = CNT
				id = 16
				count = 1
			}
		}
		if = {
			limit = {
				has_country_flag = CNT_French_Support
			}
			army_experience = 50
			every_unit_leader = {
				limit = { has_id = 47590 }
				set_nationality = CNT
			}
			every_unit_leader = {
				limit = { has_id = 47591 }
				set_nationality = CNT
			}
			add_opinion_modifier = {
				target = FRA
				modifier = KR_pleased
			}
		}
		add_opinion_modifier = {
			target = SPR
			modifier = KR_hostile
		}
		reverse_add_opinion_modifier = {
			target = SPR
			modifier = KR_hostile
		}
		if = {
			limit = {
				CAR = { exists = yes }
			}
			add_opinion_modifier = {
				target = CAR
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = CAR
				modifier = KR_hostile
			}
		}
		if = {
			limit = {
				SPR = {
					has_country_flag = SPR_left_republic_intro
					is_ai = no
				}
			}
			change_tag_from = SPR
		}
	}
}
SPR_civil_war_start_effect = {
	set_global_flag = spanish_civil_war
	set_global_flag = spanish_civil_war_happened
	if = {
		limit = {
			SPR = { exists = yes }
		}
		SPR = {
			swap_ideas = {
				remove_idea = SPR_social_breakdown_civil_war_unavoidable
				add_idea = SPR_civil_war_idea
			}
			if = {
				limit = {
					CAR = { exists = yes }
					SPR = { NOT = { has_war_with = CAR } }
				}
				declare_war_on = {
					target = CAR
					type = annex_everything
				}
			}
			if = {
				limit = {
					CNT = { exists = yes }
					SPR = { NOT = { has_war_with = CNT } }
				}
				declare_war_on = {
					target = CNT
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CAR
					NOT = { is_core_of = SPR }
				}
				SPR = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = CNT
					NOT = { is_core_of = SPR }
				}
				SPR = { add_state_claim = PREV }
			}
		}
	}
	if = {
		limit = {
			CNT = { exists = yes }
		}
		CNT = {
			if = {
				limit = {
					CAR = { exists = yes }
					CNT = { NOT = { has_war_with = CAR } }
				}
				declare_war_on = {
					target = CAR
					type = annex_everything
				}
			}
			if = {
				limit = {
					SPR = { exists = yes }
					CNT = { NOT = { has_war_with = SPR } }
				}
				declare_war_on = {
					target = SPR
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CAR
					NOT = { is_core_of = CNT }
				}
				CNT = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = SPR
					NOT = { is_core_of = CNT }
				}
				CNT = { add_state_claim = PREV }
			}
		}
	}
	if = {
		limit = {
			CAR = { exists = yes }
		}
		CAR = {
			if = {
				limit = {
					CNT = { exists = yes }
					CAR = { NOT = { has_war_with = CNT } }
				}
				declare_war_on = {
					target = CNT
					type = annex_everything
				}
			}
			if = {
				limit = {
					SPR = { exists = yes }
					CAR = { NOT = { has_war_with = SPR } }
				}
				declare_war_on = {
					target = SPR
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CNT
					NOT = { is_core_of = CAR }
				}
				CAR = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = SPR
					NOT = { is_core_of = CAR }
				}
				CAR = { add_state_claim = PREV }
			}
		}
	}
}
SRR_civil_war_end_effect = {
	clr_global_flag = spanish_civil_war
	SPR_scw_black_monday_readd_old = yes
	mark_focus_tree_layout_dirty = yes
	if = {
		limit = {
			tag = SPR
		}
		set_country_flag = aftermath_of_the_civil_war
		remove_power_balance = {
			id = SPR_burning_house_of_cards
		}
		set_party_name = {
			ideology = authoritarian_democrat
			name = SPR_authoritarian_democrat_party
			long_name = SPR_authoritarian_democrat_party_long
		}
		set_party_name = {
			ideology = paternal_autocrat
			name = SPR_paternal_autocrat_party
			long_name = SPR_paternal_autocrat_party_long
		}
		if = {
			limit = {
				has_idea = SPR_center_kingdom_intro_idea
			}
			swap_ideas = {
				add_idea = SPR_center_kingdom_intro_idea_stable_spain
				remove_idea = SPR_center_kingdom_intro_idea
			}
		}
	}
	if = {
		limit = {
			tag = CNT
		}
		if = {
			limit = {
				has_country_flag = CNT_French_Support
			}
			every_unit_leader = {
				limit = { has_id = 47590 }
				set_nationality = FRA
			}
			every_unit_leader = {
				limit = { has_id = 47591 }
				set_nationality = FRA
			}
		}
	}
	remove_ideas = {
		SPR_left_kingdom_intro_idea
		SPR_right_kingdom_intro_idea
		SPR_civil_war_idea
	}
	delete_unit_template_and_units = {
		division_template = "Guardia Carlista"
		disband = yes
	}
	delete_unit_template_and_units = {
		division_template = "Brigadas de Navarra"
		disband = yes
	}
	delete_unit_template_and_units = {
		division_template = "Milicia Popular Revolucionaria"
		disband = yes
	}
}
CAR_setup_effect = {
	CAR = {
		every_state = {
			limit = {
				has_state_flag = is_car_state
			}
			set_demilitarized_zone = no
			CAR = {
				transfer_state = PREV
			}
		}
		add_equipment_to_stockpile = {
			type = infantry_equipment_1
			amount = 2000
			producer = ITA
		}
		add_opinion_modifier = {
			target = ITA
			modifier = supports_us_civil_war_2
		}
		add_opinion_modifier = {
			target = AUS
			modifier = supports_us_civil_war_1
		}
		add_opinion_modifier = {
			target = POR
			modifier = supports_us_civil_war_1
		}
		add_opinion_modifier = {
			target = GER
			modifier = against_us_civil_war_1
		}
		reverse_add_opinion_modifier = {
			target = GER
			modifier = against_carlist_1
		}
		if = {
			limit = {
				owns_state = 1344
			}
			set_capital = { state = 1344 }
		}
		if = {
			limit = {
				country_exists = CNT
				NOT = {
					has_war_with = CNT
				}
			}
			random_other_country = {
				limit = {
					NOT = {
						tag = CNT
					}
					NOT = {
						tag = SPR
					}
				}
				news_event = {
					id = worldnews.4
					days = 1
				}
			}
			country_event = {
				id = worldtension.4
				days = 1
			}
			country_event = { id = sprc.121 days = 15 }
		}
		add_ideas = extensive_conscription
		set_cosmetic_tag = CAR_PROV_GOV
		
		for_each_scope_loop = {
			array = CAR.owned_controlled_states
			limit = {
				NOT = { state = 172 }
			}
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Guardia Carlista\" start_experience_factor = 0.1"
				owner = CAR
				count = 2
				id = 14
			}
		}
		
		if = {
			limit = {
				has_country_flag = CAR_No_Regionalists
			}
			every_owned_state = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_catalan_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_catalan_nationalists }
			}
			every_owned_state = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_basque_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_basque_nationalists }
			}
			every_owned_state = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_galicia_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_galicia_nationalists }
			}
		}
	}
	SPR = {
		if = {
			limit = {
				NOT = { has_country_flag = SPR_SCW_Sanjurjo_Kingdom }
			}
			add_popularity = {
				ideology = paternal_autocrat
				popularity = -0.5
			}
		}
		add_popularity = {
			ideology = national_populist
			popularity = -0.5
		}
	}
}

CAR_setup_carlos_VIII = {
	CAR = {
		set_politics = {
			ruling_party = national_populist
			last_election = "1888.6.15"
			election_frequency = 48
			elections_allowed = no
		}
		set_popularities = {
			totalist = 0
			radical_socialist = 0
			syndicalist = 0
			social_democrat = 3
			social_liberal = 3
			market_liberal = 7
			social_conservative = 0
			authoritarian_democrat = 10
			paternal_autocrat = 17
			national_populist = 60
		}
		add_ideas = {
			CAR_Jesus_Cora_y_Lira_hog_npo
			CAR_Jose_Luis_Arrese_Magra_for_pau
			CAR_Joaquin_Bau_Nolla_eco_npo
			CAR_Jose_Luis_Arrese_Magra_sec_pau
		}
		random_unit_leader = {
			limit = { has_id = 3110 }			
			remove_unit_leader = yes
		}
		create_field_marshal = { #Auto-Generated
			name = "Carlos VIII"
			portrait_path = "gfx/leaders/CAR/Portrait_CAR_Carlos_VIII.png"
			traits = {
				media_personality
				trait_reckless
				inspirational_leader
			}
			skill = 1
			attack_skill = 1
			defense_skill = 1
			planning_skill = 1
			logistics_skill = 1
		}
	}
}

CNT_setup_effect = {
	CNT = {
		every_state = {
			limit = {
				has_state_flag = is_cnt_state
			}
			set_demilitarized_zone = no
			CNT = {
				transfer_state = PREV
			}
		}
		add_equipment_to_stockpile = {
			type = infantry_equipment_1
			amount = 2000
			producer = FRA
		}
		add_opinion_modifier = {
			target = ITA
			modifier = against_us_civil_war_2
		}
		reverse_add_opinion_modifier = {
			target = ITA
			modifier = against_cntfai_2
		}
		add_opinion_modifier = {
			target = GER
			modifier = against_us_civil_war_1
		}
		reverse_add_opinion_modifier = {
			target = GER
			modifier = against_cntfai_1
		}
		add_opinion_modifier = {
			target = FRA
			modifier = supports_us_civil_war_2
		}
		add_opinion_modifier = {
			target = ENG
			modifier = supports_us_civil_war_1
		}
		add_opinion_modifier = {
			target = SRI
			modifier = supports_us_civil_war_1
		}
		country_event = { id = sprc.207 days = 7 }
		country_event = { id = sprc.208 days = 15  }
		FRA = {
			country_event = {
				id = comfrance.22
				days = 7
			}
			country_event = {
				id = sprf.17
				days = 14
			}
		}
		if = {
			limit = {
				owns_state = 165
			}
			set_capital = { state = 165 }
		}
		if = {
			limit = {
				country_exists = CAR
				NOT = {
					has_war_with = CAR
				}
			}
			random_other_country = {
				limit = {
					NOT = {
						tag = CAR
					}
					NOT = {
						tag = SPR
					}
				}
				news_event = {
					id = worldnews.4
					days = 1
				}
			}
			country_event = { id = sprc.121 days = 15 random_days = 20 }
		}
		add_ideas = extensive_conscription
		if = {
			limit = {
				has_country_flag = CNT_Add_Anarchy_Idea_On_Civil_War_Start
			}
			add_ideas = CNT_SCW_we_love_anarchy
		}
		set_cosmetic_tag = CNT_PROV_GOV
		end_coalition = yes
		if = {
			limit = {
				has_country_flag = popular_front_on_start_flag
			}
			add_soccon_to_coalition = yes
			add_marlib_to_coalition = yes
			add_soclib_to_coalition = yes
			add_socdem_to_coalition = yes
		}
		add_radsoc_to_coalition = yes
		add_synd_to_coalition = yes
		add_tot_to_coalition = yes
		
		for_each_scope_loop = {
			array = CNT.owned_controlled_states
			limit = {
				NOT = { state = 165 }
				NOT = { state = 1313 }
			}
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Milicia Popular Revolucionaria\" start_experience_factor = 0.1"
				owner = CNT
				id = 16
				count = 2
			}
		}
	}
	SPR = {
		add_popularity = {
			ideology = totalist
			popularity = -0.5
		}
		add_popularity = {
			ideology = syndicalist
			popularity = -0.5
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = -0.3
		}
	}
}

CAT_revolt_during_scw_effect = {
	set_temp_variable = {
		temp_owner = var:165.owner
	}
	every_state = {
		limit = {
			AND = {
				is_core_of = CAT
				NOT = {
					state = 167
				}
			}
		}
		CAT = {
			transfer_state = PREV
		}
	}
	CAT = {
		set_cosmetic_tag = CAT_PROV_GOV
		declare_war_on = {
			target = temp_owner
			type = annex_everything
		}
	}
}

SPR_switch_to_CNT_effect = { #For if the left wins the power struggle after stablizing spain
	CNT = {
		inherit_technology = SPR
		every_state = {
			limit = {
				is_core_of = SPR
			}
			CNT = {
				add_state_core = PREV
			}
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			CNT = {
				add_state_claim = PREV
			}
		}
		annex_country = {
			target = SPR
			transfer_troops = yes
		}
		set_capital = { state = 41 }
		set_cosmetic_tag = CNT_PROV_GOV
		set_country_flag = CNT_coup_after_scw_avoided
		set_popularities = {
			totalist = 4
			radical_socialist = 23
			syndicalist = 34
			social_democrat = 11
			social_liberal = 3
			market_liberal = 2
			social_conservative = 7
			authoritarian_democrat = 11
			paternal_autocrat = 3
			national_populist = 2
		}
		change_tag_from = SPR
	}
}

SPR_switch_to_CAR_effect = { #For if the right wins the power struggle after stablizing spain
	CAR = {
		inherit_technology = SPR
		every_state = {
			limit = {
				is_core_of = SPR
			}
			CAR = {
				add_state_core = PREV
			}
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			CAR = {
				add_state_claim = PREV
			}
		}
		annex_country = {
			target = SPR
			transfer_troops = yes
		}
		set_capital = { state = 41 }
		set_cosmetic_tag = CAR_PROV_GOV
		set_country_flag = CAR_coup_after_scw_avoided
		set_popularities = {
			totalist = 3
			radical_socialist = 1
			syndicalist = 4
			social_democrat = 5
			social_liberal = 2
			market_liberal = 5
			social_conservative = 5
			authoritarian_democrat = 17
			paternal_autocrat = 51
			national_populist = 7
		}
		complete_national_focus = CAR_election_success
		change_tag_from = SPR
	}
}

SPR_equatorial_guinea_stolen_effect = {
	var:539.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	var:927.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	var:952.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	random_scope_in_array = {
		array = temp_countries
		break = break
		limit = {
			exists = yes
			NOT = { is_ally_with = SPR }
		}
		297 = {
			transfer_state_to = PREV
			remove_claim_by = PREV
			add_core_of = PREV
		}
	}
}

SPR_bm_intro_latin_america_center_effect = {
	every_country = {
		limit = {
			OR = {
				is_in_south_america = yes
				is_in_central_america = yes
				capital_scope = {
					is_core_of = MEX
				}
			}
			NOT = {
				OR = {
					tag = BRA
					has_communist_government = yes
					has_socialist_government = yes
					has_colonial_government = yes
					is_subject = yes
				}
			}
		}
		THIS = {
			country_event = {
				id = sprd.1192
				days = 4
			}
		}
	}
}

SPR_bm_intro_latin_america_left_effect = {
	every_country = {
		limit = {
			OR = {
				is_in_south_america = yes
				is_in_central_america = yes
				capital_scope = {
					is_core_of = MEX
				}
			}
			NOT = {
				OR = {
					tag = BRA
					has_communist_government = yes
					has_colonial_government = yes
					has_dictatorship_government = yes
					is_subject = yes
				}
			}
		}
		THIS = {
			country_event = {
				id = sprd.1192
				days = 4
			}
		}
	}
}

SPR_remove_separatist_effect = {
	every_state = {
		limit = {
			has_dynamic_modifier = { modifier = SPR_catalan_nationalists }
		}
		remove_dynamic_modifier = { modifier = SPR_catalan_nationalists }
	}
	every_state = {
		limit = {
			has_dynamic_modifier = { modifier = SPR_basque_nationalists }
		}
		remove_dynamic_modifier = { modifier = SPR_basque_nationalists }
	}
	every_state = {
		limit = {
			has_dynamic_modifier = { modifier = SPR_galicia_nationalists }
		}
		remove_dynamic_modifier = { modifier = SPR_galicia_nationalists }
	}
	remove_ideas = SPR_Rising_Separatism
}

SPR_scw_kingdom_party_popularites_change_effect = {
	set_temp_variable = { temp_radsoc_pop = party_popularity@radical_socialist }
	set_temp_variable = { temp_socdem_pop = party_popularity@social_democrat }
	set_temp_variable = { temp_soclib_pop = party_popularity@social_liberal }
	set_temp_variable = { temp_marlib_pop = party_popularity@market_liberal }
	set_temp_variable = { temp_soccon_pop = party_popularity@social_conservative }
	set_temp_variable = { temp_authdem_pop = party_popularity@authoritarian_democrat }
	set_temp_variable = { temp_pataut_pop = party_popularity@paternal_autocrat }
	clamp_temp_variable = {
		var = temp_authdem_pop
		max = 0.2
	}
	clamp_temp_variable = {
		var = temp_pataut_pop
		max = 0.2
	}
	if = {
		limit = {
			has_country_flag = SPR_SCW_Sanjurjo_Kingdom
		}
		set_popularities = {
			totalist = 0
			radical_socialist = 5
			syndicalist = 0
			social_democrat = 6
			social_liberal = 12
			market_liberal = 17
			social_conservative = 10
			authoritarian_democrat = 20
			paternal_autocrat = 30
			national_populist = 0
		}
	}
	else = {
		set_popularities = {
			totalist = 0
			radical_socialist = 5
			syndicalist = 0
			social_democrat = 6
			social_liberal = 12
			market_liberal = 17
			social_conservative = 10
			authoritarian_democrat = 50
			paternal_autocrat = 0
			national_populist = 0
		}
	}
	add_popularity = {
		ideology = radical_socialist
		popularity = temp_radsoc_pop
	}
	add_popularity = {
		ideology = social_democrat
		popularity = temp_socdem_pop
	}
	add_popularity = {
		ideology = social_liberal
		popularity = temp_soclib_pop
	}
	add_popularity = {
		ideology = market_liberal
		popularity = temp_marlib_pop
	}
	add_popularity = {
		ideology = social_conservative
		popularity = temp_soccon_pop
	}
	if = {
		limit = {
			has_country_flag = SPR_SCW_Sanjurjo_Kingdom
			paternal_autocrat < 0.4
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = temp_pataut_pop
		}
	}
	else = {
		add_popularity = {
			ideology = authoritarian_democrat
			popularity = temp_authdem_pop
		}
	}
}

SPR_economy_focus_idea_upgrade = {
	if = {
		limit = {
			has_idea = SPR_economy_focus_4
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_5
			remove_idea = SPR_economy_focus_4
		}
	}
	if = {
		limit = {
			has_idea = SPR_economy_focus_3
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_4
			remove_idea = SPR_economy_focus_3
		}
	}
	if = {
		limit = {
			has_idea = SPR_economy_focus_2
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_3
			remove_idea = SPR_economy_focus_2
		}
	}
	if = {
		limit = {
			has_idea = SPR_economy_focus
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_2
			remove_idea = SPR_economy_focus
		}
	}
	if = {
		limit = {
			NOT = { has_idea = SPR_economy_focus }
			NOT = { has_idea = SPR_economy_focus_2 }
			NOT = { has_idea = SPR_economy_focus_3 }
			NOT = { has_idea = SPR_economy_focus_4 }
			NOT = { has_idea = SPR_economy_focus_5 }
			NOT = { has_idea = SPR_economy_focus_final }
		}
		add_ideas = SPR_economy_focus
	}
}

SPR_intro_debug_activate_opposing_side_mission = {
	activate_mission = SPR_bop_opposing_side_does_something_mission
}

SPR_intro_debug_remove_opposing_side_mission = {
	remove_mission = SPR_bop_opposing_side_does_something_mission
}

SPR_intro_debug_activate_opposing_side_mission_final = {
	activate_mission = SPR_bop_opposing_side_does_something_mission_final
}

SPR_intro_debug_remove_opposing_side_mission_final = {
	remove_mission = SPR_bop_opposing_side_does_something_mission_final
}

SPR_debug_unholy_alliance_effect = {
	INT = { country_event = sprf.24 }
}

SPR_clear_all_election_flags = {
	clr_country_flag = SPR_monarch_appointed_someone
	clr_country_flag = SPR_had_election
	clr_country_flag = SPR_had_second_election
	clr_country_flag = SPR_flag_ps_elected
	clr_country_flag = SPR_flag_psoe_elected
	clr_country_flag = SPR_flag_psoe_reelected
	clr_country_flag = SPR_flag_ir_elected
	clr_country_flag = SPR_flag_ir_reelected
	clr_country_flag = SPR_flag_ue_elected
	clr_country_flag = SPR_flag_ue_reelected
	clr_country_flag = SPR_flag_plm_elected
	clr_country_flag = SPR_flag_plm_reelected
	clr_country_flag = SPR_flag_dle_elected
	clr_country_flag = SPR_flag_dle_reelected
	clr_country_flag = SPR_flag_ap_elected
	clr_country_flag = SPR_flag_ap_reelected
	clr_country_flag = SPR_flag_pne_elected
	clr_country_flag = SPR_flag_soccon_appointed
	clr_country_flag = SPR_flag_ap_appointed
	clr_country_flag = SPR_flag_pataut_appointed
	clr_country_flag = SPR_flag_natpop_appointed
}