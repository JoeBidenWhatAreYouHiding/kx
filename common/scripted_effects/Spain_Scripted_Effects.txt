SPR_general_setup = {
	set_country_flag = rad_socs_arent_syndie
	#############
	# Var Setup #
	#############
	
	# Civil War #
	
	set_variable = {
		var = SPR_opposing_side_progress_time_var
		value = 60
	}
	set_variable = {
		var = civil_war_countdown_length_var
		value = 30
	}
	set_variable = {
		var = SPR.amount_of_gov_states_takeable
		value = 0
	}
	
	# Nerd Council #
	
	set_variable = {
		var = SPR.SPR_nerd_council_research_speed_factor_set
		value = 0.075
	}
	set_variable = {
		var = SPR.SPR_nerd_council_research_sharing_per_country_bonus_factor_set
		value = 0.1
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_xp_gain_factor_set
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_research_bonus_factor_set
		value = 0.15
	}
	set_variable = {
		var = SPR.SPR_nerd_council_production_speed_buildings_factor_set
		value = 0.00
	}
	
	SPR_nerd_council_setup = yes
	
	# Army Modifier #
	
	SPR_spanish_army_setup = yes
	
	# Everything else #
	
	every_owned_state = {
		limit = {
			OR = {
				state = 171
				state = 172
				state = 174
				state = 176
				state = 793
				state = 1338
				state = 1339
				state = 1344
			}
		}
		set_state_flag = is_car_state
	}
	set_variable = { SPR.num_of_car_states_cleared = 0 }
	set_variable = { SPR.num_of_total_car_states_at_start = 6 }
	every_owned_state = {
		limit = {
			OR = {
				state = 165
				state = 166
				state = 167
				state = 168
				state = 940
				state = 1313
			}
		}
		set_state_flag = is_cnt_state
	}
	set_variable = { SPR.num_of_cnt_states_cleared = 0 }
	set_variable = { SPR.num_of_total_cnt_states_at_start = 3 } #3 because andorra is handled within the Catalonia decision
	add_opinion_modifier = {
		target = USA
		modifier = SPR_legacy_of_1898
	}
	set_country_flag = GLC_in_separatist_revolt
	set_country_flag = CAT_in_separatist_revolt
	set_country_flag = BAS_in_separatist_revolt
	set_country_flag = RIF_in_separatist_revolt
}

SPR_nerd_council_setup = {
	set_variable = {
		var = SPR.SPR_nerd_council_research_speed_factor
		value = SPR.SPR_nerd_council_research_speed_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_research_sharing_per_country_bonus_factor
		value = SPR.SPR_nerd_council_research_sharing_per_country_bonus_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_xp_gain_factor
		value = SPR.SPR_nerd_council_scientist_xp_gain_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_scientist_research_bonus_factor
		value = SPR.SPR_nerd_council_scientist_research_bonus_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_production_speed_buildings_factor
		value = SPR.SPR_nerd_council_production_speed_buildings_factor_set
	}
	set_variable = {
		var = SPR.SPR_nerd_council_civilian_factory_use
		value = 3
	}
	set_variable = {
		var = SPR.SPR_nerd_council_nuclear_production_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_war_support_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_equipment_upgrade_xp_cost
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_experience_gain_army_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_experience_gain_navy_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_navy_max_range_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_navy_org_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_experience_gain_air_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_air_range_factor
		value = 0.0
	}
	set_variable = {
		var = SPR.SPR_nerd_council_air_superiority_efficiency
		value = 0.0
	}
}

SPR_spanish_army_setup = {
	# Army #
	set_variable = {
		var = SPR.SPR_EdT_army_core_attack_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_EdT_army_core_defence_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_EdT_land_reinforce_rate
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_terrain_penalty_reduction
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_morale_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_war_support_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_infantry_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_artillery_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_artillery_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_dig_in_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_breakthrough_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_fortification_damage
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_combat_width_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_recon_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_offence
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_max_planning
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_planning_speed
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_experience_gain_army
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_conscription_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_attrition
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_org_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_org_regain
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_acclimatization_hot_climate_gain_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_special_forces_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_special_forces_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_supply_consumption_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_org_loss_when_moving
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_cavalry_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_cavalry_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_breakthrough_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_fortification_damage
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_motorized_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_motorized_defence_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_mechanized_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_army_armor_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_river_crossing_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_EdT_land_night_attack
		value = 0
	}
	# Air #
	set_variable = {
		var = SPR.SPR_ANE_air_ace_generation_chance_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_doctrine_cost_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_accidents_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_attack_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_defence_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_fuel_consumption_factor
		value = -0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_agility_factor
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_ANE_air_mission_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_maximum_speed_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_range_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_intercept_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_air_cas_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_ground_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_production_speed_air_base_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_cas_damage_reduction
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_army_bonus_air_superiority_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_enemy_army_bonus_air_superiority_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_ANE_experience_gain_air
		value = 0
	}
	# Navy #
	set_variable = {
		var = SPR.SPR_AE_naval_hit_chance
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_AE_naval_critical_score_chance_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_navy_screen_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_navy_capital_ship_attack_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_refit_speed
		value = 0.05
	}
	set_variable = {
		var = SPR.SPR_AE_refit_ic_cost
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_morale_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_coordination
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_navy_carrier_air_targetting_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_convoy_escort_efficiency
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_invasion_capacity
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_naval_invasion_prep_speed
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_production_speed_naval_base_factor
		value = 0
	}
	set_variable = {
		var = SPR.SPR_AE_production_speed_dockyard_factor
		value = 0.05
	}
}

SPR_setup_state_modifiers = {
	every_state = {
		limit = {
			OR = {
				state = 1313
			}
		}
		add_dynamic_modifier = { modifier = SPR_andorra_modifier }
	}
	every_state = {
		limit = {
			OR = {
				state = 118
			}
		}
		add_dynamic_modifier = { modifier = SPR_gibraltar_modifier }
	}
	every_state = {
		limit = {
			OR = {
				state = 165
				state = 1313
			}
		}
		add_dynamic_modifier = { modifier = SPR_catalan_nationalists }
	}
	every_state = {
		limit = {
			OR = {
				state = 172
			}
		}
		add_dynamic_modifier = { modifier = SPR_basque_nationalists }
	}
	every_state = {
		limit = {
			OR = {
				state = 171
			}
		}
		add_dynamic_modifier = { modifier = SPR_galicia_nationalists }
	}
}

SPR_left_kingdom_intro_setup_effect = {
	hidden_effect = {
		unlock_national_focus = SPR_An_Unlikely_Alliance
		unlock_national_focus = SPR_the_darkest_monday
		end_coalition = yes
		set_power_balance = {
			id = SPR_burning_house_of_cards
			left_side = SPR_leftcenter_side
			right_side = SPR_right_side
			set_value = 0.08
		}
		activate_mission = SPR_bop_opposing_side_does_something_mission
		set_country_flag = SPR_left_kingdom_intro
		mark_focus_tree_layout_dirty = yes
	}
	add_popularity = {
		ideology = syndicalist
		popularity = 0.1
	}
	add_popularity = {
		ideology = radical_socialist
		popularity = 0.05
	}
	add_popularity = {
		ideology = social_democrat
		popularity = 0.075
	}
	add_popularity = {
		ideology = social_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = social_conservative
		popularity = 0.025
	}
	add_ideas = SPR_left_kingdom_intro_idea
}

SPR_center_kingdom_intro_setup_effect = {
	hidden_effect = {
		unlock_national_focus = SPR_Walk_The_Storm_Alone
		unlock_national_focus = SPR_the_darkest_monday
		end_coalition = yes
		set_power_balance = {
			id = SPR_burning_house_of_cards
			left_side = SPR_center_side
			right_side = SPR_leftright_side
			set_value = 0.15
		}
		set_variable = { SPR_opposing_side_progress_time_var = 55 }
		activate_mission = SPR_bop_opposing_side_does_something_mission
		set_country_flag = SPR_center_kingdom_intro
		mark_focus_tree_layout_dirty = yes
	}
	add_popularity = {
		ideology = social_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = market_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = authoritarian_democrat
		popularity = 0.05
	}
	add_popularity = {
		ideology = social_conservative
		popularity = 0.025
	}
	add_ideas = SPR_center_kingdom_intro_idea
}

SPR_right_kingdom_intro_setup_effect = {
	hidden_effect = {
		unlock_national_focus = SPR_a_plea_for_the_nationalist
		unlock_national_focus = SPR_the_darkest_monday
		end_coalition = yes
		set_power_balance = {
			id = SPR_burning_house_of_cards
			left_side = SPR_rightcenter_side
			right_side = SPR_left_side
			set_value = 0.08
		}
		activate_mission = SPR_bop_opposing_side_does_something_mission
		set_country_flag = SPR_right_kingdom_intro
		mark_focus_tree_layout_dirty = yes
	}
	add_popularity = {
		ideology = market_liberal
		popularity = 0.025
	}
	add_popularity = {
		ideology = authoritarian_democrat
		popularity = 0.05
	}
	add_popularity = {
		ideology = paternal_autocrat
		popularity = 0.025
	}
	add_ideas = SPR_right_kingdom_intro_idea
}

SPR_left_republic_intro_setup_effect = {
	hidden_effect = {
		end_coalition = yes
		set_country_flag = SPR_left_republic_intro
		mark_focus_tree_layout_dirty = yes
		set_variable = {
			var = civil_war_prelude_countdown_length_var
			value = 400
		}
		activate_mission = SPR_civil_war_prelude_countdown
	}
	add_ideas = SPR_Leftist_Fury
}

SPR_right_republic_intro_setup_effect = {
	hidden_effect = {
		end_coalition = yes
		set_country_flag = SPR_right_republic_intro
		mark_focus_tree_layout_dirty = yes
		set_variable = {
			var = civil_war_prelude_countdown_length_var
			value = 400
		}
		activate_mission = SPR_civil_war_prelude_countdown
	}
	add_ideas = SPR_Rightist_Fury
}

SPR_bop_finale_setup = {
	clr_country_flag = SPR_all_car_states_cleared
	clr_country_flag = SPR_all_cnt_states_cleared
	set_country_flag = SPR_bop_finale_flag
	remove_power_balance = {
		id = SPR_burning_house_of_cards
	}
	every_state = {
		limit = {
			OR = {
				has_state_flag = is_car_state
				has_state_flag = is_cnt_state
			}
		}
		set_demilitarized_zone = no
		set_demilitarized_zone = yes
	}
}

SPR_opposing_side_effect_1 = {
	decrease_ruling_party_popularity_by_3 = yes
	add_political_power = -15
	add_stability = -0.02
	add_power_balance_value = {
		id = SPR_burning_house_of_cards
		value = 0.05
	}
}

SPR_opposing_side_effect_2 = {
	decrease_ruling_party_popularity_by_5 = yes
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.01
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.05
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.02
		}
		951 = {
			custom_effect_tooltip = new_car_state_tt
			hidden_effect = {
				set_state_flag = is_car_state
				add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.02
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.05
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.05
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.02
		}
		random_list = {
			50 = {
				1343 = {
					custom_effect_tooltip = new_cnt_state_tt
					hidden_effect = {
						set_state_flag = is_cnt_state
						add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
					}
				}
			}
			50 = {
				951 = {
					custom_effect_tooltip = new_car_state_tt
					hidden_effect = {
						set_state_flag = is_car_state
						add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
					}
				}
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.02
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.05
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.03
		}
		1343 = {
			custom_effect_tooltip = new_cnt_state_tt
			hidden_effect = {
				set_state_flag = is_cnt_state
				add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
			}
		}
	}
	add_political_power = -20
	add_stability = -0.03
	add_power_balance_value = {
		id = SPR_burning_house_of_cards
		value = 0.05
	}
}

SPR_opposing_side_effect_3 = {
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
		if = {
			limit = {
				951 = { has_state_flag = is_car_state }
			}
			170 = {
				custom_effect_tooltip = new_car_state_tt
				hidden_effect = {
					set_state_flag = is_car_state
					add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
				}
			}
		}
		else = {
			951 = {
				custom_effect_tooltip = new_car_state_tt
				hidden_effect = {
					set_state_flag = is_car_state
					add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
				}
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.04
		}
		random_list = {
			50 = {
				if = {
					limit = {
						1343 = { has_state_flag = is_cnt_state }
					}
					795 = {
						custom_effect_tooltip = new_cnt_state_tt
						hidden_effect = {
							set_state_flag = is_cnt_state
							add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
						}
					}
					177 = {
						custom_effect_tooltip = new_cnt_state_tt
						hidden_effect = {
							set_state_flag = is_cnt_state
							add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
						}
					}
				}
				else = {
					1343 = {
						custom_effect_tooltip = new_cnt_state_tt
						hidden_effect = {
							set_state_flag = is_cnt_state
							add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
						}
					}
				}
			}
			50 = {
				if = {
					limit = {
						951 = { has_state_flag = is_car_state }
					}
					170 = {
						custom_effect_tooltip = new_car_state_tt
						hidden_effect = {
							set_state_flag = is_car_state
							add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
						}
					}
				}
				else = {
					951 = {
						custom_effect_tooltip = new_car_state_tt
						hidden_effect = {
							set_state_flag = is_car_state
							add_to_variable = { SPR.num_of_total_car_states_at_start = 1 }
						}
					}
				}
			}
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.06
		}
		795 = {
			custom_effect_tooltip = new_cnt_state_tt
			hidden_effect = {
				set_state_flag = is_cnt_state
				add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
			}
		}
		177 = {
			custom_effect_tooltip = new_cnt_state_tt
			hidden_effect = {
				set_state_flag = is_cnt_state
				add_to_variable = { SPR.num_of_total_cnt_states_at_start = 1 }
			}
		}
	}
	
	add_political_power = -25
	add_stability = -0.05
	add_power_balance_value = {
		id = SPR_burning_house_of_cards
		value = 0.07
	}
}

SPR_opposing_side_effect_4 = {
	if = {
		limit = {
			has_country_flag = SPR_left_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_center_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = 0.08
		}
		add_popularity = {
			ideology = national_populist
			popularity = 0.06
		}
	}
	if = {
		limit = {
			has_country_flag = SPR_right_kingdom_intro
		}
		add_popularity = {
			ideology = totalist
			popularity = 0.04
		}
		add_popularity = {
			ideology = syndicalist
			popularity = 0.08
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = 0.06
		}
	}
	add_political_power = -30
	add_stability = -0.07
	add_power_balance_value = {
		id = SPR_burning_house_of_cards
		value = 0.07
	}
}

SPR_scw_black_monday_replace_current = {
	remove_ideas = SPR_no_food_mierda
	if = {
		limit = {
			has_idea = SPR_black_monday
		}
		set_variable = { global.SPR_scw_bm_progress = 1 }
		swap_ideas = {
			remove_idea = SPR_black_monday
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_2
		}
		set_variable = { global.SPR_scw_bm_progress = 2 }
		swap_ideas = {
			remove_idea = SPR_black_monday_2
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_3
		}
		set_variable = { global.SPR_scw_bm_progress = 3 }
		swap_ideas = {
			remove_idea = SPR_black_monday_3
			add_idea = SPR_black_monday_scw
		}
	}
	else_if = {
		limit = {
			has_idea = SPR_black_monday_4
		}
		set_variable = { global.SPR_scw_bm_progress = 4 }
		swap_ideas = {
			remove_idea = SPR_black_monday_4
			add_idea = SPR_black_monday_scw
		}
	}
	else = {
		add_ideas = SPR_black_monday_scw
	}
}

SPR_scw_black_monday_readd_old = {
	if = {
		limit = {
			NOT = { has_idea = SPR_no_food_mierda }
		}
		add_ideas = SPR_no_food_mierda
	}
	if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 1 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday
		}
	}
	else_if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 2 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_2
		}
	}
	else_if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 3 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_3
		}
	}
	else_if = {
		limit = {
			check_variable = { global.SPR_scw_bm_progress = 4 }
		}
		swap_ideas = {
			remove_idea = SPR_black_monday_scw
			add_idea = SPR_black_monday_4
		}
	}
	else = {
		remove_ideas = SPR_black_monday_scw
	}
}

SPR_civil_war_kingdom_debuffs_setup = {
	end_coalition = yes
	remove_ideas = {
		SPR_left_kingdom_intro_idea
		SPR_center_kingdom_intro_idea
		SPR_right_kingdom_intro_idea
		SPR_Rising_Separatism
		SPR_Leftist_Fury
		SPR_Left_Shadow_Government
		SPR_Rightist_Fury
		SPR_Right_Shadow_Government
		SPR_social_breakdown
		SPR_social_breakdown_2
		SPR_social_breakdown_3
		SPR_memories_of_the_republic
		SPR_Scars_of_98
		SPR_black_monday_inflation
		SPR_black_monday_income_tax
		SPR_black_monday_emergency_measures_left
		SPR_black_monday_emergency_measures
		SPR_spend_more_get_less_idea_left
		SPR_spend_more_get_less_idea
		SPR_spend_more_get_less_idea_right
		SPR_public_works_idea
	}
	remove_power_balance = {
		id = SPR_burning_house_of_cards
	}
	
	add_ideas = SPR_social_breakdown_civil_war_unavoidable
	
	SPR_scw_black_monday_replace_current = yes
}

SCW_prelude_setup = {
	if = {
		limit = {
			NOT = { has_global_flag = SCW_no_SPR }
		}
		SPR = {
			SPR_civil_war_kingdom_debuffs_setup = yes
			SPR_scw_kingdom_party_popularites_change_effect = yes
			if = {
				limit = {
					has_allied_with_anyone_kingdom = yes
				}
				set_country_flag = SPR_civil_war_unavoidable
			}
		}
	}
	if = {
		limit = {
			NOT = { has_global_flag = SCW_no_CNT }
		}
		SCW_CNT_prelude_setup = yes
	}
	if = {
		limit = {
			NOT = { has_global_flag = SCW_no_CAR }
		}
		SCW_CAR_prelude_setup = yes
	}
	every_country = {
		limit = {
			OR = {
				tag = SPR
				tag = CAR
				tag = CNT
			}
			exists = yes
		}
		set_country_flag = SCW_can_now_build_mils_via_decisions_flag
		set_country_flag = SCW_can_now_raise_militias_flag
		division_template = {
			name = "Milicia de Emergencia"
			regiments = {
				infantry = { x = 0 y = 0 }
				militia = { x = 0 y = 1 }
				militia = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				militia = { x = 1 y = 1 }
				militia = { x = 1 y = 2 }
			}
			priority = 5
		}
		if = {
			limit = {
				NOT = { has_idea = SPR_social_breakdown_civil_war_unavoidable }
			}
			add_ideas = SPR_social_breakdown_civil_war_unavoidable
		}
	}
}
SCW_CAR_prelude_setup = {
	SPR = {
		if = {
			limit = {
				has_country_flag = SPR_right_kingdom_intro
			}
			send_equipment_fraction = {
				value = 0.5
				target = CAR
			}
		}
		else = {
			send_equipment_fraction = {
				value = 0.3
				target = CAR
			}
		}
	}
	every_state = {
		limit = {
			has_state_flag = is_car_state
		}
		CAR = {
			add_state_core = PREV
			transfer_state = PREV
		}
	}
	every_state = {
		limit = {
			is_claimed_by = CAR
		}
		CAR = { remove_state_claim = PREV }
	}
	CAR = {
		if = {
			limit = {
				SPR = { has_country_flag = SPR_carlism_chose_carlos }
			}
			CAR_setup_carlos_VIII = yes
		}
		set_cosmetic_tag = CAR_REV_BASQUE
		inherit_technology = SPR
		if = {
			limit = {
				owns_state = 1344
			}
			set_capital = { state = 1344 }
		}
		division_template = {
			name = "Guardia Carlista"
			priority = 1
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
			}
			support = {
				artillery = { x = 0 y = 0 }
			}
		}
		172 = {
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Guardia Carlista\" start_experience_factor = 0.1"
				owner = CAR
				id = 14
				count = 4
			}
		}
		if = {
			limit = {
				has_country_flag = CAR_Navarra_Brigades
			}
			division_template = {
				name = "Brigadas de Navarra"
				priority = 2
				is_locked = yes
				division_cap = 6
				regiments = {
					elite_infantry = { x = 0 y = 0 }
					elite_infantry = { x = 0 y = 1 }
					elite_infantry = { x = 0 y = 2 }
					elite_infantry = { x = 1 y = 0 }
					elite_infantry = { x = 1 y = 1 }
					elite_infantry = { x = 1 y = 2 }
				}
				support = {
					artillery = { x = 0 y = 0 }
				}
			}
			172 = {
				create_unit = {
					division = "name = \"Brigada de Navarra\" division_template = \"Brigadas de Navarra\" start_experience_factor = 0.25"
					owner = CAR
					id = 14
					count = 6
				}
			}
		}
		for_each_scope_loop = {
			array = CAR.owned_controlled_states
			limit = {
				NOT = { state = 172 }
			}
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Guardia Carlista\" start_experience_factor = 0.1"
				owner = CAR
				count = 3
				id = 14
			}
		}
		if = {
			limit = {
				has_country_flag = CAR_No_Regionalists
			}
			every_owned_state = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_catalan_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_catalan_nationalists }
			}
			every_owned_state = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_basque_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_basque_nationalists }
			}
			every_owned_state = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_galicia_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_galicia_nationalists }
			}
		}
		if = {
			limit = {
				SPR = { exists = yes }
			}
			embargo_PREV = yes
			add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
		}
		if = {
			limit = {
				CNT = { exists = yes }
			}
			embargo_PREV = yes
			add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
		}
		if = {
			limit = {
				SPR = {
					has_country_flag = SPR_right_republic_intro
					is_ai = no
					exists = yes
				}
			}
			change_tag_from = SPR
		}
	}
	every_state = {
		limit = {
			is_core_of = SPR
			is_core_of = CAR
		}
		SPR = { remove_core_and_add_claim = yes }
	}
}
CAR_setup_effect = {
	CAR = {
		set_cosmetic_tag = CAR_PROV_GOV
		if = {
			limit = {
				has_country_flag = CAR_free_syndies
				CNT = { exists = yes }
			}
			CNT = {
				add_timed_idea = {
					idea = SPR_free_syndies
					days = 90
				}
			}
		}
	}
	SPR = {
		if = {
			limit = {
				NOT = { has_country_flag = SPR_SCW_Sanjurjo_Kingdom }
				exists = yes
			}
			add_popularity = {
				ideology = paternal_autocrat
				popularity = -0.5
			}
		}
		add_popularity = {
			ideology = national_populist
			popularity = -0.5
		}
	}
}
CAR_setup_carlos_VIII = {
	CAR = {
		set_politics = {
			ruling_party = national_populist
			last_election = "1888.6.15"
			election_frequency = 48
			elections_allowed = no
		}
		set_popularities = {
			totalist = 0
			radical_socialist = 0
			syndicalist = 0
			social_democrat = 3
			social_liberal = 3
			market_liberal = 7
			social_conservative = 0
			authoritarian_democrat = 10
			paternal_autocrat = 17
			national_populist = 60
		}
		add_ideas = {
			CAR_Jesus_Cora_y_Lira_hog_npo
			CAR_Jose_Luis_Arrese_Magra_for_pau
			CAR_Joaquin_Bau_Nolla_eco_npo
			CAR_Jose_Luis_Arrese_Magra_sec_pau
		}
		random_unit_leader = {
			limit = { has_id = 3110 }			
			remove_unit_leader = yes
		}
		create_field_marshal = { #Auto-Generated
			name = "Carlos VIII"
			portrait_path = "gfx/leaders/CAR/Portrait_CAR_Carlos_VIII.png"
			traits = {
				media_personality
				trait_reckless
				inspirational_leader
			}
			skill = 1
			attack_skill = 1
			defense_skill = 1
			planning_skill = 1
			logistics_skill = 1
		}
	}
}
SCW_CNT_prelude_setup = {
	SPR = {
		if = {
			limit = {
				has_country_flag = SPR_left_kingdom_intro
			}
			send_equipment_fraction = {
				value = 0.5
				target = CNT
			}
		}
		else = {
			send_equipment_fraction = {
				value = 0.3
				target = CNT
			}
		}
	}
	every_state = {
		limit = {
			has_state_flag = is_cnt_state
		}
		CNT = {
			add_state_core = PREV
			transfer_state = PREV
		}
	}
	every_state = {
		limit = {
			is_claimed_by = CNT
		}
		CNT = { remove_state_claim = PREV }
	}
	every_state = {
		limit = {
			is_core_of = SPR
			is_core_of = CNT
		}
		SPR = { remove_core_and_add_claim = yes }
	}
	CNT = {
		set_cosmetic_tag = CNT_REV_CATALONIA
		inherit_technology = SPR
		if = {
			limit = {
				owns_state = 165
			}
			set_capital = { state = 165 }
		}
		division_template = {
			name = "Milicia Popular Revolucionaria"
			priority = 1
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
			}
			support = {
				artillery = { x = 0 y = 0 }
			}
		}
		165 = {
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Milicia Popular Revolucionaria\" start_experience_factor = 0.1"
				owner = CNT
				id = 16
				count = 3
			}
		}
		1313 = {
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Milicia Popular Revolucionaria\" start_experience_factor = 0.2"
				owner = CNT
				id = 16
				count = 1
			}
		}
		for_each_scope_loop = {
			array = CNT.owned_controlled_states
			limit = {
				NOT = { state = 165 }
				NOT = { state = 1313 }
			}
			create_unit = {
				division = "name = \"División de Infantería\" division_template = \"Milicia Popular Revolucionaria\" start_experience_factor = 0.1"
				owner = CNT
				id = 16
				count = 3
			}
		}
		if = {
			limit = {
				has_country_flag = CNT_French_Support
			}
			army_experience = 50
			every_unit_leader = {
				limit = { has_id = 47590 }
				set_nationality = CNT
			}
			every_unit_leader = {
				limit = { has_id = 47591 }
				set_nationality = CNT
			}
			add_opinion_modifier = {
				target = FRA
				modifier = KR_pleased
			}
		}
		if = {
			limit = {
				SPR = { exists = yes }
			}
			embargo_PREV = yes
			add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
		}
		if = {
			limit = {
				CAR = { exists = yes }
			}
			embargo_PREV = yes
			add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = PREV
				modifier = KR_hostile
			}
		}
		if = {
			limit = {
				SPR = {
					has_country_flag = SPR_left_republic_intro
					is_ai = no
					exists = yes
				}
			}
			change_tag_from = SPR
		}
	}
}
CNT_setup_effect = {
	CNT = {
		country_event = { id = sprc.207 days = 7 }
		country_event = { id = sprc.208 days = 15  }
		FRA = {
			country_event = {
				id = comfrance.22
				days = 7
			}
			country_event = {
				id = sprf.17
				days = 14
			}
		}
		if = {
			limit = {
				has_country_flag = CNT_Add_Anarchy_Idea_On_Civil_War_Start
			}
			add_ideas = CNT_SCW_we_love_anarchy
		}
		set_cosmetic_tag = CNT_PROV_GOV
		end_coalition = yes
		if = {
			limit = {
				has_country_flag = popular_front_on_start_flag
			}
			add_soccon_to_coalition = yes
			add_marlib_to_coalition = yes
			add_soclib_to_coalition = yes
			add_socdem_to_coalition = yes
		}
		add_radsoc_to_coalition = yes
		add_synd_to_coalition = yes
		add_tot_to_coalition = yes
	}
	SPR = {
		add_popularity = {
			ideology = totalist
			popularity = -0.5
		}
		add_popularity = {
			ideology = syndicalist
			popularity = -0.5
		}
		add_popularity = {
			ideology = radical_socialist
			popularity = -0.3
		}
	}
}
SCW_start_effect = {
	set_global_flag = spanish_civil_war
	set_global_flag = spanish_civil_war_happened
	random_other_country = {
		limit = {
			is_spanish_civil_war_tag = no
		}
		news_event = {
			id = worldnews.4
			days = 1
		}
	}
	random_country = {
		limit = {
			is_spanish_civil_war_tag = yes
			exists = yes
		}
		country_event = {
			id = worldtension.4
			days = 1
		}
	}
	every_country = {
		limit = {
			is_spanish_civil_war_tag = yes
		}
		set_stability = 0.25
		set_political_power = 0
		if = {
			limit = {
				has_idea = SPR_social_breakdown_civil_war_unavoidable
			}
			swap_ideas = {
				remove_idea = SPR_social_breakdown_civil_war_unavoidable
				add_idea = SPR_civil_war_idea
			}
		}
		else = {
			add_ideas = SPR_civil_war_idea
		}
		add_ideas = {
			SPR_black_monday_scw
			extensive_conscription
			closed_economy
			war_economy
		}
	}
	if = {
		limit = {
			SPR = { exists = yes }
		}
		SPR = {
			if = {
				limit = {
					CAR = { exists = yes }
					SPR = { NOT = { has_war_with = CAR } }
				}
				declare_war_on = {
					target = CAR
					type = annex_everything
				}
			}
			if = {
				limit = {
					CNT = { exists = yes }
					SPR = { NOT = { has_war_with = CNT } }
				}
				declare_war_on = {
					target = CNT
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CAR
					NOT = { is_core_of = SPR }
				}
				SPR = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = CNT
					NOT = { is_core_of = SPR }
				}
				SPR = { add_state_claim = PREV }
			}
		}
	}
	if = {
		limit = {
			CNT = { exists = yes }
		}
		CNT = {
			if = {
				limit = {
					CAR = { exists = yes }
					CNT = { NOT = { has_war_with = CAR } }
				}
				declare_war_on = {
					target = CAR
					type = annex_everything
				}
			}
			if = {
				limit = {
					SPR = { exists = yes }
					CNT = { NOT = { has_war_with = SPR } }
				}
				declare_war_on = {
					target = SPR
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CAR
					NOT = { is_core_of = CNT }
				}
				CNT = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = SPR
					NOT = { is_core_of = CNT }
				}
				CNT = { add_state_claim = PREV }
			}
		}
	}
	if = {
		limit = {
			CAR = { exists = yes }
		}
		CAR = {
			if = {
				limit = {
					CNT = { exists = yes }
					CAR = { NOT = { has_war_with = CNT } }
				}
				declare_war_on = {
					target = CNT
					type = annex_everything
				}
			}
			if = {
				limit = {
					SPR = { exists = yes }
					CAR = { NOT = { has_war_with = SPR } }
				}
				declare_war_on = {
					target = SPR
					type = annex_everything
				}
			}
			every_state = {
				limit = {
					is_core_of = CNT
					NOT = { is_core_of = CAR }
				}
				CAR = { add_state_claim = PREV }
			}
			every_state = {
				limit = {
					is_core_of = SPR
					NOT = { is_core_of = CAR }
				}
				CAR = { add_state_claim = PREV }
			}
		}
	}
}
SPR_civil_war_rif_garrison_spawn = {
	every_owned_state = {
		limit = {
			OR = {
				is_core_of = MOR
				state = 178
			}
		}
		transfer_state_to = RIF
		add_core_of = RIF
	}
	hidden_effect = {
		force_enable_resistance = RIF
		RIF = {
			inherit_technology = SPR
			hidden_effect = { get_current_government_type = yes }
			set_politics = {
				ruling_party = national_populist
			}
			every_owned_state = {
				start_resistance = yes
			}
		}
	}
}
SRR_civil_war_end_effect = {
	clr_global_flag = spanish_civil_war
	SPR_scw_black_monday_readd_old = yes
	mark_focus_tree_layout_dirty = yes
	if = {
		limit = {
			NOT = {
				tag = CNT
			}
		}
		every_state = {
			limit = {
				is_core_of = CNT
			}
			remove_core_of = CNT
			add_core_of = ROOT
		}
		every_state = {
			limit = {
				is_claimed_by = CNT
			}
			remove_claim_by = CNT
		}
	}
	if = {
		limit = {
			NOT = {
				tag = CAR
			}
		}
		every_state = {
			limit = {
				is_core_of = CAR
			}
			remove_core_of = CAR
			add_core_of = ROOT
		}
		every_state = {
			limit = {
				is_claimed_by = CAR
			}
			remove_claim_by = CAR
		}
	}
	if = {
		limit = {
			NOT = {
				tag = SPR
			}
		}
		every_state = {
			limit = {
				is_core_of = SPR
			}
			remove_core_of = SPR
			add_core_of = ROOT
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			remove_claim_by = SPR
		}
	}
	if = {
		limit = {
			tag = SPR
		}
		if = {
			limit = {
				has_global_flag = spanish_civil_war_happened
			}
			set_country_flag = aftermath_of_the_civil_war
		}
		remove_power_balance = {
			id = SPR_burning_house_of_cards
		}
		set_party_name = {
			ideology = authoritarian_democrat
			name = SPR_authoritarian_democrat_party
			long_name = SPR_authoritarian_democrat_party_long
		}
		set_party_name = {
			ideology = paternal_autocrat
			name = SPR_paternal_autocrat_party
			long_name = SPR_paternal_autocrat_party_long
		}
		if = {
			limit = {
				NOT = { has_government = authoritarian_democrat }
			}
			set_politics = {
				ruling_party = authoritarian_democrat
			}
		}
		if = {
			limit = {
				has_idea = SPR_center_kingdom_intro_idea
			}
			swap_ideas = {
				add_idea = SPR_center_kingdom_intro_idea_stable_spain
				remove_idea = SPR_center_kingdom_intro_idea
			}
		}
		create_country_leader = {
			name = "Niceto Alcalá-Zamora"
			picture = "gfx/leaders/CNT/Portrait_CNT_Niceto_Alcala_Zamora.png"
			expire = "1.1.1"
			ideology = christian_democracy_subtype
		}
		create_country_leader = {
			name = "Ramón Otero Pedrayo"
			picture = "gfx/leaders/CAR/Portrait_CAR_Ramon_Otero_Pedrayo.png"
			expire = "1.1.1"
			ideology = liberal_conservative_subtype
		}
		create_country_leader = {
			name = "Manuel Azaña Díaz"
			picture = "gfx/leaders/CNT/Portrait_CNT_Manuel_Azana_Diaz.png"
			expire = "1.1.1"
			ideology = radical_liberalism_subtype
		}
		create_country_leader = {
			name = "Augusto Barcia Trelles"
			picture = "gfx/leaders/CNT/Portrait_CNT_Augusto_Barcia_Trelles.png"
			expire = "1.1.1"
			ideology = socdem_democratic_socialism_subtype
		}
		create_country_leader = {
			name = "Julián Besteiro Fernández"
			picture = "gfx/leaders/CNT/Portrait_CNT_Julian_Besteiro_Fernandez.png"
			expire = "1.1.1"
			ideology = moderate_socialist_subtype
		}
		create_country_leader = {
			name = "Dolores Ibáurri Gómez"
			picture = "gfx/leaders/CNT/Portrait_CNT_Dolores_Ibaurri_Gomez.png"
			expire = "1.1.1"
			ideology = authcom_subtype
		}
		CNT = {
			every_unit_leader = {
				limit = { has_id = 319 } #Batet
				set_nationality = SPR
			}
		}
		CAR = {
			every_unit_leader = {
				limit = { has_id = 313 } #de Llano
				set_nationality = SPR
			}
		}
		if = {
			limit = {
				RIF = {
					exists = yes
					NOT = { has_war_with = SPR }
					has_government = national_populist
					is_ai = yes
				}
			}
			country_event = {
				id = sprc.13
				days = 4
			}
		}
	}
	if = {
		limit = {
			tag = CNT
		}
		if = {
			limit = {
				has_country_flag = CNT_French_Support
			}
			every_unit_leader = {
				limit = { has_id = 47590 }
				set_nationality = FRA
			}
			every_unit_leader = {
				limit = { has_id = 47591 }
				set_nationality = FRA
			}
		}
		drop_cosmetic_tag = yes
		create_country_leader = {
			name = "Francisco Franco Bahamonde"
			desc = "POLITICS_FRANSISCO_FRANCO_DESC"
			picture = "gfx/leaders/SPR/Portrait_SPR_Franco_Bahamonde.png"
			expire = "1.1.1"
			ideology = junta_subtype
		}
		create_country_leader = {
			name = "Jaime I"
			desc = "POLITICS_JAIME_BOURBON_DESC"
			picture = "gfx/leaders/SPR/Portrait_SPR_Jaime_I.png"
			expire = "1.1.1"
			ideology = autdem_christian_democracy_subtype
		}
		create_country_leader = {
			name = "José Díaz Ramos"
			picture = "gfx/leaders/SPR/Portrait_SPR_Jose_Diaz_Ramos.png"
			expire = "1.1.1"
			ideology = syndicalist_subtype
		}
		CAR = {
			every_unit_leader = {
				limit = { has_id = 313 } #de Llano
				set_nationality = CNT
			}
		}
		SPR = {
			every_unit_leader = {
				limit = { has_id = 303 } #Cabanillas
				set_nationality = CNT
			}
		}
	}
	if = {
		limit = {
			tag = CAR
		}
		create_country_leader = {
			name = "Niceto Alcalá-Zamora"
			picture = "gfx/leaders/CNT/Portrait_CNT_Niceto_Alcala_Zamora.png"
			expire = "1.1.1"
			ideology = christian_democracy_subtype
		}
		create_country_leader = {
			name = "Manuel Azaña Díaz"
			picture = "gfx/leaders/CNT/Portrait_CNT_Manuel_Azana_Diaz.png"
			expire = "1.1.1"
			ideology = radical_liberalism_subtype
		}
		create_country_leader = {
			name = "José Díaz Ramos"
			picture = "gfx/leaders/SPR/Portrait_SPR_Jose_Diaz_Ramos.png"
			expire = "1.1.1"
			ideology = syndicalist_subtype
		}
		create_country_leader = {
			name = "Dolores Ibáurri Gómez"
			picture = "gfx/leaders/CNT/Portrait_CNT_Dolores_Ibaurri_Gomez.png"
			expire = "1.1.1"
			ideology = authcom_subtype
		}
		SPR = {
			every_unit_leader = {
				limit = {
					OR = {
						has_id = 301 #Franco
						has_id = 303 #Cabanillas
					}
				}
				set_nationality = CAR
			}
		}
	}
	remove_ideas = {
		SPR_left_kingdom_intro_idea
		SPR_right_kingdom_intro_idea
		SPR_civil_war_idea
	}
	delete_unit_template_and_units = {
		division_template = "Guardia Carlista"
		disband = yes
	}
	delete_unit_template_and_units = {
		division_template = "Brigadas de Navarra"
		disband = yes
	}
	delete_unit_template_and_units = {
		division_template = "Milicia Popular Revolucionaria"
		disband = yes
	}
	delete_unit_template_and_units = {
		division_template = "Milicia de Emergencia"
		disband = yes
	}
	add_ideas = limited_conscription
	add_ideas = export_focus
	add_ideas = civilian_economy
	set_stability = 0.2
}

SPR_switch_to_CNT_effect = { #For if the left wins the power struggle after stablizing spain
	CNT = {
		inherit_technology = SPR
		every_state = {
			limit = {
				is_core_of = SPR
			}
			CNT = {
				add_state_core = PREV
			}
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			CNT = {
				add_state_claim = PREV
			}
		}
		annex_country = {
			target = SPR
			transfer_troops = yes
		}
		set_capital = { state = 41 }
		set_cosmetic_tag = CNT_PROV_GOV
		set_country_flag = CNT_coup_after_scw_avoided
		set_popularities = {
			totalist = 4
			radical_socialist = 23
			syndicalist = 34
			social_democrat = 11
			social_liberal = 3
			market_liberal = 2
			social_conservative = 7
			authoritarian_democrat = 11
			paternal_autocrat = 3
			national_populist = 2
		}
		change_tag_from = SPR
	}
}

SPR_switch_to_CAR_effect = { #For if the right wins the power struggle after stablizing spain
	CAR = {
		inherit_technology = SPR
		every_state = {
			limit = {
				is_core_of = SPR
			}
			CAR = {
				add_state_core = PREV
			}
		}
		every_state = {
			limit = {
				is_claimed_by = SPR
			}
			CAR = {
				add_state_claim = PREV
			}
		}
		annex_country = {
			target = SPR
			transfer_troops = yes
		}
		set_capital = { state = 41 }
		set_cosmetic_tag = CAR_PROV_GOV
		set_country_flag = CAR_coup_after_scw_avoided
		set_popularities = {
			totalist = 3
			radical_socialist = 1
			syndicalist = 4
			social_democrat = 5
			social_liberal = 2
			market_liberal = 5
			social_conservative = 5
			authoritarian_democrat = 17
			paternal_autocrat = 51
			national_populist = 7
		}
		complete_national_focus = CAR_election_success
		change_tag_from = SPR
	}
}

SPR_equatorial_guinea_stolen_effect = {
	var:539.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	var:927.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	var:952.owner = {
		add_to_temp_array = { temp_countries = THIS }
	}
	random_scope_in_array = {
		array = temp_countries
		break = break
		limit = {
			exists = yes
			NOT = { is_ally_with = SPR }
		}
		297 = {
			transfer_state_to = PREV
			remove_claim_by = PREV
			add_core_of = PREV
		}
	}
}

SPR_bm_intro_latin_america_center_effect = {
	every_country = {
		limit = {
			OR = {
				is_in_south_america = yes
				is_in_central_america = yes
				capital_scope = {
					is_core_of = MEX
				}
			}
			NOT = {
				has_communist_government = yes
				has_socialist_government = yes
				has_colonial_government = yes
				is_subject = yes
			}
		}
		THIS = {
			country_event = {
				id = sprd.1192
				days = 4
			}
		}
	}
}

SPR_bm_intro_latin_america_left_effect = {
	every_country = {
		limit = {
			OR = {
				is_in_south_america = yes
				is_in_central_america = yes
				capital_scope = {
					is_core_of = MEX
				}
			}
			NOT = {
				has_communist_government = yes
				has_colonial_government = yes
				has_dictatorship_government = yes
				is_subject = yes
			}
		}
		THIS = {
			country_event = {
				id = sprd.1192
				days = 4
			}
		}
	}
}

SPR_remove_separatist_effect = {
	custom_effect_tooltip = SPR_remove_separatist_effect_tt
	hidden_effect = {
		every_state = {
			limit = {
				has_dynamic_modifier = { modifier = SPR_catalan_nationalists }
			}
			remove_dynamic_modifier = { modifier = SPR_catalan_nationalists }
		}
		every_state = {
			limit = {
				has_dynamic_modifier = { modifier = SPR_basque_nationalists }
			}
			remove_dynamic_modifier = { modifier = SPR_basque_nationalists }
		}
		every_state = {
			limit = {
				has_dynamic_modifier = { modifier = SPR_galicia_nationalists }
			}
			remove_dynamic_modifier = { modifier = SPR_galicia_nationalists }
		}
	}
	remove_ideas = SPR_Rising_Separatism
}

SPR_scw_kingdom_party_popularites_change_effect = {
	set_temp_variable = { temp_radsoc_pop = party_popularity@radical_socialist }
	set_temp_variable = { temp_socdem_pop = party_popularity@social_democrat }
	set_temp_variable = { temp_soclib_pop = party_popularity@social_liberal }
	set_temp_variable = { temp_marlib_pop = party_popularity@market_liberal }
	set_temp_variable = { temp_soccon_pop = party_popularity@social_conservative }
	set_temp_variable = { temp_authdem_pop = party_popularity@authoritarian_democrat }
	set_temp_variable = { temp_pataut_pop = party_popularity@paternal_autocrat }
	clamp_temp_variable = {
		var = temp_authdem_pop
		max = 0.2
	}
	clamp_temp_variable = {
		var = temp_pataut_pop
		max = 0.2
	}
	if = {
		limit = {
			has_country_flag = SPR_SCW_Sanjurjo_Kingdom
		}
		set_popularities = {
			totalist = 0
			radical_socialist = 5
			syndicalist = 0
			social_democrat = 6
			social_liberal = 12
			market_liberal = 17
			social_conservative = 10
			authoritarian_democrat = 20
			paternal_autocrat = 30
			national_populist = 0
		}
	}
	else = {
		set_popularities = {
			totalist = 0
			radical_socialist = 5
			syndicalist = 0
			social_democrat = 6
			social_liberal = 12
			market_liberal = 17
			social_conservative = 10
			authoritarian_democrat = 50
			paternal_autocrat = 0
			national_populist = 0
		}
	}
	add_popularity = {
		ideology = radical_socialist
		popularity = temp_radsoc_pop
	}
	add_popularity = {
		ideology = social_democrat
		popularity = temp_socdem_pop
	}
	add_popularity = {
		ideology = social_liberal
		popularity = temp_soclib_pop
	}
	add_popularity = {
		ideology = market_liberal
		popularity = temp_marlib_pop
	}
	add_popularity = {
		ideology = social_conservative
		popularity = temp_soccon_pop
	}
	if = {
		limit = {
			has_country_flag = SPR_SCW_Sanjurjo_Kingdom
			paternal_autocrat < 0.4
		}
		add_popularity = {
			ideology = paternal_autocrat
			popularity = temp_pataut_pop
		}
	}
	else = {
		add_popularity = {
			ideology = authoritarian_democrat
			popularity = temp_authdem_pop
		}
	}
}

SPR_economy_focus_idea_upgrade = {
	if = {
		limit = {
			has_idea = SPR_economy_focus_4
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_5
			remove_idea = SPR_economy_focus_4
		}
	}
	if = {
		limit = {
			has_idea = SPR_economy_focus_3
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_4
			remove_idea = SPR_economy_focus_3
		}
	}
	if = {
		limit = {
			has_idea = SPR_economy_focus_2
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_3
			remove_idea = SPR_economy_focus_2
		}
	}
	if = {
		limit = {
			has_idea = SPR_economy_focus
		}
		swap_ideas = {
			add_idea = SPR_economy_focus_2
			remove_idea = SPR_economy_focus
		}
	}
	if = {
		limit = {
			NOT = { has_idea = SPR_economy_focus }
			NOT = { has_idea = SPR_economy_focus_2 }
			NOT = { has_idea = SPR_economy_focus_3 }
			NOT = { has_idea = SPR_economy_focus_4 }
			NOT = { has_idea = SPR_economy_focus_5 }
			NOT = { has_idea = SPR_economy_focus_final }
		}
		add_ideas = SPR_economy_focus
	}
}

SPR_intro_debug_activate_opposing_side_mission = {
	activate_mission = SPR_bop_opposing_side_does_something_mission
}

SPR_intro_debug_remove_opposing_side_mission = {
	remove_mission = SPR_bop_opposing_side_does_something_mission
}

SPR_intro_debug_activate_opposing_side_mission_final = {
	activate_mission = SPR_bop_opposing_side_does_something_mission_final
}

SPR_intro_debug_remove_opposing_side_mission_final = {
	remove_mission = SPR_bop_opposing_side_does_something_mission_final
}

SPR_debug_unholy_alliance_effect = {
	INT = { country_event = sprf.24 }
}

SPR_clear_all_election_flags = {
	clr_country_flag = SPR_monarch_appointed_someone
	clr_country_flag = SPR_had_election
	clr_country_flag = SPR_had_second_election
	clr_country_flag = SPR_flag_ps_elected
	clr_country_flag = SPR_flag_psoe_elected
	clr_country_flag = SPR_flag_psoe_reelected
	clr_country_flag = SPR_flag_ir_elected
	clr_country_flag = SPR_flag_ir_reelected
	clr_country_flag = SPR_flag_ue_elected
	clr_country_flag = SPR_flag_ue_reelected
	clr_country_flag = SPR_flag_plm_elected
	clr_country_flag = SPR_flag_plm_reelected
	clr_country_flag = SPR_flag_dle_elected
	clr_country_flag = SPR_flag_dle_reelected
	clr_country_flag = SPR_flag_ap_elected
	clr_country_flag = SPR_flag_ap_reelected
	clr_country_flag = SPR_flag_pne_elected
	clr_country_flag = SPR_flag_soccon_appointed
	clr_country_flag = SPR_flag_ap_appointed
	clr_country_flag = SPR_flag_pataut_appointed
	clr_country_flag = SPR_flag_natpop_appointed
}
SPR_protect_latin_america_effect = {
	custom_effect_tooltip = SPR_Protect_Latin_America_tt
	hidden_effect = {
		set_country_flag = SPR_radical_entente_protect_south_america
			every_country = {
			limit = {
				has_socialist_government = no
				NOT = { has_government = paternal_autocrat }
				NOT = { has_government = national_populist }
				is_subject = no
				NOT = {
					has_war_with = SPR
				}
				OR = {
					is_in_central_america = yes
					is_in_south_america = yes
				}
			}
			add_ideas = SPR_Protect_Latin_America_Idea
		}
	}
}
SPR_form_iberia_effect = {
	set_country_flag = SPR_iberian_union
	set_cosmetic_tag = SPR_IBERIA
	if = {
		limit = {
			POR = { exists = yes }
		}
		SPR = {
			annex_country = {
				target = POR
				transfer_troops = yes
			}
		}
	}
	hidden_effect = {
		every_state = {
			limit = { is_core_of = POR }
			add_core_of = SPR
		}
		every_state = {
			limit = { is_claimed_by = POR }
			add_state_claim = SPR
		}
		every_owned_state = {
			limit = {
				is_core_of = POR
				NOT = { is_core_of = ANG }
				NOT = { is_core_of = MZB }
			}
			add_dynamic_modifier = { modifier = SPR_iberia_portugal_modifier }
		}
		country_event = {
			id = sprd.1137
			days = 3
		}
	}
}
CAT_revolt_during_scw_effect = {
	set_temp_variable = {
		temp_owner = var:165.owner
	}
	every_state = {
		limit = {
			AND = {
				is_core_of = CAT
				NOT = {
					state = 167
				}
			}
		}
		CAT = {
			transfer_state = PREV
		}
	}
	CAT = {
		set_cosmetic_tag = CAT_PROV_GOV
		declare_war_on = {
			target = temp_owner
			type = annex_everything
		}
	}
}
SPR_RIF_Revolt_Effect = {
	set_temp_variable = {
		temp_owner = var:290.owner
	}
	290 = {
		set_demilitarized_zone = no
		transfer_state_to = RIF
		add_core_of = RIF
	}
	temp_owner = {
		declare_war_on = {
			target = RIF
			type = annex_everything
		}
		if = {
			limit = {
				NOT = {
					has_active_mission = SPR_battle_royale_countdown
				}
			}
			activate_mission = SPR_battle_royale_countdown
		}
	}
	hidden_effect = {
		RIF = { set_country_flag = RIF_revolt_not_via_separatist_revolt }
	}
}
SPR_separatist_revolt_effect = {
	SPR = {
		set_country_flag = SPR_separatist_revolt_flag
		activate_mission = SPR_battle_royale_prelude_countdown
	}
	if = {
		limit = {
			SPR = { has_country_flag = GLC_in_separatist_revolt }
		}
		171 = {
			transfer_state_to = GLC
			if = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_galicia_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_galicia_nationalists }
			}
		}
		GLC = {
			add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
		}
	}
	if = {
		limit = {
			SPR = { has_country_flag = CAT_in_separatist_revolt }
		}
		every_state = {
			limit = {
				OR = {
					state = 165
					state = 167
					state = 1313
				}
			}
			if = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_catalan_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_catalan_nationalists }
			}
			transfer_state_to = CAT
		}
		CAT = {
			add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
		}
	}
	if = {
		limit = {
			SPR = { has_country_flag = BAS_in_separatist_revolt }
		}
		172 = {
			transfer_state_to = BAS
			if = {
				limit = {
					has_dynamic_modifier = { modifier = SPR_basque_nationalists }
				}
				remove_dynamic_modifier = { modifier = SPR_basque_nationalists }
			}
		}
		BAS = {
			add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
		}
	}
	if = {
		limit = {
			SPR = { has_country_flag = RIF_in_separatist_revolt }
			RIF = { NOT = { has_country_flag = RIF_revolt_not_via_separatist_revolt } }
		}
		290 = {
			transfer_state_to = RIF
			add_core_of = RIF
		}
		RIF = {
			add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
			reverse_add_opinion_modifier = {
				target = SPR
				modifier = KR_hostile
			}
		}
	}
}
SPR_separatist_revolt_start_war_effect = {
	add_ideas = SPR_struggle_for_castilian_survival
	add_war_support = 0.25
	if = {
		limit = {
			has_active_mission = SPR_battle_royale_countdown
			RIF = { has_country_flag = RIF_revolt_not_via_separatist_revolt }
		}
		add_days_mission_timeout = {
			mission = SPR_battle_royale_countdown
			days = 100
		}
	}
	else = {
		activate_mission = SPR_battle_royale_countdown
	}
	if = {
		limit = {
			GLC = { exists = yes }
			NOT = { has_war_with = GLC }
		}
		declare_war_on = {
			target = GLC
			type = annex_everything
		}
	}
	if = {
		limit = {
			CAT = { exists = yes }
			NOT = { has_war_with = CAT }
		}
		declare_war_on = {
			target = CAT
			type = annex_everything
		}
	}
	if = {
		limit = {
			BAS = { exists = yes }
			NOT = { has_war_with = BAS }
		}
		declare_war_on = {
			target = BAS
			type = annex_everything
		}
	}
	if = {
		limit = {
			RIF = { exists = yes }
			NOT = { has_war_with = RIF }
		}
		declare_war_on = {
			target = RIF
			type = annex_everything
		}
	}
}
SPR_remove_political_party_ideas = {
	if = {
		limit = {
			SPR_ps_elected_flag = no
		}
		remove_ideas = {
			SPR_Paradox
			SPR_Direct_Democracy
			SPR_Peoples_Communes
			SPR_Liberated_Minds
			SPR_Cremation
			SPR_Mujeres_Libres
		}
	}
	if = {
		limit = {
			SPR_psoe_elected_flag = no
			SPR_psoe_reelected_flag = no
		}
		remove_ideas = {
			#first term
			SPR_workers_rights_idea
			SPR_The_Rightful_Elder_idea
			SPR_Peace_with_the_Anarchists_idea
			SPR_Socialist_Spain_idea
			SPR_Empowered_Unions_idea
			SPR_Labour_Laws_for_the_Worker_idea
			SPR_Crushed_Caciquismo_idea
			SPR_Commitment_to_Democracy_idea
			#second term
			SPR_Shackled_Revolutionary_Spirit
			SPR_Pablismo
			SPR_Against_Extremism
			SPR_Pragmatic_Pacifism
			SPR_Storm_Passes
		}
	}
	if = {
		limit = {
			SPR_ir_elected_flag = no
			SPR_ir_reelected_flag = no
		}
		remove_ideas = {
			#first term
			SPR_social_security_idea
			SPR_Popular_Front_idea
			SPR_Army_Unburdened_by_Sycophants_idea
			SPR_Minority_Rights_Honoured_idea
			SPR_Secularized_Schools_idea
			SPR_Spirit_of_1931_idea
			SPR_Progressive_Spain_idea
			#second term
			SPR_Azanas_Dream
			SPR_Rationalism
			SPR_Obscurants_Crushed
			SPR_National_Individualism
			SPR_Generation_of_27
		}
	}
	if = {
		limit = {
			SPR_ue_elected_flag = no
			SPR_ue_reelected_flag = no
		}
		remove_ideas = {
			#first term
			SPR_True_Jacobins_idea
			SPR_Hardliner_Anti_Clericalism_idea
			SPR_Concessions_to_Minorities_idea
			SPR_Defenders_of_Democracy_idea
			SPR_Restrained_Radicalism_idea
			SPR_Radical_Spain_idea
			#second term
			SPR_Republican_Allies
			SPR_Shielding_Opressed
			SPR_True_Secularism
			SPR_Radical_Action
		}
	}
	if = {
		limit = {
			SPR_plm_elected_flag = no
			SPR_plm_reelected_flag = no
		}
		remove_ideas = {
			#first term
			SPR_encouraged_small_business
			SPR_DisUnited_Party
			SPR_United_Party
			SPR_Mistakes_of_the_Past
			SPR_True_Jacobins_idea
			SPR_Lerrouxism_Unbowed
			SPR_Endorsed_Kleptocracy
			SPR_Catalans_Are_Okay_I_Guess
			SPR_Fuck_Catalans
			SPR_Populist_Spain
			#second term
			SPR_Anti-Socialism
			SPR_Parallel_Emperor
			SPR_Rewarding_Barbarians
			SPR_Anti-Clericalism
			SPR_Silver_Tongued_Demagogue
		}
	}
	if = {
		limit = {
			SPR_dle_elected_flag = no
			SPR_dle_reelected_flag = no
		}
		remove_ideas = {
			#first term
			SPR_Catholic_Mass_Party
			SPR_Return_to_Conservatism
			SPR_Redeemed_Monarchism
			SPR_Saviours_of_Spain
			SPR_Radicals_Removed
			SPR_Dismantled_Prison
			SPR_Economic_Democratization
			SPR_Moderate_Spain
			#second term
			SPR_Stable_Ship
			SPR_Eclipsing_Accion_Popular
			SPR_Invisible_Hand
			SPR_Struggle_Against_Tyranny
			SPR_No_More_Elitism
		}
	}
	if = {
		limit = {
			SPR_ap_elected_flag = no
			SPR_ap_reelected_flag = no
		}
		remove_ideas = {
			#first term
			SPR_catholic_unions
			SPR_True_Monarchists
			SPR_United_Right
			SPR_State_Corporatism
			SPR_Moderated_Greenshirts
			SPR_Papal_Support
			SPR_Carlists_Destroyed
			SPR_Monarchist_Spain
			#second term
			SPR_Loyal_Servants
			SPR_Euthanize_Republicanism
			SPR_Generation_of_98
			SPR_Organic_Democracy
			SPR_Marching_Onwards
		}
	}
	if = {
		limit = {
			SPR_pne_elected_flag = no
		}
		remove_ideas = {
			SPR_No_More_Syndies
			SPR_Pro_Agrarianism
			SPR_Patriotic_Union_2
			SPR_Tonitruantism
			SPR_Legiories_of_Albinana
			SPR_State_Owned_Social_and_Health_Services_idea
			SPR_PNE_Hispanism
			SPR_Education_Belongs_to_Everyone_idea
			SPR_Defanged_Legionarism_idea
		}
	}
}