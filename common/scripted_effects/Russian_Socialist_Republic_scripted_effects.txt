### POLITBURO ###
SOV_setup_politburo = {
	# add_to_array = { Politburo_Leader_Identity= <d> }	# Leader ID
	# add_to_array = { Politburo_Leader_Faction = <d> }	# 0 for independent, 1 for bukharin, 2 for rykov, 3 for workers opposition, 4 for old guard, 5 for left communists, 6 for hardliners
	# add_to_array = { Politburo_Leader_Authority= <d> }	# authority variable
	# add_to_array = { Politburo_Leader_status = <d> } # 0 for sit-out, 1 for in Politburo, 2 Leader
	#
	set_variable = { Politburo_Bukharin_Faction = 10 }
	
	SOV_calculate_politburo_factions = yes
	set_variable = { SOV_bolshevik_party_congress_number = 1 }
	
}
SOV_change_politburo_into_bolshevik = {
	set_variable = { Politburo_Centre_Faction = 5 }
	set_variable = { Politburo_Bukharin_Faction = 3 }
	set_variable = { Politburo_Hardliner_Faction = 2 }
	set_variable = { SOV_molotovite_influence_cheka = 1 }
	set_variable = { SOV_molotovite_influence_army = 0 }
	set_country_flag = SOV_rkp_in_politburo	
	#set_country_flag = SOV_politburo_hardliners_exist	
	clr_country_flag = SOV_politburo_workers_opposition_exist	
	clr_country_flag = SOV_politburo_united_opposition_exist	
	clr_country_flag = SOV_politburo_old_guard_exists	
	clr_country_flag = SOV_politburo_rykovites_exist	
	clr_country_flag = SOV_politburo_kirovites_exist
	clr_country_flag = SOV_politburo_zhdanovites_exist	
	
	SOV_calculate_politburo_factions = yes
}
SOV_elect_politburo = {
	
}
SOV_politburo_old_guard = {
	if = {
		limit = {
			NOT = { 
				has_country_flag = SOV_politburo_old_guard_exists
				has_country_flag = SOV_politburo_united_opposition_exist
				has_country_flag = SOV_politburo_old_guard_kirov
			}
		}
		if = {
			limit = { has_country_flag = SOV_kamenev_is_bukharinist }
			custom_effect_tooltip = SOV_politburo_old_guard_sokolnikov
			set_country_flag = SOV_politburo_old_guard_sokolnikov
			set_country_flag = SOV_politburo_old_guard_exists
		}
		else_if = {
			limit = { has_country_flag = SOV_sokolnikov_is_bukharinist }
			custom_effect_tooltip = SOV_politburo_old_guard_kamenev
			set_country_flag = SOV_politburo_old_guard_kamenev
			set_country_flag = SOV_politburo_old_guard_exists
		}
		else = {
			custom_effect_tooltip = SOV_politburo_old_guard_kirov
			set_country_flag = SOV_politburo_old_guard_kirov
			SOV_politburo_kirovites = yes
		}
	}
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_rykovites = {
	set_country_flag = SOV_politburo_bukharin_banned
	set_country_flag = SOV_politburo_rykovites_exist
	custom_effect_tooltip = SOV_politburo_rykovites_tt
	set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
	SOV_change_politburo_rykov = yes
	if = {
		limit = { has_country_flag = SOV_politburo_workers_opposition_tomsky }
		set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
		multiply_temp_variable = { politburo_change = 0.10 }
		SOV_change_politburo_workers_opposition = yes
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = SOV_politburo_kirovites_exist }
		}
		SOV_politburo_old_guard = yes
		set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
		multiply_temp_variable = { politburo_change = 0.10 }
		SOV_change_politburo_old_guard = yes
		hidden_effect = {
			set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
			multiply_temp_variable = { politburo_change = -0.10 }			
			SOV_change_politburo_rykov = yes
		}
	}
	set_variable = { Politburo_Bukharin_Faction = 0 }
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_rykovites_zin = {
	set_country_flag = SOV_politburo_rykovites_exist
	set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
	divide_temp_variable = { politburo_change = 3 }
	SOV_change_politburo_rykov = yes
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_kirovites = {
	set_country_flag = SOV_politburo_kirovites_exist
	set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
	divide_temp_variable = { politburo_change = 3 }
	SOV_change_politburo_kirov = yes
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_united_opposition = {
	set_country_flag = SOV_politburo_united_opposition_exist
	if = {
		limit = { has_country_flag = SOV_politburo_workers_opposition_tomsky }
		custom_effect_tooltip = SOV_all_workers_opposition_tomsky_to_left_communists
		clr_country_flag = SOV_politburo_workers_opposition_exist
		set_variable = { Politburo_UnitedOpposition_Faction = Politburo_WorkersOpposition_Faction }
	}
	else_if = {
		limit = { has_country_flag = SOV_politburo_old_guard_exists }
		custom_effect_tooltip = SOV_all_old_guard_change_to_left_communists
		clr_country_flag = SOV_politburo_old_guard_exists
		set_variable = { Politburo_UnitedOpposition_Faction = Politburo_OldGuard_Faction }
	}
	else = {
		custom_effect_tooltip = SOV_united_opposition_forms
		set_variable = { Politburo_UnitedOpposition_Faction = Politburo_Centre_Faction }
	}
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_zinbukh_bloc = {
	custom_effect_tooltip = SOV_zinovievite_bukharinist_bloc
	set_country_flag = SOV_zinovievite_bukharinist_bloc_exists
	add_to_variable = { Politburo_ZinBukh_Faction = Politburo_Centre_Faction }
	add_to_variable = { Politburo_ZinBukh_Faction = Politburo_Bukharin_Faction }
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_zinbukh_bloc_dissolve = {
	if = {
		limit = { has_country_flag = SOV_zinovievite_bukharinist_bloc_exists }
		custom_effect_tooltip = SOV_zinovievite_bukharinist_bloc_dissolve
		clr_country_flag = SOV_zinovievite_bukharinist_bloc_exists
		clr_country_flag = SOV_politburo_bukharin_banned
		SOV_calculate_politburo_factions = yes
	}
}
SOV_politburo_molbukh_bloc = {
	custom_effect_tooltip = SOV_molotovite_bukharinist_bloc
	set_country_flag = SOV_molotovite_bukharinist_bloc_exists
	add_to_variable = { Politburo_MolBukh_Faction = Politburo_Hardliner_Faction }
	add_to_variable = { Politburo_MolBukh_Faction = Politburo_Bukharin_Faction }
	SOV_calculate_politburo_factions = yes
}
SOV_politburo_molbukh_bloc_dissolve = {
	if = {
		limit = { has_country_flag = SOV_molotovite_bukharinist_bloc_exists }
		custom_effect_tooltip = SOV_molotovite_bukharinist_bloc_dissolve
		clr_country_flag = SOV_molotovite_bukharinist_bloc_exists
		SOV_calculate_politburo_factions = yes
	}
}
SOV_politburo_united_opposition_from_bukharinists = {
	custom_effect_tooltip = SOV_all_old_guard_change_to_left_communists
	set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
	multiply_temp_variable = { politburo_change = 0.7 }
	SOV_change_politburo_united_opposition = yes
	set_temp_variable = { politburo_change = Politburo_Bukharin_Faction }
	multiply_temp_variable = { politburo_change = -0.3 }
	if = {
		limit = { has_country_flag = SOV_sokolnikov_is_bukharinist }
		add_to_temp_variable = { politburo_change = 1 }
	}
	SOV_change_politburo_bukharin = yes
}
#Kirov & Tomsky lead Workers Opposition
SOV_politburo_workers_opposition_tomsky = {
	if = {
		limit = {
			NOT = { 
				has_country_flag = SOV_politburo_workers_opposition_exist 
				has_country_flag = SOV_politburo_united_opposition_exist
			}
		}
		custom_effect_tooltip = SOV_politburo_workers_opposition_tomsky
		set_country_flag = SOV_politburo_workers_opposition_exist
		set_country_flag = SOV_politburo_workers_opposition_tomsky
	}
	SOV_calculate_politburo_factions = yes
}
#Shlyapnikov & Kollontai lead Workers Opposition
SOV_politburo_workers_opposition = {
	if = {
		limit = {
			NOT = { has_country_flag = SOV_politburo_workers_opposition_exist }
		}
		custom_effect_tooltip = SOV_politburo_workers_opposition_form
		set_country_flag = SOV_politburo_workers_opposition_exist
		clr_country_flag = SOV_politburo_workers_opposition_tomsky
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_old_guard = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_OldGuard_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_old_guard_kirov }
		custom_effect_tooltip = SOV_change_politburo_kirov
		clamp_variable = { var = Politburo_OldGuard_Faction min = 1 }
	}
	else_if = {
		limit = { has_country_flag = SOV_politburo_united_opposition_exist }
		custom_effect_tooltip = SOV_change_politburo_united_opposition
		clamp_variable = { var = Politburo_OldGuard_Faction min = 1 }
	}
	else = {
		if = {
			limit = { has_country_flag = SOV_politburo_old_guard_exists }
			custom_effect_tooltip = SOV_change_politburo_old_guard
			clamp_variable = { var = Politburo_OldGuard_Faction min = 1 }
		}
		else = {
			clamp_variable = { var = Politburo_OldGuard_Faction min = 0 }
		}
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_bukharin = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_Bukharin_Faction = politburo_change }
	clamp_variable = { var = Politburo_Bukharin_Faction min = 0 }
	if = {
		limit = { has_country_flag = SOV_zinovievite_bukharinist_bloc_exists }
		custom_effect_tooltip = SOV_change_politburo_zinbukh
	}
	else = {
		if = {
			limit = { NOT = { has_country_flag = SOV_politburo_bukharin_banned } }
			custom_effect_tooltip = SOV_change_politburo_bukharin
		}
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_workers_opposition = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_WorkersOpposition_Faction = politburo_change }
	if = {
		limit = { 
			has_country_flag = SOV_politburo_kirovites_exist 
		}
		custom_effect_tooltip = SOV_change_politburo_kirov
		clamp_variable = { var = Politburo_WorkersOpposition_Faction min = 1 }
	}
	else_if = {
		limit = { 
			has_country_flag = SOV_politburo_united_opposition_exist 
			has_country_flag = SOV_politburo_workers_opposition_tomsky
		}
		custom_effect_tooltip = SOV_change_politburo_united_opposition
		clamp_variable = { var = Politburo_WorkersOpposition_Faction min = 1 }
	}
	else = {
		if = {
			limit = { has_country_flag = SOV_politburo_workers_opposition_exist }
			custom_effect_tooltip = SOV_change_politburo_workers_opposition
			clamp_variable = { var = Politburo_WorkersOpposition_Faction min = 1 }
		}
		else = {
			clamp_variable = { var = Politburo_WorkersOpposition_Faction min = 0 }
		}
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_left_communists = {
	add_to_variable = { Politburo_Centre_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_united_opposition_exist }
		custom_effect_tooltip = SOV_change_politburo_united_opposition
		clamp_variable = { var = Politburo_Centre_Faction min = 1 }
	}
	else_if = {
		limit = { has_country_flag = SOV_zinovievite_bukharinist_bloc_exists }
		custom_effect_tooltip = SOV_change_politburo_zinbukh
		clamp_variable = { var = Politburo_Centre_Faction min = 1 }
	}
	else_if = {
		limit = { has_country_flag = SOV_rkp_in_politburo }
		custom_effect_tooltip = SOV_change_politburo_left_communists
		clamp_variable = { var = Politburo_Centre_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_Centre_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_united_opposition = {
	add_to_variable = { Politburo_UnitedOpposition_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_united_opposition_exist }
		custom_effect_tooltip = SOV_change_politburo_united_opposition
		clamp_variable = { var = Politburo_UnitedOpposition_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_UnitedOpposition_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_zinbukh = {
	add_to_variable = { Politburo_ZinBukh_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_zinovievite_bukharinist_bloc_exists }
		custom_effect_tooltip = SOV_change_politburo_zinbukh
		clamp_variable = { var = Politburo_ZinBukh_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_ZinBukh_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_hardliners = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_Hardliner_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_hardliners_exist }
		custom_effect_tooltip = SOV_change_politburo_hardliners
		clamp_variable = { var = Politburo_Hardliner_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_Hardliner_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_rykov = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_Rykov_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_rykovites_exist }
		custom_effect_tooltip = SOV_change_politburo_rykov
		clamp_variable = { var = Politburo_Rykov_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_Rykov_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_kirov = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_Kirov_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_kirovites_exist }
		custom_effect_tooltip = SOV_change_politburo_kirov
		clamp_variable = { var = Politburo_Kirov_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_Kirov_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}
#requires temp variable politburo_change
SOV_change_politburo_zhdanov = {
	if = {
		limit = { 
			has_idea = SOV_democratic_centralism_4
		}
		divide_temp_variable = { politburo_change = 2 }
	}
	add_to_variable = { Politburo_Zhdanov_Faction = politburo_change }
	if = {
		limit = { has_country_flag = SOV_politburo_zhdanovites_exist }
		custom_effect_tooltip = SOV_change_politburo_zhdanov
		clamp_variable = { var = Politburo_Zhdanov_Faction min = 1 }
	}
	else = {
		clamp_variable = { var = Politburo_Zhdanov_Faction min = 0 }
	}
	SOV_calculate_politburo_factions = yes
}

SOV_calculate_politburo_factions = {
	set_variable = { Politburo_General_Score = 0 }
	set_variable = { Politburo_Bukharin_Faction_display = Politburo_Bukharin_Faction}
	set_variable = { Politburo_Rykov_Faction_display = Politburo_Rykov_Faction}
	set_variable = { Politburo_WorkersOpposition_Faction_display = Politburo_WorkersOpposition_Faction}
	set_variable = { Politburo_OldGuard_Faction_display = Politburo_OldGuard_Faction}
	set_variable = { Politburo_Hardliner_Faction_display = Politburo_Hardliner_Faction}
	set_variable = { Politburo_Zhdanov_Faction_display = Politburo_Zhdanov_Faction}
	set_variable = { Politburo_Centre_Faction_display = Politburo_Centre_Faction}
	
	
	set_variable = { Politburo_Kirov_Faction_display = Politburo_Kirov_Faction}
	add_to_variable = { Politburo_Kirov_Faction_display = Politburo_WorkersOpposition_Faction}
	if = {
		limit = { has_country_flag = SOV_politburo_old_guard_kirov }
		add_to_variable = { Politburo_Kirov_Faction_display = Politburo_OldGuard_Faction}
	}
	
	set_variable = { Politburo_ZinBukh_Faction_display = Politburo_Bukharin_Faction_display }
	add_to_variable = { Politburo_ZinBukh_Faction_display = Politburo_Centre_Faction_display }
	add_to_variable = { Politburo_ZinBukh_Faction_display = Politburo_ZinBukh_Faction }
	
	set_variable = { Politburo_MolBukh_Faction_display = Politburo_Bukharin_Faction_display }
	add_to_variable = { Politburo_MolBukh_Faction_display = Politburo_Hardliner_Faction_display }
	add_to_variable = { Politburo_MolBukh_Faction_display = Politburo_MolBukh_Faction }
	
	set_variable = { Politburo_UnitedOpposition_Faction_display = Politburo_OldGuard_Faction_display }
	add_to_variable = { Politburo_UnitedOpposition_Faction_display = Politburo_Centre_Faction_display }
	add_to_variable = { Politburo_UnitedOpposition_Faction_display = Politburo_UnitedOpposition_Faction }
	if = {
		limit = { 
			has_country_flag = SOV_politburo_united_opposition_exist 
			has_country_flag = SOV_politburo_workers_opposition_tomsky
		}
		add_to_variable = { Politburo_UnitedOpposition_Faction_display = Politburo_WorkersOpposition_Faction_display }
	}
	if = {
		limit = { 
			NOT = { 
				has_country_flag = SOV_politburo_bukharin_banned 
				has_country_flag = SOV_zinovievite_bukharinist_bloc_exists
				has_country_flag = SOV_molotovite_bukharinist_bloc_exists
			}
		}
		add_to_variable = { Politburo_General_Score = Politburo_Bukharin_Faction_display }
	}
	if = {
		limit = { has_country_flag = SOV_politburo_rykovites_exist }
		add_to_variable = { Politburo_General_Score = Politburo_Rykov_Faction_display }
	}
	if = {
		limit = { has_country_flag = SOV_politburo_kirovites_exist }
		add_to_variable = { Politburo_General_Score = Politburo_Kirov_Faction_display }
	}
	if = {
		limit = { 
			has_country_flag = SOV_politburo_workers_opposition_exist 
			NOT = {
				AND = {
					has_country_flag = SOV_politburo_united_opposition_exist 
					has_country_flag = SOV_politburo_workers_opposition_tomsky
				}
				has_country_flag = SOV_politburo_kirovites_exist
			}
		}
		add_to_variable = { Politburo_General_Score = Politburo_WorkersOpposition_Faction_display }
	}
	if = {
		limit = { 
			has_country_flag = SOV_politburo_old_guard_exists 
			NOT = { 
				has_country_flag = SOV_zinovievite_bukharinist_bloc_exists 
				has_country_flag = SOV_politburo_united_opposition_exist 
			}
		}
		add_to_variable = { Politburo_General_Score = Politburo_OldGuard_Faction_display }
	}
	if = {
		limit = { 
			has_country_flag = SOV_politburo_hardliners_exist
			NOT = {
				has_country_flag = SOV_molotovite_bukharinist_bloc_exists
			}
		}
		add_to_variable = { Politburo_General_Score = Politburo_Hardliner_Faction_display }
	}
	if = {
		limit = { has_country_flag = SOV_politburo_zhdanovites_exist }
		add_to_variable = { Politburo_General_Score = Politburo_Zhdanov_Faction_display }
	}
	if = {
		limit = { 
			has_country_flag = SOV_rkp_in_politburo
			NOT = { 
				has_country_flag = SOV_zinovievite_bukharinist_bloc_exists 
				has_country_flag = SOV_politburo_united_opposition_exist 
			}
		}
		add_to_variable = { Politburo_General_Score = Politburo_Centre_Faction_display }
	}
	if = {
		limit = { has_country_flag = SOV_politburo_united_opposition_exist }
		add_to_variable = { Politburo_General_Score = Politburo_UnitedOpposition_Faction_display }
	}
	if = {
		limit = { has_country_flag = SOV_zinovievite_bukharinist_bloc_exists }
		add_to_variable = { Politburo_General_Score = Politburo_ZinBukh_Faction_display }
	}
	if = {
		limit = { has_country_flag = SOV_molotovite_bukharinist_bloc_exists }
		add_to_variable = { Politburo_General_Score = Politburo_MolBukh_Faction_display }
	}
		
	divide_variable = { Politburo_Bukharin_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_Rykov_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_Kirov_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_WorkersOpposition_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_OldGuard_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_Centre_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_UnitedOpposition_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_ZinBukh_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_MolBukh_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_Hardliner_Faction_display = Politburo_General_Score }
	divide_variable = { Politburo_Zhdanov_Faction_display = Politburo_General_Score }
	
}
SOV_turn_nsp_into_totalist = {
	hidden_effect = {
		set_politics = { ruling_party = totalist elections_allowed = no }
		if = {
			limit = { has_country_flag = RUS_nsp_is_rkp }
			set_party_name = { 
				ideology = totalist
				name = SOV_rkp_party
				long_name = SOV_rkp_party_long
			}
			set_party_name = {
				ideology = radical_socialist
				name = SOV_rkp_party
				long_name = SOV_rkp_party_long2
			}
		}
		else = {
			set_party_name = {
				ideology = totalist
				name = RUS_radical_socialist_party
				long_name = RUS_radical_socialist_party_long
			}
			set_party_name = {
				ideology = radical_socialist
				name = RUS_radical_socialist_party
				long_name = SOV_rkp_party_long3
			}
		}
		set_temp_variable = { RUS_new_radsoc = RUS.party_popularity_100@radical_socialist }
		divide_temp_variable = { RUS_new_radsoc = 2 }

		set_temp_variable = { RUS_new_tot = RUS.party_popularity_100@totalist }
		add_to_temp_variable = { RUS_new_tot = RUS_new_radsoc }

		set_temp_variable = { sum = 100 }
		subtract_from_temp_variable = { sum = RUS_new_tot }
		subtract_from_temp_variable = { sum = party_popularity_100@syndicalist }
		subtract_from_temp_variable = { sum = RUS_new_radsoc }
		subtract_from_temp_variable = { sum = party_popularity_100@social_democrat }
		subtract_from_temp_variable = { sum = party_popularity_100@social_liberal }
		subtract_from_temp_variable = { sum = party_popularity_100@market_liberal }
		subtract_from_temp_variable = { sum = party_popularity_100@social_conservative }
		subtract_from_temp_variable = { sum = party_popularity_100@authoritarian_democrat }
		subtract_from_temp_variable = { sum = party_popularity_100@paternal_autocrat }
		subtract_from_temp_variable = { sum = party_popularity_100@national_populist }

		add_to_temp_variable = { RUS_new_tot = sum } #avoid rounding errors

		set_popularities = {
			totalist = RUS_new_tot
			syndicalist = party_popularity_100@syndicalist
			radical_socialist = RUS_new_radsoc
			social_democrat = party_popularity_100@social_democrat
			social_liberal = party_popularity_100@social_liberal
			market_liberal = party_popularity_100@market_liberal
			social_conservative = party_popularity_100@social_conservative
			authoritarian_democrat = party_popularity_100@authoritarian_democrat
			paternal_autocrat = party_popularity_100@paternal_autocrat
			national_populist = party_popularity_100@national_populist
		}
	}
}
SOV_turn_nsp_into_syndicalist = {
	hidden_effect = {
		set_politics = { ruling_party = syndicalist elections_allowed = no }
		set_party_name = {
			ideology = syndicalist
			name = SOV_psp_party
			long_name = SOV_psp_party_long
		}
		set_temp_variable = { RUS_new_radsoc = RUS.party_popularity_100@syndicalist }
		set_temp_variable = { RUS_new_synd = RUS.party_popularity_100@radical_socialist }
		
		set_temp_variable = { sum = 100 }
		subtract_from_temp_variable = { sum = party_popularity_100@totalist }
		subtract_from_temp_variable = { sum = RUS_new_synd }
		subtract_from_temp_variable = { sum = RUS_new_radsoc }
		subtract_from_temp_variable = { sum = party_popularity_100@social_democrat }
		subtract_from_temp_variable = { sum = party_popularity_100@social_liberal }
		subtract_from_temp_variable = { sum = party_popularity_100@market_liberal }
		subtract_from_temp_variable = { sum = party_popularity_100@social_conservative }
		subtract_from_temp_variable = { sum = party_popularity_100@authoritarian_democrat }
		subtract_from_temp_variable = { sum = party_popularity_100@paternal_autocrat }
		subtract_from_temp_variable = { sum = party_popularity_100@national_populist }

		set_popularities = {
			totalist = party_popularity_100@totalist
			syndicalist = RUS_new_synd
			radical_socialist = RUS_new_radsoc
			social_democrat = party_popularity_100@social_democrat
			social_liberal = party_popularity_100@social_liberal
			market_liberal = party_popularity_100@market_liberal
			social_conservative = party_popularity_100@social_conservative
			authoritarian_democrat = party_popularity_100@authoritarian_democrat
			paternal_autocrat = party_popularity_100@paternal_autocrat
			national_populist = party_popularity_100@national_populist
		}
	}
}
SOV_setup_soviet_congress = {
	set_country_flag = SOV_congress_ongoing
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_the_trade_unions }
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_autonomies }
	if = {
		limit = { has_global_flag = RUS_land_reform_finished }
		set_country_flag = SOV_question_of_land_completed
	}
	else = {
		activate_targeted_decision = { target = ROOT decision = SOV_question_of_land }
	}
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_constitution }
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_banks_trade }
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_labor_conscription }
	
	set_variable = { SOV_soviet_constitution_political_power_factor = 0.02 }
	set_variable = { sov_congress_plsr_seats = ROOT.party_popularity@syndicalist }
	set_variable = { sov_congress_psr_seats = ROOT.party_popularity@social_liberal }
	set_variable = { sov_congress_nsp_seats = ROOT.party_popularity@radical_socialist }
	set_variable = { sov_congress_rsdrp_seats = ROOT.party_popularity@social_democrat }
	set_variable = { sov_congress_nrpr_seats = ROOT.party_popularity@national_populist }
	
	SOV_calculate_soviet_congress = yes	
}
SOV_calculate_soviet_congress = {	
	set_variable = { sov_congress_sum = 0 }
	add_to_variable = { sov_congress_sum = sov_congress_plsr_seats }
	add_to_variable = { sov_congress_sum = sov_congress_rsdrp_seats }
	if = {
		limit = { NOT = { has_country_flag = RUS_nsp_rkp_united } }
		add_to_variable = { sov_congress_sum = sov_congress_nsp_seats }
	}
	if = {
		limit = { NOT = { has_country_flag = psr_banned } }
		add_to_variable = { sov_congress_sum = sov_congress_psr_seats }
	}
	if = {
		limit = { NOT = { has_country_flag = nrpr_banned } }
		add_to_variable = { sov_congress_sum = sov_congress_nrpr_seats }
	}
	
	divide_variable = { sov_congress_plsr_seats = sov_congress_sum }
	divide_variable = { sov_congress_rsdrp_seats = sov_congress_sum }
	divide_variable = { sov_congress_nsp_seats = sov_congress_sum }
	divide_variable = { sov_congress_psr_seats = sov_congress_sum }
	divide_variable = { sov_congress_nrpr_seats = sov_congress_sum }
}
SOV_disband_soviet_congress = {
	clr_country_flag = SOV_congress_ongoing
	remove_targeted_decision = { target = ROOT decision = SOV_question_of_the_trade_unions }
	remove_targeted_decision = { target = ROOT decision = SOV_question_of_autonomies }
	remove_targeted_decision = { target = ROOT decision = SOV_question_of_land }
	remove_targeted_decision = { target = ROOT decision = SOV_question_of_constitution }
	remove_targeted_decision = { target = ROOT decision = SOV_question_of_banks_trade }
	remove_targeted_decision = { target = ROOT decision = SOV_question_of_labor_conscription }	
}
SOV_soviet_congress_increase_rkp = {
	if = {
		limit = { 
			NOT = { has_country_flag = rkp_banned }
		}
		custom_effect_tooltip = SOV_soviet_congress_increase_rkp
		add_popularity = { ideology = totalist popularity = 0.05 }
		set_temp_variable = { sov_congress_seats_change = 0.05 }
		add_to_variable = { sov_congress_rkp_seats = sov_congress_seats_change }
		SOV_calculate_soviet_congress = yes
	}
}
SOV_soviet_congress_increase_plsr = {
	custom_effect_tooltip = SOV_soviet_congress_increase_plsr
	add_popularity = { ideology = syndicalist popularity = 0.05 }
	add_to_variable = { sov_congress_plsr_seats = 0.05 }
	SOV_calculate_soviet_congress = yes
}
SOV_soviet_congress_increase_psr = {
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		custom_effect_tooltip = SOV_soviet_congress_increase_psr
		add_popularity = { ideology = radical_socialist popularity = 0.05 }
		add_to_variable = { sov_congress_psr_seats = 0.05 }
		SOV_calculate_soviet_congress = yes
	}
}
SOV_soviet_congress_increase_nsp = {
	if = {
		limit = { 
			NOT = { has_country_flag = RUS_nsp_rkp_united }
		}
		custom_effect_tooltip = SOV_soviet_congress_increase_nsp
		add_popularity = { ideology = radical_socialist popularity = 0.05 }
		add_to_variable = { sov_congress_nsp_seats = 0.05 }		
		SOV_calculate_soviet_congress = yes
	}
}
SOV_soviet_congress_increase_rsdrp = {
	custom_effect_tooltip = SOV_soviet_congress_increase_rsdrp
	add_popularity = { ideology = social_democrat popularity = 0.05 }
	add_to_variable = { sov_congress_rsdrp_seats = 0.05 }
	set_temp_variable = { divider = -2 }
	SOV_calculate_soviet_congress = yes	
}
SOV_soviet_congress_increase_nrpr = {
	if = {
		limit = { NOT = { has_country_flag = nrpr_banned } }
		custom_effect_tooltip = SOV_soviet_congress_increase_nrpr
		add_popularity = { ideology = radical_socialist popularity = 0.05 }
		add_to_variable = { sov_congress_nrpr_seats = 0.05 }		
		SOV_calculate_soviet_congress = yes
	}
}
SOV_run_election = {
	set_variable = { SOV_total_votes = 0 }
	
	every_owned_state = {
		set_variable = { SOV_total_state_votes = state_population_k }
		divide_variable = { SOV_total_state_votes = 125 }		
		round_variable = SOV_total_state_votes
		
		add_to_variable = { PREV.SOV_total_votes = SOV_total_state_votes }		
	}
	round_variable = SOV_total_votes
	
	#add_to_variable = { sov_congress_plsr_seats = sov_congress_sum_1 }
	#add_to_variable = { sov_congress_nsp_seats = sov_congress_sum_1 }
	#add_to_variable = { sov_congress_rsdrp_seats = sov_congress_sum_1 }	
	
	set_variable = { SOV_plsr_votes = sov_congress_plsr_seats }
	multiply_variable = { SOV_plsr_votes = SOV_total_votes }
	round_variable = SOV_plsr_votes
	
	set_variable = { SOV_nsp_votes = sov_congress_nsp_seats }
	multiply_variable = { SOV_nsp_votes = SOV_total_votes }
	round_variable = SOV_nsp_votes
	
	set_variable = { SOV_psr_votes = sov_congress_psr_seats }
	multiply_variable = { SOV_psr_votes = SOV_total_votes }
	round_variable = SOV_psr_votes
	
	set_variable = { SOV_rsdrp_votes = sov_congress_rsdrp_seats }
	multiply_variable = { SOV_rsdrp_votes = SOV_total_votes }
	round_variable = SOV_rsdrp_votes	
	
	set_variable = { SOV_nrpr_votes = sov_congress_nrpr_seats }
	multiply_variable = { SOV_nrpr_votes = SOV_total_votes }
	round_variable = SOV_nrpr_votes	
	
	log = "[THIS.GetName]: PLSR([?SOV_plsr_votes]) - NSP([?SOV_nsp_votes]) - RSDRP([?SOV_rsdrp_votes]) - PSR([?SOV_psr_votes]) - NRPR([?SOV_nrpr_votes]) - TOTAL([?SOV_total_votes])"
}
SOV_increase_activist = {
	custom_effect_tooltip = SOV_increase_activists_tt
	add_to_variable = { SOV_activist_influence = 1 }
}
SOV_decrease_activist = {
	custom_effect_tooltip = SOV_decrease_activists_tt
	add_to_variable = { SOV_activist_influence = -1 }
}
SOV_increase_chekist = {
	custom_effect_tooltip = SOV_increase_chekists_tt
	add_to_variable = { SOV_chekist_influence = 1 }
}
SOV_decrease_chekist = {
	custom_effect_tooltip = SOV_decrease_chekists_tt
	add_to_variable = { SOV_chekist_influence = -1 }
}
SOV_increase_legalist = {
	custom_effect_tooltip = SOV_increase_legalists_tt
	add_to_variable = { SOV_legalist_influence = 1 }
}
SOV_decrease_legalist = {
	custom_effect_tooltip = SOV_decrease_legalists_tt
	add_to_variable = { SOV_legalist_influence = -1 }
}
SOV_break_puppet_effect = {
	if = {
		limit = { 
			OR = { 
				has_autonomy_state = kr_autonomous_soviet_republic
				has_autonomy_state = kr_labour_commune
				has_autonomy_state = kr_soviet_republic_not_equal
				has_autonomy_state = kr_soviet_republic_equal
			}
		}
		leave_faction = yes
		overlord = {
			set_temp_variable = { former_overlord = THIS }
			set_autonomy = {
				target = PREV
				autonomy_state = autonomy_free
			}
		}
		peace_out_non_neighbours_after_leaving_faction = yes		
	}
}
SOV_puppet_ROOT_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		ROOT = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_possible_equal_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { 
						is_possible_soviet_republic_tag = yes 
						NOT = { has_global_flag = SOV_unitary_state }
					}
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_not_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_autonomous_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_autonomous_soviet_republic
							end_wars = no
						}
					}
				}
				if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_cultural_autonomy }
					}
					add_ideas = SOV_union_cultural_autonomy_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_unitary_state }
					}
					add_ideas = SOV_union_unitary_state_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_administrative_unity }
					}
					add_ideas = SOV_union_administrative_unity_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_federation_of_equals }
					}
					add_ideas = SOV_union_federation_of_equals_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_centralized_federation }
					}
					add_ideas = SOV_union_centralized_federation_puppet
				}
				restore_previous_government_type = yes
			}
		}
	}
	if = {
		limit = { ROOT = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = ROOT
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { 
			ROOT = { is_possible_soviet_republic_tag = yes }		
			NOT = { has_global_flag = SOV_unitary_state }
		}
		set_autonomy = {
			target = ROOT
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { ROOT = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = ROOT
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	if = {
		limit = { has_idea = SOV_union_cultural_autonomy }
		ROOT = { add_ideas = SOV_union_cultural_autonomy_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_unitary_state }
		ROOT = { add_ideas = SOV_union_unitary_state_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_administrative_unity }
		ROOT = { add_ideas = SOV_union_administrative_unity_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_federation_of_equals }
		ROOT = { add_ideas = SOV_union_federation_of_equals_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_centralized_federation }
		ROOT = { add_ideas = SOV_union_centralized_federation_puppet }
	}
	hidden_effect = {
		ROOT = { restore_previous_government_type = yes }
	}
}

SOV_puppet_PREV_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		PREV = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_possible_equal_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { 
						is_possible_soviet_republic_tag = yes						
						NOT = { has_global_flag = SOV_unitary_state }
					}
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_not_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_autonomous_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_autonomous_soviet_republic
							end_wars = no
						}
					}
				}
				if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_cultural_autonomy }
					}
					add_ideas = SOV_union_cultural_autonomy_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_unitary_state }
					}
					add_ideas = SOV_union_unitary_state_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_administrative_unity }
					}
					add_ideas = SOV_union_administrative_unity_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_federation_of_equals }
					}
					add_ideas = SOV_union_federation_of_equals_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_centralized_federation }
					}
					add_ideas = SOV_union_centralized_federation_puppet
				}
				restore_previous_government_type = yes
			}
		}
	}
	if = {
		limit = { PREV = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = PREV
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { 
			PREV = { is_possible_soviet_republic_tag = yes } 
			NOT = { has_global_flag = SOV_unitary_state }
		}
		set_autonomy = {
			target = PREV
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { PREV = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = PREV
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	if = {
		limit = { has_idea = SOV_union_cultural_autonomy }
		PREV = { add_ideas = SOV_union_cultural_autonomy_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_unitary_state }
		PREV = { add_ideas = SOV_union_unitary_state_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_administrative_unity }
		PREV = { add_ideas = SOV_union_administrative_unity_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_federation_of_equals }
		PREV = { add_ideas = SOV_union_federation_of_equals_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_centralized_federation }
		PREV = { add_ideas = SOV_union_centralized_federation_puppet }
	}
	hidden_effect = {
		PREV = { restore_previous_government_type = yes }
	}	
}

SOV_puppet_FROM_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		FROM = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_possible_equal_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = var:target
							autonomy_state = kr_soviet_republic_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { 
						is_possible_soviet_republic_tag = yes 
						NOT = { has_global_flag = SOV_unitary_state }
					}
					var:new_overlord = {
						set_autonomy = {
							target = var:target
							autonomy_state = kr_soviet_republic_not_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_autonomous_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_autonomous_soviet_republic
							end_wars = no
						}
					}
				}
				if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_cultural_autonomy }
					}
					add_ideas = SOV_union_cultural_autonomy_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_unitary_state }
					}
					add_ideas = SOV_union_unitary_state_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_administrative_unity }
					}
					add_ideas = SOV_union_administrative_unity_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_federation_of_equals }
					}
					add_ideas = SOV_union_federation_of_equals_puppet
				}
				else_if = {
					limit = {
						var:new_overlord = { has_idea = SOV_union_centralized_federation }
					}
					add_ideas = SOV_union_centralized_federation_puppet
				}
				restore_previous_government_type = yes
			}
		}
	}
	if = {
		limit = { FROM = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = FROM
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { 
			FROM = { is_possible_soviet_republic_tag = yes } 
			NOT = { has_global_flag = SOV_unitary_state }
		}
		set_autonomy = {
			target = FROM
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { FROM = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = FROM
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	if = {
		limit = { has_idea = SOV_union_cultural_autonomy }
		FROM = { add_ideas = SOV_union_cultural_autonomy_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_unitary_state }
		FROM = { add_ideas = SOV_union_unitary_state_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_administrative_unity }
		FROM = { add_ideas = SOV_union_administrative_unity_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_federation_of_equals }
		FROM = { add_ideas = SOV_union_federation_of_equals_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_centralized_federation }
		FROM = { add_ideas = SOV_union_centralized_federation_puppet }
	}
	hidden_effect = {
		FROM = { restore_previous_government_type = yes }
	}	
}

SOV_puppet_TARGET_effect = {
	hidden_effect = { var:target = { get_current_government_type = yes } }
	if = {
		limit = { var:target = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = var:target
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { 
			var:target = { is_possible_soviet_republic_tag = yes } 
			NOT = { has_global_flag = SOV_unitary_state }
		}
		set_autonomy = {
			target = var:target
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { var:target = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = var:target
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	if = {
		limit = { has_idea = SOV_union_cultural_autonomy }
		var:target = { add_ideas = SOV_union_cultural_autonomy_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_unitary_state }
		var:target = { add_ideas = SOV_union_unitary_state_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_administrative_unity }
		var:target = { add_ideas = SOV_union_administrative_unity_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_federation_of_equals }
		var:target = { add_ideas = SOV_union_federation_of_equals_puppet }
	}
	else_if = {
		limit = { has_idea = SOV_union_centralized_federation }
		var:target = { add_ideas = SOV_union_centralized_federation_puppet }
	}
	hidden_effect = {
		var:target = { restore_previous_government_type = yes }
	}
}
SOV_integrate_TARGET_effect = {
	set_temp_variable = { integrator = THIS }
	event_target:target = {
		every_subject_country = {
			custom_effect_tooltip = tooltip_white_line
			get_current_government_type = yes
			var:integrator = { puppet = PREV }
			restore_previous_government_type = yes
		}
		every_owned_state = {
			limit = { is_core_of = PREV }
			add_core_of = var:integrator
		}
	}
	custom_effect_tooltip = tooltip_white_line
	if = {
		limit = { event_target:target = { tag = KUB } }
		event_target:target = {
			every_unit_leader = {
				set_unit_leader_flag = KUB_original_leaders
				set_nationality = var:integrator
			}
		}
	}
	else_if = {
		limit = { event_target:target = { tag = TRM } }
		event_target:target = {
			every_unit_leader = {
				set_unit_leader_flag = KUB_original_leaders
				set_nationality = var:integrator
			}
		}
		set_country_flag = RUS_cannot_release_TRM
	}
	
	annex_country = {
		target = event_target:target
		transfer_troops = yes
	}
	if = {
		limit = { event_target:target = { is_ai = no } }
		change_tag_from = event_target:target
	}
}
SOV_integrate_PREV_effect = {
	set_temp_variable = { integrator = THIS }
	PREV = {
		every_subject_country = {
			custom_effect_tooltip = tooltip_white_line
			get_current_government_type = yes
			var:integrator = { puppet = PREV }
			restore_previous_government_type = yes
		}
		every_owned_state = {
			limit = { is_core_of = PREV }
			add_core_of = var:integrator
		}
	}
	custom_effect_tooltip = tooltip_white_line
	if = {
		limit = { PREV = { tag = KUB } }
		PREV = {
			every_unit_leader = {
				set_unit_leader_flag = KUB_original_leaders
				set_nationality = var:integrator
			}
		}
	}
	else_if = {
		limit = { PREV = { tag = TRM } }
		PREV = {
			every_unit_leader = {
				set_unit_leader_flag = TRM_original_leaders
				set_nationality = var:integrator
			}
		}
		set_country_flag = RUS_cannot_release_TRM
	}
	
	annex_country = {
		target = PREV
		transfer_troops = yes
	}
	if = {
		limit = { PREV = { is_ai = no } }
		change_tag_from = PREV
	}
}

remove_sovnarkom = {
	clr_country_flag = SOV_sovnarkom_established
	set_country_flag = SOV_sovnarkom_dissolved 	
}

setup_cultural_revolution_proletkult = {
	set_country_flag = SOV_proletkult_ongoing
	add_ideas = SOV_cultural_revolution_proletkult_idea
	unlock_decision_category_tooltip = SOV_Cultural_Revolution_Proletkult_decisions 
}

SOV_move_towards_soviets = {
	custom_effect_tooltip = SOV_soviet_influence_will_rise
	if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_tu 
		}
		remove_ideas = SOV_soviet_syndicalist_tu
		add_ideas = SOV_soviet_syndicalist_balance
	}
	else_if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_balance
		}
		remove_ideas = SOV_soviet_syndicalist_balance
		add_ideas = SOV_soviet_syndicalist_soviet
	}
}
SOV_move_towards_syndicates = {
	custom_effect_tooltip = SOV_syndicate_influence_will_rise
	if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_soviet
		}
		remove_ideas = SOV_soviet_syndicalist_soviet
		add_ideas = SOV_soviet_syndicalist_balance
	}
	else_if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_balance
		}
		remove_ideas = SOV_soviet_syndicalist_balance
		add_ideas = SOV_soviet_syndicalist_tu
	}
}		
SOV_create_uzbek_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = {
				OR = {
					state = 861
					state = 1281
					is_bukhara = yes
					is_kokand = yes
				}
				NOT = { 
					is_core_of = ALO
					is_core_of = KYR
					is_core_of = TAJ
				}
			}
			add_core_of = UZB
			remove_core_of = TRK
			remove_core_of = KHI
			add_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
		}
		UZB = {
			set_cosmetic_tag = UZB_uzbekistan
		}
	}
	activate_targeted_decision = { target = ROOT decision = RUS_create_karakalpakstan }
	activate_targeted_decision = { target = ROOT decision = RUS_give_karakalpakstan_to_kazakhs }
	activate_targeted_decision = { target = ROOT decision = RUS_create_fergana_autonomy }
	hidden_effect = {
		every_owned_state = {
			limit = {
				OR = {
					state = 861
					state = 1281
					is_bukhara = yes
					is_kokand = yes
				}
				NOT = { 
					is_core_of = ALO
					is_core_of = KYR
					is_core_of = TAJ
				}
			}
			add_core_of = UZB
			if = {
				limit = { has_resistance = yes }
				set_temp_variable = { previous_compliance = compliance }
				set_temp_variable = { previous_resistance = resistance }
				cancel_resistance = yes
			}
			remove_core_of = TRK
			remove_core_of = KHI
			start_resistance = UZB
			set_compliance = var:previous_compliance?0
			set_resistance = var:previous_resistance?0
			add_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
		}
		UZB = {
			set_cosmetic_tag = UZB_uzbekistan
			set_politics = { ruling_party = radical_socialist }
			if = {
				limit = { ROOT = { has_communist_government = yes } }
				set_party_name = {
					ideology = totalist
					name = UZB_uzbek_communist_party
					long_name = UZB_uzbek_communist_party_long
				}
				set_party_name = {
					ideology = syndicalist
					name = UZB_uzbek_communist_party
					long_name = UZB_uzbek_communist_party_long
				}
				set_party_name = {
					ideology = radical_socialist
					name = UZB_uzbek_communist_party
					long_name = UZB_uzbek_communist_party_long
				}
			}
			else = {
				set_party_name = {
					ideology = totalist
					name = UZB_uzbek_socialist_party
					long_name = UZB_uzbek_socialist_party_long
				}
				set_party_name = {
					ideology = syndicalist
					name = UZB_uzbek_socialist_party
					long_name = UZB_uzbek_socialist_party_long
				}
				set_party_name = {
					ideology = radical_socialist
					name = UZB_uzbek_socialist_party
					long_name = UZB_uzbek_socialist_party_long
				}
			}
			create_country_leader = {
				name = "Yoldash Akhunbabayev"
				picture = "gfx/leaders/UZB/Portrait_UZB_Yuldash_Akhunbabaev.png"
				expire = "1.1.1"
				ideology = authcom_subtype
			}
			create_country_leader = {
				name = "Yoldash Akhunbabayev"
				picture = "gfx/leaders/UZB/Portrait_UZB_Yuldash_Akhunbabaev.png"
				expire = "1.1.1"
				ideology = centralized_syndicalism_subtype
			}
		}
	}
}
SOV_create_turkmen_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = { 
				OR = {
					state = 584 
					state = 1275 
				}
			}
			add_core_of = KHI
			if = {
				limit = { ROOT = { has_country_flag = RUS_uzbek_is_uzbek } }
				remove_core_of = UZB
			}
			else = {
				remove_core_of = TRK
			}
			add_dynamic_modifier = { modifier = RUS_turkmen_autonomy }
		}
		KHI = { 
			set_cosmetic_tag = TMN 
		}			
	}
	activate_targeted_decision = { target = ROOT decision = RUS_greater_turkmenia }
	hidden_effect = {
		every_owned_state = {
			limit = { 
				OR = {
					state = 584 
					state = 1275 
				}
			}
			add_core_of = KHI
			if = {
				limit = { has_resistance = yes }
				add_resistance = 10
				add_compliance = 10
				set_temp_variable = { previous_compliance = compliance }
				set_temp_variable = { previous_resistance = resistance }
				cancel_resistance = yes
			}
			start_resistance = KHI
			set_compliance = var:previous_compliance?0
			set_resistance = var:previous_resistance?0	
			remove_core_of = TRK
			remove_core_of = UZB
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_turkestan_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_turkestan_autonomy }
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_uzbek_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
			}
			add_dynamic_modifier = { modifier = RUS_turkmen_autonomy }
		}
		KHI = { 
			set_cosmetic_tag = TMN 
			set_politics = { ruling_party = radical_socialist }
		}
	}
}
SOV_create_karakalpak_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = { state = 1278 }
			if = {
				limit = { has_resistance = yes }
				add_resistance = -5
				add_compliance = 5
			}
			add_dynamic_modifier = { modifier = RUS_karakalpak_autonomy }
		}		
	}
	activate_targeted_decision = { target = ROOT decision = RUS_greater_turkmenia }
	hidden_effect = {
		every_owned_state = {
			limit = { state = 1278 }
			if = {
				limit = { has_resistance = yes }
				add_resistance = -5
				add_compliance = 5
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_turkestan_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_turkestan_autonomy }
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_uzbek_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
			}
			add_dynamic_modifier = { modifier = RUS_karakalpak_autonomy }
		}
	}
}
SOV_create_tashkent_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = { state = 407 }
			if = {
				limit = { has_resistance = yes }
				add_resistance = 5
				add_compliance = 5
			}
			add_dynamic_modifier = { modifier = RUS_tashkent_autonomy }
		}
	}
	hidden_effect = {
		every_owned_state = {
			limit = { state = 407 }
			if = {
				limit = { has_resistance = yes }
				add_resistance = 5
				add_compliance = 5
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_turkestan_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_turkestan_autonomy }
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_uzbek_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
			}
			add_dynamic_modifier = { modifier = RUS_tashkent_autonomy }
		}
	}
}
SOV_create_fergana_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = { state = 1279 }
			if = {
				limit = { has_resistance = yes }
				add_resistance = 15
				add_compliance = 5
			}
			add_dynamic_modifier = { modifier = RUS_fergana_autonomy }
		}
	}
	hidden_effect = {
		every_owned_state = {
			limit = { state = 1279 }
			if = {
				limit = { has_resistance = yes }
				add_resistance = 15
				add_compliance = 5
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_turkestan_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_turkestan_autonomy }
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_uzbek_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
			}
			add_dynamic_modifier = { modifier = RUS_fergana_autonomy }
		}
	}
}
SOV_create_kyrgyzia_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = { 
				OR = {
					state = 1196
					state = 1042
					state = 1211
					state = 586
				}
			}
			add_core_of = KYR
			if = {
				limit = { has_resistance = yes }
				add_resistance = -10
				add_compliance = 10
			}
			if = {
				limit = { ROOT = { has_country_flag = RUS_uzbek_is_uzbek } }
				remove_core_of = UZB
			}
			else = {
				remove_core_of = TRK
			}
			add_dynamic_modifier = { modifier = RUS_kyrgyz_autonomy }
		}
	}
	hidden_effect = {
		every_owned_state = {
			limit = { 
				OR = {
					state = 1196
					state = 1042
					state = 1211
					state = 586
				}
			}
			add_core_of = KYR
			if = {
				limit = { has_resistance = yes }
				add_resistance = -10
				add_compliance = 10
				set_temp_variable = { previous_compliance = compliance }
				set_temp_variable = { previous_resistance = resistance }
				cancel_resistance = yes
			}
			start_resistance = KYR
			set_compliance = var:previous_compliance?0
			set_resistance = var:previous_resistance?0
			remove_core_of = TRK
			remove_core_of = UZB
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_turkestan_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_turkestan_autonomy }
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_uzbek_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
			}
			add_dynamic_modifier = { modifier = RUS_kyrgyz_autonomy }
		}
	}
}
SOV_create_tajik_autonomy = {
	effect_tooltip = {
		every_owned_state = {
			limit = { 
				OR = {
					state = 732 
					state = 1210 
				}
			}
			add_core_of = TAJ
			if = {
				limit = { has_resistance = yes }
				add_resistance = -5
				add_compliance = 5
			}
			if = {
				limit = { ROOT = { has_country_flag = RUS_uzbek_is_uzbek } }
				remove_core_of = UZB
			}
			else = {
				remove_core_of = TRK
			}
			add_dynamic_modifier = { modifier = RUS_tajik_autonomy }
		}		
		TAJ = { 
			set_cosmetic_tag = TAJ_tajikistan
		}
	}
	hidden_effect = {
		every_owned_state = {
			limit = { 
				OR = {
					state = 732 
					state = 1210 
				}
			}
			add_core_of = TAJ
			if = {
				limit = { has_resistance = yes }
				add_resistance = -5
				add_compliance = 5
				set_temp_variable = { previous_compliance = compliance }
				set_temp_variable = { previous_resistance = resistance }
				cancel_resistance = yes
			}
			start_resistance = TAJ
			set_compliance = var:previous_compliance?0
			set_resistance = var:previous_resistance?0
			remove_core_of = TRK
			remove_core_of = UZB
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_turkestan_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_turkestan_autonomy }
			}
			if = {
				limit = { has_dynamic_modifier = { modifier = RUS_uzbek_autonomy } }
				remove_dynamic_modifier = { modifier = RUS_uzbek_autonomy }
			}
			add_dynamic_modifier = { modifier = RUS_tajik_autonomy }
		}
		if = {
			limit = {
				UZB = { has_unit_leader = 68631 }
			}
			UZB = { 
				random_unit_leader = {
					limit = { has_id = 68631 }
					set_nationality = TAJ
				}					
			}
		}
		else_if = {
			limit = {
				KAZ = { has_unit_leader = 68631 }
			}
			KAZ = { 
				random_unit_leader = {
					limit = { has_id = 68631 }
					set_nationality = TAJ
				}					
			}
		}
		else_if = {
			limit = {
				TRK = { has_unit_leader = 68631 }
			}
			TRK = { 
				random_unit_leader = {
					limit = { has_id = 68631 }
					set_nationality = TAJ
				}					
			}
		}
		else_if = {
			limit = {
				XXA = { has_unit_leader = 68631 }
			}
			XXA = { 
				random_unit_leader = {
					limit = { has_id = 68631 }
					set_nationality = TAJ
				}					
			}
		}
		TAJ = { 
			set_cosmetic_tag = TAJ_tajikistan
			set_politics = { ruling_party = radical_socialist }
		}
	}	
}
RUS_remove_nep = {
	custom_effect_tooltip = SOV_Supplant_Private_Sector_tt
	remove_dynamic_modifier = { modifier = RUS_Foreign_Concessions_modifier }
	every_other_country = {
		limit = {
			has_idea = RUS_foreign_profits
		}
		remove_ideas = RUS_foreign_profits
	}
	clear_variable = RUS_foreign_construction_speed
	clear_variable = RUS_foreign_factory_output
	clear_variable = RUS_foreign_factories
	hidden_effect = {
		remove_dynamic_modifier = { modifier = RUS_New_Economic_Policy_modifier }
		add_to_variable = { RUS_NEP_industrial_capacity_factory = 0.2 }
		add_to_variable = { RUS_NEP_consumer_goods_factor = 0.1 }
		add_dynamic_modifier = { modifier = RUS_Aftermath_Of_NEP_modifier }	
	}
	add_timed_idea = {
		idea = RUS_aftermath_of_nep
		days = 450
	}
	hidden_effect = {
		country_event = { id = russoc.404 days = 350 random_days = 300 }
	}
}
SOV_remove_counter_rev_sabotage = {
	if = {
		limit = { has_idea = SOV_counter_rev_sabotage_1 }
		swap_ideas = {
			remove_idea = SOV_counter_rev_sabotage_1
			add_idea = SOV_counter_rev_sabotage_2
		}
	}
	else_if = {
		limit = { has_idea = SOV_counter_rev_sabotage_2 }
		swap_ideas = {
			remove_idea = SOV_counter_rev_sabotage_2
			add_idea = SOV_counter_rev_sabotage_3
		}
	}
	else_if = {
		limit = { has_idea = SOV_counter_rev_sabotage_3 }
		swap_ideas = {
			remove_idea = SOV_counter_rev_sabotage_3
			add_idea = SOV_counter_rev_sabotage_4
		}
	}
	else_if = {
		limit = { has_idea = SOV_counter_rev_sabotage_4 }
		swap_ideas = {
			remove_idea = SOV_counter_rev_sabotage_4
			add_idea = SOV_counter_rev_sabotage_5
		}
	}
	else_if = {
		limit = { has_idea = SOV_counter_rev_sabotage_5 }
		swap_ideas = {
			remove_idea = SOV_counter_rev_sabotage_5
			add_idea = SOV_counter_rev_sabotage_6
			days = 90
		}
	}
}
SOV_increase_kpbu_legitimacy = {
	if = {
		limit = { 
			check_variable = { RUS.SOV_kpbu_legitimacy < 7 }
		}
		custom_effect_tooltip = SOV_change_kpbu_legitimacy
		add_to_variable = { RUS.SOV_kpbu_legitimacy = 1 }
		add_to_variable = { 
			RUS.SOV_kpbu_conscription_factor = 0.10 
			tooltip = conscription_factor_tooltip
		}
		add_to_variable = { 
			RUS.SOV_kpbu_compliance_gain = 0.01 
			tooltip = compliance_gain_tooltip
		}
		add_to_variable = { 
			RUS.SOV_kpbu_resistance_target = 0.05 
			tooltip = resistance_target_tooltip
		}
		add_to_variable = { 
			RUS.SOV_kpbu_resistance_growth = 0.05 
			tooltip = resistance_growth_tooltip
		}
		
		clamp_variable = { var = RUS.SOV_kpbu_legitimacy min = 0 max = 7 }
		clamp_variable = { var = RUS.SOV_kpbu_conscription_factor min = -0.8 max = 0 }
		clamp_variable = { var = RUS.SOV_kpbu_compliance_gain min = -0.08 max = 0 }
		clamp_variable = { var = RUS.SOV_kpbu_resistance_target min = 0 max = 0.40 }
		clamp_variable = { var = RUS.SOV_kpbu_resistance_growth min = 0 max = 0.45 }
	}
}
SOV_decrease_kpbu_legitimacy = {
	if = {
		limit = { 
			check_variable = { RUS.SOV_kpbu_legitimacy > 0 }
		}
		custom_effect_tooltip = SOV_change_kpbu_legitimacy
		add_to_variable = { RUS.SOV_kpbu_legitimacy = -1 }
		
		add_to_variable = { 
			RUS.SOV_kpbu_conscription_factor = -0.10 
			tooltip = conscription_factor_tooltip
		}
		add_to_variable = { 
			RUS.SOV_kpbu_compliance_gain = -0.01 
			tooltip = compliance_gain_tooltip
		}
		add_to_variable = { 
			RUS.SOV_kpbu_resistance_target = -0.05 
			tooltip = resistance_target_tooltip
		}
		add_to_variable = { 
			RUS.SOV_kpbu_resistance_growth = -0.05 
			tooltip = resistance_growth_tooltip
		}
		
		clamp_variable = { var = RUS.SOV_kpbu_legitimacy min = 0 max = 7 }
		clamp_variable = { var = RUS.SOV_kpbu_conscription_factor min = -0.8 max = 0 }
		clamp_variable = { var = RUS.SOV_kpbu_compliance_gain min = -0.08 max = 0 }
		clamp_variable = { var = RUS.SOV_kpbu_resistance_target min = 0 max = 0.40 }
		clamp_variable = { var = RUS.SOV_kpbu_resistance_growth min = 0 max = 0.45 }
	}
}
#is triggered for UKR
SOV_start_civil_war_UKR = {
	start_civil_war = {
		### basics ###
		ideology = totalist
		size = 0
		navy_ratio = 0

		### states ###
		capital = 221
		states = { 221 }			

		### characters ###
		keep_all_characters = yes

		### effects ###
		set_temp_variable = { UKR_civil_war_target = THIS }
	}

	#move all Bolsheviks to revolter
	every_unit_leader = {
		limit = { has_unit_leader_flag = UKR_bolshevist_officer}
		set_nationality = var:UKR_civil_war_target
	}
	
	#setup revolter
	var:UKR_civil_war_target = {
		#set cosmetic tag
		save_global_event_target_as = UKR_soviet_republic
		set_cosmetic_tag = UKR_bolshevist
		
		set_country_flag = UKR_disable_borotbist_uprisings
		copy_government_of_PREV = yes
		transfer_technology_and_slots = yes
		
		#set leaders and ideology
		create_country_leader = {
			name = "Yevhenia Bosh"
			desc = "POLITICS_YEVHENIYA_BOSCH_DESC"
			picture = "gfx/leaders/UKR/Portrait_UKR_Evheniya_Bosch.png"
			expire = "1.1.1"
			ideology = authcom_subtype
		}
		set_politics = {
			ruling_party = totalist
			elections_allowed = no
		}
		get_current_government_type = yes
		RUS = {
			set_autonomy = {
				target = var:UKR_civil_war_target
				autonomous_state = kr_soviet_republic_not_equal
			}
		}
		restore_previous_government_type = yes	
		load_focus_tree = { tree = UKR_focus keep_completed = yes }
		complete_national_focus = UKR_Establish_Dictatorship_Of_UKPB
		mark_focus_tree_layout_dirty = yes
		add_ideas = {
			war_economy
			closed_economy
			service_by_requirement
			UKR_Yevhenia_Bosh_hog_tot
			UKR_Vlas_Chubar_for_tot
			UKR_Volodymyr_Aussem_eco_tot
			UKR_Yuri_Kotsiubinsky_sec_tot
			UKR_unpopular_regime
			UKR_lingering_ukrainisation
		}
		set_party_name = {
			ideology = totalist
			name = UKR_totalist_party2
			long_name  = UKR_totalist_party2_long
		}
		#remove redundant wargoals
		if = {
			limit = { has_wargoal_against = PREV }
			remove_wargoal = { target = PREV type = all }
		}			
		every_state = {
			limit = {
				is_core_of = event_target:UKR_soviet_republic
			}
			remove_core_of = event_target:UKR_soviet_republic
			add_claim_by = event_target:UKR_soviet_republic
			add_dynamic_modifier = { modifier = SOV_ukrainian_government_rebellion }
		}
		add_ai_strategy = {
			type = contain
			id = "UKR"
			value = 200
		}
		add_ai_strategy = {
			type = conquer
			id = "UKR"
			value = 500
		}
		add_ai_strategy = {
			type = antagonize
			id = "UKR"
			value = 200
		}
		division_template = {
			name = "Ukrainska Radianska Dyviziia"
			division_names_group = USR_INF_01
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
				infantry = { x = 2 y = 0 }
				infantry = { x = 2 y = 1 }
				infantry = { x = 2 y = 2 }
			}
			support = {
				artillery = { x = 0 y = 0 }
			}
		}
		division_template = {
			name = "Kinnyi Dyvizion"
			division_names_group = UKR_CAV_01
			regiments = {
				cavalry = { x = 0 y = 0 }
				cavalry = { x = 0 y = 1 }
				cavalry = { x = 0 y = 2 }
				cavalry = { x = 1 y = 0 }
				cavalry = { x = 1 y = 1 }
				cavalry = { x = 1 y = 2 }
			}
			support = {
				recon = { x = 0 y = 0 }
			}
		}
		division_template = {
			name = "Motostrilets'ka Dyviziia"
			division_names_group = UKR_MOT_01
			regiments = {
				motorized = { x = 0 y = 0 }
				motorized = { x = 0 y = 1 }
				motorized = { x = 0 y = 2 }
				motorized = { x = 1 y = 0 }
				motorized = { x = 1 y = 1 }
				motorized = { x = 1 y = 2 }
				light_armor = { x = 2 y = 0 }
			}
			support = {
				engineer = { x = 0 y = 0 }
			}
		}
		division_template = {
			name = "Chervona Hvardiia"
			division_names_group = UKR_MIL_01
			regiments = {
				militia = { x = 0 y = 0 }
				militia = { x = 0 y = 1 }
				militia = { x = 0 y = 2 }
				militia = { x = 1 y = 0 }
				militia = { x = 1 y = 1 }
				militia = { x = 1 y = 2 }
			}
		}	
		if = {
			limit = { RUS = { has_country_flag = SOV_kpbu_reduce_army_by_two } }
			add_to_variable = { RUS.SOV_kpbu_army_count = -2 }
			clamp_variable = { var = RUS.SOV_kpbu_army_count min = 0 }
		}
		
		#spawn units
		221 = {
			create_unit = {
				division = "division_template = \"Chervona Hvardiia\" start_experience_factor = 0.2"
				owner = PREV
				count = var:RUS.SOV_kpbu_army_count
			}
		}		
		delete_unit_template_and_units = {
			division_template = "Sichovi Striltsi"
			disband = yes #will refund equipment and manpower
		}
		delete_unit_template_and_units = {
			division_template = "Halytskyi korpus Sichovykh Striltsiv"
			disband = yes #will refund equipment and manpower
		}
		delete_unit_template_and_units = {
			division_template = "Petliurivtsi"
			disband = yes #will refund equipment and manpower
		}
		delete_unit_template_and_units = {
			division_template = "Kinnohirskyi Dyvizion"
			disband = yes #will refund equipment and manpower
		}
	}
	if = {
		limit = { has_wargoal_against = var:UKR_civil_war_target }
		remove_wargoal = { target = var:UKR_civil_war_target type = all }
	}		
	
	#if at war, give wargoal to enemies
	every_other_country = {
		limit = {
			OR = {
				has_wargoal_against = PREV
				has_offensive_war_with = PREV
			}
			can_declare_war_on = var:UKR_civil_war_target
		}
		create_wargoal = {
			target = var:UKR_civil_war_target
			type = annex_everything
		}
	}
}
SOV_remove_proletkult = {
	if = {
		limit = { has_idea = SOV_proletkult_lunacharsky }
		remove_ideas = SOV_proletkult_lunacharsky
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_bogdanov }
		remove_ideas = SOV_proletkult_bogdanov
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_gastev }
		remove_ideas = SOV_proletkult_gastev
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_krupskaya }
		remove_ideas = SOV_proletkult_krupskaya
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_bubnov }
		remove_ideas = SOV_proletkult_bubnov
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_potemkin }
		remove_ideas = SOV_proletkult_potemkin
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_pletnev }
		remove_ideas = SOV_proletkult_pletnev
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_mayakovsky }
		remove_ideas = SOV_proletkult_mayakovsky
	}
	else_if = {
		limit = { has_idea = SOV_proletkult_polyansky }
		remove_ideas = SOV_proletkult_polyansky
	}
}
SOV_decrease_zinoviev_resistance = {
	if = {
		limit = { has_idea = SOV_zinovievite_resistance_4 }
		swap_ideas = {
			remove_idea = SOV_zinovievite_resistance_4
			add_idea = SOV_zinovievite_resistance_3
		}
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_3 }
		swap_ideas = {
			remove_idea = SOV_zinovievite_resistance_3
			add_idea = SOV_zinovievite_resistance_2
		}
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_2 }
		swap_ideas = {
			remove_idea = SOV_zinovievite_resistance_2
			add_idea = SOV_zinovievite_resistance_1
		}
	}
	set_temp_variable = { politburo_change = -1 }
	SOV_change_politburo_left_communists = yes
}
SOV_increase_zinoviev_resistance = {
	if = {
		limit = { has_idea = SOV_zinovievite_resistance_3 }
		swap_ideas = {
			remove_idea = SOV_zinovievite_resistance_3
			add_idea = SOV_zinovievite_resistance_4
		}
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_2 }
		swap_ideas = {
			remove_idea = SOV_zinovievite_resistance_2
			add_idea = SOV_zinovievite_resistance_3
		}
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_1 }
		swap_ideas = {
			remove_idea = SOV_zinovievite_resistance_1
			add_idea = SOV_zinovievite_resistance_2
		}
	}
}
SOV_remove_zinoviev_resistance = {
	if = {
		limit = { has_idea = SOV_zinovievite_resistance_4 }
		remove_ideas = SOV_zinovievite_resistance_4
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_3 }
		remove_ideas = SOV_zinovievite_resistance_3
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_2 }
		remove_ideas = SOV_zinovievite_resistance_2
	}
	else_if = {
		limit = { has_idea = SOV_zinovievite_resistance_1 }
		remove_ideas = SOV_zinovievite_resistance_1
	}
}
SOV_new_vtsik_election = {
	if = {
		limit = {
			NOT = { has_country_flag = SOV_vtsik_zalutsky }
			check_variable = { Politburo_Centre_Faction_display > Politburo_Bukharin_Faction_display }
			check_variable = { Politburo_Centre_Faction_display > Politburo_Hardliner_Faction_display }
			OR = {
				check_variable = { Politburo_Centre_Faction_display > 0.8 }
				check_variable = { Politburo_Centre_Faction_display = 0.8 }
			}
		}
		country_event = { id = russoc.266 days = 4 }
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = SOV_vtsik_krestinsky }
			check_variable = { Politburo_Centre_Faction_display > Politburo_Bukharin_Faction_display }
			check_variable = { Politburo_Centre_Faction_display > Politburo_Hardliner_Faction_display }
			OR = {
				check_variable = { Politburo_Centre_Faction_display > 0.65 }
				check_variable = { Politburo_Centre_Faction_display = 0.65 }
			}
			check_variable = { Politburo_Centre_Faction_display < 0.8 }
			NOT = { has_country_flag = SOV_secretary_zinovievite }
		}
		country_event = { id = russoc.266 days = 4 }
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = SOV_vtsik_serebryakov }
			OR = {
				check_variable = { Politburo_Centre_Faction_display > Politburo_Bukharin_Faction_display }
				check_variable = { Politburo_Centre_Faction_display = Politburo_Bukharin_Faction_display }
			}
			OR = {
				check_variable = { Politburo_Centre_Faction_display > Politburo_Hardliner_Faction_display }			
				check_variable = { Politburo_Centre_Faction_display = Politburo_Hardliner_Faction_display }			
			}
			OR = {
				check_variable = { Politburo_Centre_Faction_display < 0.65 }
				has_country_flag = SOV_secretary_zinovievite 
			}
		}
		country_event = { id = russoc.266 days = 4 }
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = SOV_vtsik_vladimirsky }
			check_variable = { Politburo_Hardliner_Faction_display > Politburo_Bukharin_Faction_display }
			check_variable = { Politburo_Hardliner_Faction_display > Politburo_Centre_Faction_display }
			OR = {
				check_variable = { Politburo_Hardliner_Faction_display > 0.65 }
				check_variable = { Politburo_Hardliner_Faction_display = 0.65 }
			}
		}
		country_event = { id = russoc.266 days = 4 }
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = SOV_vtsik_kalinin }
			OR = {
				check_variable = { Politburo_Hardliner_Faction_display > Politburo_Bukharin_Faction_display }
				check_variable = { Politburo_Hardliner_Faction_display = Politburo_Bukharin_Faction_display }
			}
			OR = {
				check_variable = { Politburo_Hardliner_Faction_display > Politburo_Centre_Faction_display }			
				check_variable = { Politburo_Hardliner_Faction_display = Politburo_Centre_Faction_display }			
			}
			check_variable = { Politburo_Hardliner_Faction_display < 0.65 }
		}
		country_event = { id = russoc.266 days = 4 }
	}
	else_if = {			
		limit = {
			NOT = { has_country_flag = SOV_vtsik_smirnov }
			OR = {
				check_variable = { Politburo_Bukharin_Faction_display > Politburo_Bukharin_Faction_display }
				check_variable = { Politburo_Centre_Faction_display > Politburo_Bukharin_Faction_display }
			}
		}
		country_event = { id = russoc.266 days = 4 }
	}
}
SOV_kaganovich_coup = {
	if = {
		limit = { check_variable = { SOV_kaga_acts > 4 } }
		country_event = { id = russoc.380 days = 7 }
	}
}
SOV_workers_opposition_will_hate_this = {
	if = {
		limit = { has_country_flag = SOV_politburo_workers_opposition_exist }
		custom_effect_tooltip = SOV_workers_opposition_will_hate_this
	}
	add_to_variable = { SOV_unity_wo = -1 }
}
SOV_kirovites_will_hate_this = {
	if = {
		limit = { SOV_kirov_in_power = no }
		if = {
			limit = { has_country_flag = SOV_politburo_kirovites_exist }
			custom_effect_tooltip = SOV_kirovites_will_hate_this
		}
		add_to_variable = { SOV_unity_ki = -1 }
	}
}
SOV_bukharinists_will_hate_this = {
	if = {
		limit = { SOV_bukharin_in_power = no }
		if = {
			limit = { NOT = { has_country_flag = SOV_politburo_bukharin_banned } }
			custom_effect_tooltip = SOV_bukharinists_will_hate_this
		}
		add_to_variable = { SOV_unity_bu = -1 }
	}
}
SOV_rykovites_will_hate_this = {
	if = {
		limit = { SOV_bukharin_in_power = no }
		if = {
			limit = { has_country_flag = SOV_politburo_zhdanovites_exist }
			custom_effect_tooltip = SOV_zhdanovites_will_hate_this
		}
		else_if = {
			limit = { has_country_flag = SOV_politburo_rykovites_exist }
			custom_effect_tooltip = SOV_rykovites_will_hate_this
		}
		add_to_variable = { SOV_unity_ry = -1 }
	}
}
SOV_old_bolsheviks_will_hate_this = {
	if = {
		limit = { 
			SOV_kamenev_in_power = no
			SOV_sokolnikov_in_power = no
		}
		if = {
			limit = { has_country_flag = SOV_politburo_old_guard_exists }
			custom_effect_tooltip = SOV_old_bolsheviks_will_hate_this
		}
		add_to_variable = { SOV_unity_ob = -1 }
	}
}
SOV_zinovievites_will_hate_this = {
	if = {
		limit = { 
			SOV_kamenev_in_power = no
			SOV_sokolnikov_in_power = no
		}
		if = {
			limit = { has_country_flag = SOV_rkp_in_politburo }
			custom_effect_tooltip = SOV_zinovievites_will_hate_this
		}
		add_to_variable = { SOV_unity_lc = -1 }
	}
}