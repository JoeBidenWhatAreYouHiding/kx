NEP_remove_monarchy = {
	
	create_country_leader = {
		name = "Samrajya Shumsher Jang Bahadur Rana"
		desc = "NEP_samrajya_shumsher_jang_bahadur_rana_leader_desc"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Samrajya_Shumsher_Jang_Bahadur_Rana.png"
		expire = "1.1.1"
		ideology = neo_feudalism_subtype
	}
	create_country_leader = {
		name = "Samrajya Shumsher Jang Bahadur Rana"
		desc = "NEP_samrajya_shumsher_jang_bahadur_rana_leader_desc"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Samrajya_Shumsher_Jang_Bahadur_Rana.png"
		expire = "1.1.1"
		ideology = oligarchy_subtype
	}
	create_country_leader = {
		name = "Samrajya Shumsher Jang Bahadur Rana"
		desc = "NEP_samrajya_shumsher_jang_bahadur_rana_leader_desc"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Samrajya_Shumsher_Jang_Bahadur_Rana.png"
		expire = "1.1.1"
		ideology = progressive_conservatism_subtype
	}
}

NEP_create_tribhuvan = {
	create_country_leader = {
		name = "Tribhuvan"
		desc = "POLITICS_TRIBHUVANA_DESC"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Tribhuvana.png"
		expire = "1.1.1"
		ideology = humanistic_capitalism_subtype
		traits = { NEP_defiant_hostage }
	}
	create_country_leader = {
		name = "Tribhuvan"
		desc = "POLITICS_TRIBHUVANA_DESC"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Tribhuvana.png"
		expire = "1.1.1"
		ideology = soclib_progressive_democracy_subtype
		traits = { NEP_defiant_hostage }
	}
	create_country_leader = {
		name = "Tribhuvan"
		desc = "POLITICS_TRIBHUVANA_DESC"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Tribhuvana.png"
		expire = "1.1.1"
		ideology = socdem_democratic_socialism_subtype
		traits = { NEP_defiant_hostage }
	}
}
NEP_create_samrajya = {
	create_country_leader = {
		name = "Samrajya"
		desc = "NEP_samrajya_shumsher_jang_bahadur_rana_leader_desc"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Samrajya_Shumsher_Jang_Bahadur_Rana.png"
		expire = "1.1.1"
		ideology = neo_feudalism_subtype
	}
	create_country_leader = {
		name = "Samrajya"
		desc = "NEP_samrajya_shumsher_jang_bahadur_rana_leader_desc"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Samrajya_Shumsher_Jang_Bahadur_Rana.png"
		expire = "1.1.1"
		ideology = oligarchy_subtype
	}
	create_country_leader = {
		name = "Samrajya"
		desc = "NEP_samrajya_shumsher_jang_bahadur_rana_leader_desc"
		picture = "gfx/leaders/NEP/Portrait_Nepal_Samrajya_Shumsher_Jang_Bahadur_Rana.png"
		expire = "1.1.1"
		ideology = progressive_conservatism_subtype
	}
}

NEP_create_soc_generals = {
	create_corps_commander = {#
		name = "Ram Prasad Rai"
		portrait_path = "gfx/leaders/NEP/Portrait_Nepal_Pam_Prasad_Rai.png"
		desc = NEP_ram_prasad_rai_leader_desc
		traits = { brilliant_strategist }
		skill = 2
		attack_skill = 2
		defense_skill = 1
		planning_skill = 2
		logistics_skill = 2
	}
	create_corps_commander = {#
		name = "Kunwar Inderjit Singh "
		portrait_path = "gfx/leaders/NEP/Portrait_Nepal_Kunwar_Inderjit_Singh.png"
		traits = { politically_connected infantry_officer }
		skill = 1
		attack_skill = 1
		defense_skill = 1
		planning_skill = 1
		logistics_skill = 1
	}
	every_unit_leader = {
		limit = { has_trait = NEP_rana_commander }
		set_nationality = NSW
	}
}

NEP_puppet_setup = {
	hidden_effect = {
		### disable conspiracy minigame if active ###
		if = {
			limit = { has_country_flag = NEP_conspiracy_ongoing_flag }
			clr_country_flag = NEP_conspiracy_ongoing_flag
			remove_ideas = {
				NEP_crushing_the_conspirators_1
				NEP_crushing_the_conspirators_2
				NEP_covert_support_for_the_mukti_sena_1
				NEP_covert_support_for_the_mukti_sena_2_socialist
				NEP_covert_support_for_the_mukti_sena_2_democratic
				NEP_crushing_the_conspirators_monarchy
				NEP_covert_support_for_the_mukti_sena_monarchy
			}
			remove_mission = NEP_conspiracy_mission
			remove_targeted_decision = { target = BHC decision = NEP_weaken_BHC_influence_decision }
			remove_targeted_decision = { target = DEH decision = NEP_weaken_DEH_influence_decision }
			remove_targeted_decision = { target = BHC decision = NEP_increase_BHC_influence_decision }
			remove_targeted_decision = { target = DEH decision = NEP_increase_DEH_influence_decision }
			BHC = {
				remove_mission = NEP_conspiracy_mission
				remove_targeted_decision = { target = NEP decision = NEP_increase_BHC_influence_decision }
				remove_targeted_decision = { target = NEP decision = NEP_india_send_guns_decision }
				remove_targeted_decision = { target = NEP decision = NEP_india_command_power_decision }
				clear_variable = PREV.NEP_conspiracy_influence_var_@THIS
				clear_variable = PREV.NEP_conspiracy_increase_cost_@THIS
				clear_variable = PREV.NEP_conspiracy_lower_cost_@THIS
			}
			DEH = {
				remove_mission = NEP_conspiracy_mission
				remove_targeted_decision = { target = NEP decision = NEP_increase_DEH_influence_decision }
				remove_targeted_decision = { target = NEP decision = NEP_india_send_guns_decision }
				remove_targeted_decision = { target = NEP decision = NEP_india_command_power_decision }
				clear_variable = PREV.NEP_conspiracy_influence_var_@THIS
				clear_variable = PREV.NEP_conspiracy_increase_cost_@THIS
				clear_variable = PREV.NEP_conspiracy_lower_cost_@THIS
			}
		}

		### disable Indian Nightmare decisions ###
		NEP_disable_indian_nightmare_decisions = yes

		### if NatPop, rename the slot to Rana Dynasty ###
		if = {
			limit = { has_government = national_populist }
			set_party_name = {
				ideology = national_populist
				name = NEP_paternal_autocrat_party
				long_name = NEP_paternal_autocrat_party
			}
		}
		else = {
			set_party_name = {
				ideology = national_populist
				name = NEP_national_populist_party
				long_name = NEP_national_populist_party
			}
		}

		### update political tree ###
		if = {
			limit = { has_government = authoritarian_democrat }
			if = {
				limit = { NOT = { has_completed_focus = NEP_our_ruler_glorious } }
				unlock_national_focus = NEP_our_ruler_glorious
			}
			if = {
				limit = { has_completed_focus = NEP_regency_of_the_ranas }
				uncomplete_national_focus = {
					focus = NEP_regency_of_the_ranas
					uncomplete_children = yes
				}
			}
			if = {
				limit = { has_completed_focus = NEP_the_unshackling_of_nepal }
				uncomplete_national_focus = {
					focus = NEP_the_unshackling_of_nepal
					uncomplete_children = yes
				}
			}
		}
		else_if = {
			limit = { has_dictatorship_government = yes }
			if = {
				limit = { NOT = { has_completed_focus = NEP_regency_of_the_ranas } }
				unlock_national_focus = NEP_regency_of_the_ranas
			}
			if = {
				limit = { has_completed_focus = NEP_our_ruler_glorious }
				uncomplete_national_focus = {
					focus = NEP_our_ruler_glorious
					uncomplete_children = yes
				}
			}
			if = {
				limit = { has_completed_focus = NEP_the_unshackling_of_nepal }
				uncomplete_national_focus = {
					focus = NEP_the_unshackling_of_nepal
					uncomplete_children = yes
				}
			}
		}
		else = {
			if = {
				limit = { NOT = { has_completed_focus = NEP_the_unshackling_of_nepal } }
				unlock_national_focus = NEP_the_unshackling_of_nepal
			}
			if = {
				limit = { has_socialist_government = yes }
				if = {
					limit = { has_completed_focus = NEP_formation_of_the_interim_government }
					complete_national_focus = NEP_loyalty_to_the_liberators
					uncomplete_national_focus = {
						focus = NEP_formation_of_the_interim_government
						uncomplete_children = yes
					}
				}
			}
			else = {
				if = {
					limit = { has_completed_focus = NEP_loyalty_to_the_liberators }
					complete_national_focus = NEP_formation_of_the_interim_government
					uncomplete_national_focus = {
						focus = NEP_loyalty_to_the_liberators
						uncomplete_children = yes
					}
				}
			}
			if = {
				limit = { has_completed_focus = NEP_our_ruler_glorious }
				uncomplete_national_focus = {
					focus = NEP_our_ruler_glorious
					uncomplete_children = yes
				}
			}
			if = {
				limit = { has_completed_focus = NEP_the_unshackling_of_nepal }
				uncomplete_national_focus = {
					focus = NEP_the_unshackling_of_nepal
					uncomplete_children = yes
				}
			}
		}

		### update foreign policy tree ###
		if = {
			limit = { has_completed_focus = NEP_protection_of_nepalese_independence }
			uncomplete_national_focus = {
				focus = NEP_protection_of_nepalese_independence
				uncomplete_children = yes
			}
		}
		if = {
			limit = {
				has_completed_focus = NEP_reaffirm_the_friendship_treaty
				NOT = { is_subject_of = DEH }
			}
			uncomplete_national_focus = {
				focus = NEP_reaffirm_the_friendship_treaty
				uncomplete_children = yes
			}
		}
		if = {
			limit = {
				has_completed_focus = NEP_under_the_wings_of_the_republic
				NOT = { is_subject_of = BHC }
			}
			uncomplete_national_focus = {
				focus = NEP_under_the_wings_of_the_republic
				uncomplete_children = yes
			}
		}
	}
}

NEP_join_overlord_faction_effect = {
	if = {
		limit = {
			NEP = { has_country_flag = NEP_join_overlord_faction_flag }
		}
		NEP = { set_global_flag = TEMPORARY_DISABLED_FACTION_POPUP }
		add_to_faction = NEP
	}
}

NEP_check_influence = {
	NEP = {
		set_variable = { var = NEP_relative_BHC_influence value = NEP.NEP_conspiracy_influence_var_BHC }
		subtract_from_variable = { var = NEP_relative_BHC_influence value = NEP_conspiracy_influence_var_DEH }
		clamp_variable = { var = NEP_relative_BHC_influence min = 0 }
		set_variable = { var = NEP_relative_DEH_influence value = NEP.NEP_conspiracy_influence_var_DEH }
		subtract_from_variable = { var = NEP_relative_DEH_influence value = NEP_conspiracy_influence_var_BHC }
		clamp_variable = { var = NEP_relative_DEH_influence min = 0 }
	}
}

NEP_change_influence_FROM = {
	custom_override_tooltip = {
		tooltip = {
			localization_key = NEP_conspiracy_influence_change_tooltip
			COUNTRY = "[FROM.GetTag]"
		}
		NEP = {
			add_to_variable = { NEP.NEP_conspiracy_influence_var_@FROM = NEP_conspiracy_influence_change }
			clamp_variable = { var = NEP.NEP_conspiracy_influence_var_@FROM min = 0 }
		}
	}
	NEP_check_influence = yes
}

NEP_change_influence_ROOT = {
	custom_override_tooltip = {
		tooltip = {
			localization_key = NEP_conspiracy_influence_change_tooltip
			COUNTRY = "[ROOT.GetTag]"
		}
		NEP = {
			add_to_variable = { NEP.NEP_conspiracy_influence_var_@ROOT = NEP_conspiracy_influence_change }
			clamp_variable = { var = NEP.NEP_conspiracy_influence_var_@ROOT min = 0 }
		}
	}
	NEP_check_influence = yes
}

NEP_change_influence_BHC = {
	custom_override_tooltip = {
		tooltip = {
			localization_key = NEP_conspiracy_influence_change_tooltip
			COUNTRY = "[BHC.GetTag]"
		}
		NEP = {
			add_to_variable = { NEP.NEP_conspiracy_influence_var_@BHC = NEP_conspiracy_influence_change }
			clamp_variable = { var = NEP.NEP_conspiracy_influence_var_@BHC min = 0 }
		}
	}
	NEP_check_influence = yes
}

NEP_change_influence_DEH = {
	custom_override_tooltip = {
		tooltip = {
			localization_key = NEP_conspiracy_influence_change_tooltip
			COUNTRY = "[DEH.GetTag]"
		}
		NEP = {
			add_to_variable = { NEP.NEP_conspiracy_influence_var_@DEH = NEP_conspiracy_influence_change }
			clamp_variable = { var = NEP.NEP_conspiracy_influence_var_@DEH min = 0 }
		}
	}
	NEP_check_influence = yes
}

NEP_conspiracy_rng_effect = {
	hidden_effect = {
		random_list = {
			20 = {
				set_country_flag = { flag = NEP_conspiracy_ai_flag days = 10 value = 1 }
			}
			20 = {
				set_country_flag = { flag = NEP_conspiracy_ai_flag days = 13 value = 1 }
			}
			20 = {
				set_country_flag = { flag = NEP_conspiracy_ai_flag days = 15 value = 1 }
			}
			20 = {
				set_country_flag = { flag = NEP_conspiracy_ai_flag days = 18 value = 1 }
			}
			20 = {
				set_country_flag = { flag = NEP_conspiracy_ai_flag days = 20 value = 1 }
			}
		}
	}
}

NEP_disable_indian_nightmare_decisions = {
	remove_targeted_decision = { decision = NEP_pilfer_the_depots target = THIS }
	remove_targeted_decision = { decision = NEP_emergency_military_production target = THIS }
	remove_targeted_decision = { decision = NEP_retreat_to_kathmandu target = THIS }
	remove_targeted_decision = { decision = NEP_fortify_uttaranchal target = 814 }
	remove_targeted_decision = { decision = NEP_fortify_darjeeling target = 887 }
}
