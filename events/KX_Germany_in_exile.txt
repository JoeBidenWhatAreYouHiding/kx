add_namespace = GEX
add_namespace = GEXMAF
add_namespace = GEXGEA
add_namespace = GEXAOG
add_namespace = GEXTXS
add_namespace = GEXOTT
add_namespace = GEX_foreign

# Main German capitulation event
country_event = {
	id = GEX.1
	title = GEX.1.t
	desc = GEX.1.d
	picture = GFX_report_event_german_reichstag_bombed

	fire_only_once = yes

	trigger = {
		tag = GER
		is_subject = no
		has_war = yes
		OR = {
			surrender_progress > 0.8
			AND = {
				NOT = { controls_state = 64 } #Brandenburg
				surrender_progress > 0.75
			}
			NOT = {
				controls_state = 28 #Elsass-Lothringen
				controls_state = 51 #Ostrheinland
				controls_state = 55 #Hessen
				controls_state = 50 #Wurttemberg
				controls_state = 52 #Oberbayern
				controls_state = 59 #Hannover
			}
			AND = {
				NOT = {
					controls_state = 5 #Ostpreussen
					controls_state = 66 #Niederschlesien
					controls_state = 86 #Posen
					controls_state = 62 #Pommern
					controls_state = 64 #Brandenburg
				}
				OR = {
					NOT = {
						controls_state = 55 #Hessen
						controls_state = 51 #Ostrheinland
						controls_state = 28 #Elsass-Lothringen
					}
					NOT = {
						controls_state = 52 #Oberbayern
						controls_state = 55 #Hessen
						controls_state = 60 #Thuringen
					}
				}
			}
		}
	}

	immediate = {
		log = "[GetDateText]: [Root.GetName]: event GEX.1"
		hidden_effect = {
			add_ideas = GEX_flight_of_the_reich

			if = { #Checking for UoB involvement in the war
				limit = {
					ENG = {
						is_in_faction_with = FRA
						has_war_with = GER
						OR = {
							any_war_score > 10
							controls_state = 56
							controls_state = 58
							controls_state = 59
						}
					}
				}
				set_global_flag = UoB_war_par_1
			}
			if = {
				limit = {
					ENG = {
						is_in_faction_with = FRA
						has_war_with = GER
						OR = {
							any_war_score > 25
							AND = {
								controls_state = 5
								controls_state = 62
								controls_state = 86
							}
							controls_state = 64
						}
					}
				}
				set_global_flag = UoB_war_par_2
			}

			random_other_country = {
				limit = { has_war_with = GER }
				news_event = worldnews.145
				country_event = worldtension.25
			}

			LEC = {
				country_event = {
					id = lec.100
					days = 1
				}
			}
		}
	}

	option = {
		name = GEX.1.a #Assume control of Mittelafrika. We shall fight on from there
		trigger = {#Does Germany flee to MAF?
			MAF = {
				has_idea = MAF_Colonial_Nation
				965 = { is_controlled_by = MAF } #Dar-es-Salaam
				OR = {
					has_war = no
					AND = {
						has_capitulated = no
						surrender_progress < 0.30
					}
				}
				OR = {
					is_ai = yes
					GER = { is_ai = yes }
				}
			}
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_africa
		if = {
			limit = {
				MAF = { is_ai = no }
			}
			MAF = { country_event = GEX.2 }
		}
		else = {
			custom_effect_tooltip = MAF_player_becomes_GEX
			hidden_effect = {
				country_event = GEX.21
			}
		}
	}
	
	option = {
		name = GEX.1.b #Assume control of GEA
		trigger = {#Does Germany flee to MAF?
			MAF = {
				has_idea = MAF_Colonial_Nation
				965 = { is_controlled_by = MAF } #Dar-es-Salaam
				OR = {
					has_war = no
					AND = {
						has_capitulated = no
						surrender_progress < 0.30
					}
				}
			}
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_africa
		if = {
			limit = {
				MAF = { is_ai = no }
			}
			MAF = { country_event = GEX.2 }
		}
		else = {
			custom_effect_tooltip = MAF_player_becomes_GEX
			hidden_effect = {
				country_event = GEX.21
			}
		}
	}
	
	option = {
		name = GEX.1.c #Assume control of AOG
		trigger = {
			AOG = {
				has_idea = AOG_Colonial_Nation
				618 = {
					is_owned_by_ROOT_or_subject = yes
				} #Jinling
				OR = {
					has_war = no
					AND = {
						has_capitulated = no
						surrender_progress < 0.30
					}
				}
			}
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_china
		if = {
			limit = {
				AOG = { is_ai = no }
			}
			#AOG = { country_event = GEX.2 }
		}
		else = {
			custom_effect_tooltip = MAF_player_becomes_GEX
			hidden_effect = {
				country_event = GEX.21
			}
		}
	}
	
	option = {
		name = GEX.1.e #Flee to Texas
		trigger = {
			TXS = {
				has_idea = TXS_Colonial_Nation
				965 = { is_controlled_by = TXS } #Dar-es-Salaam
				OR = {
					has_war = no
					AND = {
						has_capitulated = no
						surrender_progress < 0.30
					}
				}
				OR = {
					is_ai = yes
					GER = { is_ai = yes }
				}
			}
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_africa
		if = {
			limit = {
				TXS = { is_ai = no }
			}
			TXS = { country_event = GEX.2 }
		}
		else = {
			custom_effect_tooltip = TXS_player_becomes_GEX
			hidden_effect = {
				country_event = GEX.21
			}
		}
	}
	option = {
		name = GEX.1.f #There is nowhere to run. Surrender!
		trigger = {
			NOT = { has_global_flag = GER_flees_to_africa }
		}
		log = "		-- Germany is capitulating completely, no exile"
		set_country_flag = GER_capitulated
		custom_effect_tooltip = GER_will_capitulate
		hidden_effect = {
			country_event = GEX.22
		}
	}
}